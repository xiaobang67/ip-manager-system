import{d as we,r as f,a as H,o as Ue,c as y,e as l,w as a,n as r,i as n,D as ze,j as p,g as x,G as De,l as d,x as Y,b as u,H as Ie,T as Se,I as $e,J as Le,K as Z,t as v,L as Ee,F as Te,y as je,z as Ae,M as ee,_ as Be}from"./index-de8d932e.js";import{u as w}from"./user-ac9e02c0.js";import{d as Pe}from"./department-9b96297e.js";const Re={class:"user-list"},Fe={class:"toolbar"},Ne={class:"toolbar-left"},Me={class:"toolbar-right"},Oe={key:0},qe={key:1,class:"text-muted"},Ge={key:0},He={key:1,class:"text-muted"},Je={key:0},Ke={key:1,class:"text-muted"},Qe={key:0},We={key:1,class:"text-muted"},Xe={class:"pagination-container"},Ye={class:"selected-users"},Ze={key:0,class:"stats-container"},el={class:"stat-item"},ll={class:"stat-value"},al={class:"stat-item"},tl={class:"stat-value"},ol={class:"stat-item"},sl={class:"stat-value"},nl=we({__name:"UserList",setup(dl){const j=f(!1),J=f([]),S=f([]),k=f([]),c=H({search:"",department_id:void 0,is_active:void 0,auth_source:void 0}),_=H({page:1,size:20,total:0}),U=f(!1),$=f(!1),A=f(),s=H({username:"",real_name:"",email:"",phone:"",department_id:void 0,employee_id:"",position:"",is_active:!0,auth_source:"local"}),le={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],real_name:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},D=f(!1),z=f(),B=f(!1),I=f(),L=f(),P={children:"children",label:"name",value:"id"},ae=t=>new Date(t).toLocaleString("zh-CN"),V=async()=>{j.value=!0;try{const t={skip:(_.page-1)*_.size,limit:_.size,...c};t.is_active===void 0&&(t.is_active=!0),Object.keys(t).forEach(g=>{(t[g]===""||t[g]===void 0)&&delete t[g]});const e=await w.getList(t);J.value=e,console.info("用户列表数据加载完成",{params:t,count:e.length})}catch(t){r.error("加载数据失败"),console.error("用户列表数据加载失败:",t),console.info("用户列表数据加载失败",{error:t.message})}finally{j.value=!1}},te=async()=>{try{const t=await Pe.getTree();S.value=t,console.info("部门树数据加载完成",{count:t.length})}catch(t){console.error("加载部门数据失败:",t),console.info("部门树数据加载失败",{error:t.message})}},K=()=>{_.page=1,V(),console.info("执行用户搜索",{searchForm:c})},oe=()=>{Object.assign(c,{search:"",department_id:void 0,is_active:void 0,auth_source:void 0}),K(),console.info("重置用户搜索条件")},se=()=>{$.value=!1,fe(),U.value=!0,console.info("打开新增用户对话框")},ne=t=>{$.value=!0,L.value=t,Object.assign(s,{username:t.username,real_name:t.real_name,email:t.email||"",phone:t.phone||"",department_id:t.department_id,employee_id:t.employee_id||"",position:t.position||"",is_active:t.is_active,auth_source:t.auth_source||"local"}),U.value=!0,console.info("打开编辑用户对话框",{userId:t.id,username:t.username})},de=async()=>{if(A.value)try{await A.value.validate(),$.value&&L.value?(await w.update(L.value.id,s),r.success("用户更新成功"),console.info("用户更新成功",{userId:L.value.id,username:s.username})):(await w.create(s),r.success("用户创建成功"),console.info("用户创建成功",{username:s.username})),U.value=!1,V()}catch(t){console.error("保存用户失败:",t),r.error("保存用户失败"),console.info("保存用户失败",{error:t.message,form:s})}},ie=async t=>{try{const e=await w.getStatistics(t.id);I.value=e,B.value=!0,console.info("用户统计信息查看",{userId:t.id,username:t.username})}catch(e){r.error("获取统计信息失败"),console.error("获取用户统计信息失败:",e),console.info("获取用户统计信息失败",{userId:t.id,username:t.username,error:e.message})}},Q=()=>{if(k.value.length===0){r.warning("请选择要转移的用户");return}z.value=void 0,D.value=!0,console.info("打开批量转移部门对话框",{selectedCount:k.value.length})},re=async()=>{if(!z.value){r.warning("请选择目标部门");return}try{const t=k.value.map(e=>e.id);await w.transferToDepartment({user_ids:t,new_department_id:z.value}),r.success("用户转移成功"),console.info("用户批量转移部门成功",{userIds:t,departmentId:z.value}),D.value=!1,V()}catch(t){console.error("转移用户失败:",t),r.error("转移用户失败"),console.info("用户批量转移部门失败",{error:t.message})}},ue=()=>{r.info("导出功能开发中..."),console.info("用户尝试导出数据")},me=t=>{k.value=t,console.info("用户选择变更",{selectedCount:t.length})},pe=async(t,e)=>{switch(console.info("执行用户操作",{command:t,userId:e.id,username:e.username}),t){case"enable":case"disable":await ce(e);break;case"transfer":k.value=[e],Q();break;case"delete":await _e(e);break}},ce=async t=>{try{const e=t.is_active?"禁用":"启用";await ee.confirm(`确定要${e}用户 ${t.real_name} 吗？`,`确认${e}`,{type:"warning"}),await w.update(t.id,{is_active:!t.is_active}),r.success(`${e}成功`),console.info(`用户${e}成功`,{userId:t.id,username:t.username}),V()}catch(e){e!=="cancel"&&(console.error("切换用户状态失败:",e),r.error(`${action}失败`),console.info(`用户${action}失败`,{userId:t.id,username:t.username,error:e.message}))}},_e=async t=>{try{await ee.confirm(`确定要删除用户 ${t.real_name} 吗？此操作不可恢复！`,"确认删除",{type:"warning"}),await w.delete(t.id),r.success("删除成功"),console.info("用户删除成功",{userId:t.id,username:t.username}),V()}catch(e){e!=="cancel"&&(console.error("删除用户失败:",e),r.error("删除用户失败"),console.info("用户删除失败",{userId:t.id,username:t.username,error:e.message}))}},fe=()=>{Object.assign(s,{username:"",real_name:"",email:"",phone:"",department_id:void 0,employee_id:"",position:"",is_active:!0,auth_source:"local"}),console.info("重置用户表单")},ve=t=>{_.size=t,_.page=1,V(),console.info("分页大小变更",{size:t})},ge=t=>{_.page=t,V(),console.info("分页页码变更",{page:t})};return Ue(()=>{V(),te(),console.info("用户列表页面初始化完成")}),(t,e)=>{const g=n("el-input"),i=n("el-form-item"),R=n("el-tree-select"),E=n("el-option"),W=n("el-select"),C=n("el-icon"),m=n("el-button"),F=n("el-form"),N=n("el-card"),b=n("el-table-column"),M=n("el-tag"),O=n("el-dropdown-item"),be=n("el-dropdown-menu"),ye=n("el-dropdown"),Ve=n("el-table"),he=n("el-pagination"),h=n("el-col"),T=n("el-row"),X=n("el-radio"),ke=n("el-radio-group"),Ce=n("el-switch"),q=n("el-dialog"),xe=ze("loading");return p(),y("div",Re,[l(N,{class:"search-card"},{default:a(()=>[l(F,{inline:!0,model:c,class:"search-form"},{default:a(()=>[l(i,{label:"用户信息"},{default:a(()=>[l(g,{modelValue:c.search,"onUpdate:modelValue":e[0]||(e[0]=o=>c.search=o),placeholder:"请输入用户名、姓名或邮箱",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(i,{label:"所属部门"},{default:a(()=>[l(R,{modelValue:c.department_id,"onUpdate:modelValue":e[1]||(e[1]=o=>c.department_id=o),data:S.value,props:P,placeholder:"请选择部门",clearable:"","check-strictly":"",style:{width:"200px"}},null,8,["modelValue","data"])]),_:1}),l(i,{label:"状态"},{default:a(()=>[l(W,{modelValue:c.is_active,"onUpdate:modelValue":e[2]||(e[2]=o=>c.is_active=o),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:a(()=>[l(E,{label:"启用",value:!0}),l(E,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"来源"},{default:a(()=>[l(W,{modelValue:c.auth_source,"onUpdate:modelValue":e[3]||(e[3]=o=>c.auth_source=o),placeholder:"认证来源",clearable:"",style:{width:"120px"}},{default:a(()=>[l(E,{label:"LDAP",value:"ldap"}),l(E,{label:"本地",value:"local"})]),_:1},8,["modelValue"])]),_:1}),l(i,null,{default:a(()=>[l(m,{type:"primary",onClick:K},{default:a(()=>[l(C,null,{default:a(()=>[l(x(De))]),_:1}),e[21]||(e[21]=d(" 搜索 ",-1))]),_:1}),l(m,{onClick:oe},{default:a(()=>[l(C,null,{default:a(()=>[l(x(Y))]),_:1}),e[22]||(e[22]=d(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(N,{class:"toolbar-card"},{default:a(()=>[u("div",Fe,[u("div",Ne,[l(m,{type:"primary",onClick:se},{default:a(()=>[l(C,null,{default:a(()=>[l(x(Ie))]),_:1}),e[23]||(e[23]=d(" 新增用户 ",-1))]),_:1}),l(m,{type:"success",onClick:Q,disabled:k.value.length===0},{default:a(()=>[l(C,null,{default:a(()=>[l(x(Se))]),_:1}),e[24]||(e[24]=d(" 批量转移部门 ",-1))]),_:1},8,["disabled"]),l(m,{type:"warning",onClick:ue},{default:a(()=>[l(C,null,{default:a(()=>[l(x($e))]),_:1}),e[25]||(e[25]=d(" 导出数据 ",-1))]),_:1})]),u("div",Me,[l(m,{onClick:V},{default:a(()=>[l(C,null,{default:a(()=>[l(x(Y))]),_:1}),e[26]||(e[26]=d(" 刷新 ",-1))]),_:1})])])]),_:1}),l(N,{class:"table-card"},{default:a(()=>[Le((p(),Z(Ve,{data:J.value,stripe:"",border:"",style:{width:"100%"},onSelectionChange:me},{default:a(()=>[l(b,{type:"selection",width:"50"}),l(b,{prop:"username",label:"用户名",width:"120"}),l(b,{prop:"real_name",label:"真实姓名",width:"120"}),l(b,{prop:"email",label:"邮箱",width:"180"},{default:a(({row:o})=>[o.email?(p(),y("span",Oe,v(o.email),1)):(p(),y("span",qe,"-"))]),_:1}),l(b,{label:"来源",width:"100"},{default:a(({row:o})=>[l(M,{type:o.auth_source==="ldap"?"primary":"success",size:"small"},{default:a(()=>[d(v(o.auth_source==="ldap"?"LDAP":"本地"),1)]),_:2},1032,["type"])]),_:1}),l(b,{label:"所属部门",width:"150"},{default:a(({row:o})=>[o.department?(p(),y("span",Ge,v(o.department.name),1)):(p(),y("span",He,"未分配"))]),_:1}),l(b,{prop:"employee_id",label:"员工编号",width:"120"},{default:a(({row:o})=>[o.employee_id?(p(),y("span",Je,v(o.employee_id),1)):(p(),y("span",Ke,"-"))]),_:1}),l(b,{prop:"position",label:"职位",width:"120"},{default:a(({row:o})=>[o.position?(p(),y("span",Qe,v(o.position),1)):(p(),y("span",We,"-"))]),_:1}),l(b,{label:"状态",width:"80"},{default:a(({row:o})=>[l(M,{type:o.is_active?"success":"danger",size:"small"},{default:a(()=>[d(v(o.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(b,{prop:"created_at",label:"创建时间",width:"150"},{default:a(({row:o})=>[d(v(ae(o.created_at)),1)]),_:1}),l(b,{label:"操作",width:"220",fixed:"right"},{default:a(({row:o})=>[l(m,{type:"info",size:"small",onClick:G=>ie(o)},{default:a(()=>[...e[27]||(e[27]=[d(" 统计 ",-1)])]),_:2},1032,["onClick"]),l(m,{type:"warning",size:"small",onClick:G=>ne(o)},{default:a(()=>[...e[28]||(e[28]=[d(" 编辑 ",-1)])]),_:2},1032,["onClick"]),l(ye,{onCommand:G=>pe(G,o)},{dropdown:a(()=>[l(be,null,{default:a(()=>[l(O,{command:o.is_active?"disable":"enable"},{default:a(()=>[d(v(o.is_active?"禁用":"启用"),1)]),_:2},1032,["command"]),l(O,{command:"transfer"},{default:a(()=>[...e[30]||(e[30]=[d("转移部门",-1)])]),_:1}),l(O,{command:"delete",divided:""},{default:a(()=>[...e[31]||(e[31]=[d("删除",-1)])]),_:1})]),_:2},1024)]),default:a(()=>[l(m,{size:"small"},{default:a(()=>[e[29]||(e[29]=d(" 更多",-1)),l(C,null,{default:a(()=>[l(x(Ee))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"])),[[xe,j.value]]),u("div",Xe,[l(he,{"current-page":_.page,"onUpdate:currentPage":e[4]||(e[4]=o=>_.page=o),"page-size":_.size,"onUpdate:pageSize":e[5]||(e[5]=o=>_.size=o),"page-sizes":[10,20,50,100],total:_.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ve,onCurrentChange:ge},null,8,["current-page","page-size","total"])])]),_:1}),l(q,{modelValue:U.value,"onUpdate:modelValue":e[16]||(e[16]=o=>U.value=o),title:$.value?"编辑用户":"新增用户",width:"600px"},{footer:a(()=>[l(m,{onClick:e[15]||(e[15]=o=>U.value=!1)},{default:a(()=>[...e[34]||(e[34]=[d("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:de},{default:a(()=>[...e[35]||(e[35]=[d("确认",-1)])]),_:1})]),default:a(()=>[l(F,{ref_key:"formRef",ref:A,model:s,rules:le,"label-width":"100px"},{default:a(()=>[l(T,{gutter:20},{default:a(()=>[l(h,{span:12},{default:a(()=>[l(i,{label:"用户名",prop:"username"},{default:a(()=>[l(g,{modelValue:s.username,"onUpdate:modelValue":e[6]||(e[6]=o=>s.username=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1})]),_:1}),l(h,{span:12},{default:a(()=>[l(i,{label:"真实姓名",prop:"real_name"},{default:a(()=>[l(g,{modelValue:s.real_name,"onUpdate:modelValue":e[7]||(e[7]=o=>s.real_name=o),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(T,{gutter:20},{default:a(()=>[l(h,{span:12},{default:a(()=>[l(i,{label:"邮箱",prop:"email"},{default:a(()=>[l(g,{modelValue:s.email,"onUpdate:modelValue":e[8]||(e[8]=o=>s.email=o),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),l(h,{span:12},{default:a(()=>[l(i,{label:"电话"},{default:a(()=>[l(g,{modelValue:s.phone,"onUpdate:modelValue":e[9]||(e[9]=o=>s.phone=o),placeholder:"请输入电话号码"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(T,{gutter:20},{default:a(()=>[l(h,{span:12},{default:a(()=>[l(i,{label:"员工编号"},{default:a(()=>[l(g,{modelValue:s.employee_id,"onUpdate:modelValue":e[10]||(e[10]=o=>s.employee_id=o),placeholder:"请输入员工编号"},null,8,["modelValue"])]),_:1})]),_:1}),l(h,{span:12},{default:a(()=>[l(i,{label:"职位"},{default:a(()=>[l(g,{modelValue:s.position,"onUpdate:modelValue":e[11]||(e[11]=o=>s.position=o),placeholder:"请输入职位"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(i,{label:"认证来源"},{default:a(()=>[l(ke,{modelValue:s.auth_source,"onUpdate:modelValue":e[12]||(e[12]=o=>s.auth_source=o)},{default:a(()=>[l(X,{label:"ldap"},{default:a(()=>[...e[32]||(e[32]=[d("LDAP",-1)])]),_:1}),l(X,{label:"local"},{default:a(()=>[...e[33]||(e[33]=[d("本地",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"所属部门"},{default:a(()=>[l(R,{modelValue:s.department_id,"onUpdate:modelValue":e[13]||(e[13]=o=>s.department_id=o),data:S.value,props:P,placeholder:"请选择所属部门",clearable:"","check-strictly":"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),l(i,{label:"状态"},{default:a(()=>[l(Ce,{modelValue:s.is_active,"onUpdate:modelValue":e[14]||(e[14]=o=>s.is_active=o),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(q,{modelValue:D.value,"onUpdate:modelValue":e[19]||(e[19]=o=>D.value=o),title:"批量转移部门",width:"400px"},{footer:a(()=>[l(m,{onClick:e[18]||(e[18]=o=>D.value=!1)},{default:a(()=>[...e[36]||(e[36]=[d("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:re},{default:a(()=>[...e[37]||(e[37]=[d("确认转移",-1)])]),_:1})]),default:a(()=>[l(F,{"label-width":"100px"},{default:a(()=>[l(i,{label:"选中用户"},{default:a(()=>[u("div",Ye,[(p(!0),y(Te,null,je(k.value,o=>(p(),Z(M,{key:o.id,size:"small",style:{margin:"2px"}},{default:a(()=>[d(v(o.real_name),1)]),_:2},1024))),128))])]),_:1}),l(i,{label:"目标部门",required:""},{default:a(()=>[l(R,{modelValue:z.value,"onUpdate:modelValue":e[17]||(e[17]=o=>z.value=o),data:S.value,props:P,placeholder:"请选择目标部门","check-strictly":"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(q,{modelValue:B.value,"onUpdate:modelValue":e[20]||(e[20]=o=>B.value=o),title:"用户统计信息",width:"500px"},{default:a(()=>[I.value?(p(),y("div",Ze,[l(T,{gutter:20},{default:a(()=>[l(h,{span:8},{default:a(()=>[u("div",el,[e[38]||(e[38]=u("div",{class:"stat-label"},"分配IP数",-1)),u("div",ll,v(I.value.allocated_ips),1)])]),_:1}),l(h,{span:8},{default:a(()=>[u("div",al,[e[39]||(e[39]=u("div",{class:"stat-label"},"负责网段",-1)),u("div",tl,v(I.value.responsible_segments),1)])]),_:1}),l(h,{span:8},{default:a(()=>[u("div",ol,[e[40]||(e[40]=u("div",{class:"stat-label"},"地址保留",-1)),u("div",sl,v(I.value.active_reservations),1)])]),_:1})]),_:1})])):Ae("",!0)]),_:1},8,["modelValue"])])}}});const ml=Be(nl,[["__scopeId","data-v-7f0e5ef9"]]);export{ml as default};
