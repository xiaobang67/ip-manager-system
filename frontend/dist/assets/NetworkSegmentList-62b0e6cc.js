import{d as xe,r as b,a as F,o as ze,c as g,e,w as l,h as Se,n as y,i as d,D as Ue,j as p,g as z,G as De,l as i,x as K,b as n,H as Ne,N as Ae,I as Ie,J as $e,K as $,t as _,L as Le,F as Q,y as W,z as Pe,M as X,_ as Ee}from"./index-de8d932e.js";import{n as U}from"./networkSegment-d69ecc2b.js";import{d as Re}from"./department-9b96297e.js";import{u as je}from"./user-ac9e02c0.js";const qe={class:"network-segment-list"},Be={class:"toolbar"},Fe={class:"toolbar-left"},Oe={class:"toolbar-right"},Me={key:0},Te={key:1,class:"text-muted"},Ge={key:1,class:"text-muted"},He={key:0},Je={key:1,class:"text-muted"},Ke={key:0},Qe={key:1,class:"text-muted"},We={class:"pagination-container"},Xe={key:0,class:"stats-container"},Ye={class:"stat-item"},Ze={class:"stat-value"},et={class:"stat-item"},tt={class:"stat-value"},lt={class:"stat-item success"},at={class:"stat-value"},st={class:"stat-item warning"},ot={class:"stat-value"},nt={class:"stat-item danger"},dt={class:"stat-value"},it={class:"stat-item info"},rt={class:"stat-value"},ut=xe({__name:"NetworkSegmentList",setup(_t){const Y=Se(),L=b(!1),P=b([]),O=b([]),D=b([]),M=b([]),h=F({search:"",is_active:void 0}),m=F({page:1,size:20,total:0}),S=b(!1),N=b(!1),E=b(),o=F({name:"",network:"",start_ip:"",end_ip:"",subnet_mask:"",gateway:"",dns_servers:[],vlan_id:void 0,purpose:"",location:"",responsible_department_id:void 0,responsible_user_id:void 0,is_active:!0}),Z={name:[{required:!0,message:"请输入网段名称",trigger:"blur"}],network:[{required:!0,message:"请输入网络地址",trigger:"blur"}],start_ip:[{required:!0,message:"请输入起始IP",trigger:"blur"}],end_ip:[{required:!0,message:"请输入结束IP",trigger:"blur"}],subnet_mask:[{required:!0,message:"请输入子网掩码",trigger:"blur"}]},R=b(!1),w=b(),j=b(),ee=s=>new Date(s).toLocaleString("zh-CN"),V=async()=>{L.value=!0;try{const s={skip:(m.page-1)*m.size,limit:m.size,...h};Object.keys(s).forEach(f=>{(s[f]===""||s[f]===void 0)&&delete s[f]});const t=await U.getList(s);t.items&&Array.isArray(t.items)?(P.value=t.items,m.total=t.total||0):(P.value=Array.isArray(t)?t:[],m.total=0)}catch(s){y.error("加载数据失败"),console.error(s)}finally{L.value=!1}},te=async()=>{try{const s=await Re.getList({limit:1e3});O.value=s}catch(s){console.error("加载部门列表失败:",s)}},le=async s=>{if(!s){D.value=[];return}try{const t=await je.search({q:s,limit:20});D.value=t}catch(t){console.error("搜索用户失败:",t)}},T=()=>{m.page=1,V()},ae=()=>{Object.assign(h,{search:"",is_active:void 0}),T()},se=()=>{N.value=!1,fe(),S.value=!0},oe=s=>{N.value=!0,j.value=s,Object.assign(o,{name:s.name,network:s.network,start_ip:s.start_ip,end_ip:s.end_ip,subnet_mask:s.subnet_mask,gateway:s.gateway||"",dns_servers:s.dns_servers||[],vlan_id:s.vlan_id,purpose:s.purpose||"",location:s.location||"",responsible_department_id:s.responsible_department_id,responsible_user_id:s.responsible_user_id,is_active:s.is_active}),s.responsible_user&&(D.value=[s.responsible_user]),S.value=!0},ne=async()=>{if(E.value)try{await E.value.validate();const s={...o};s.dns_servers&&Array.isArray(s.dns_servers)&&s.dns_servers.length===0&&(s.dns_servers=void 0),N.value&&j.value?(await U.update(j.value.id,s),y.success("网段更新成功")):(await U.create(s),y.success("网段创建成功")),S.value=!1,V()}catch(s){console.error("保存网段失败:",s)}},de=s=>{Y.push({path:"/ip-management/addresses",query:{network_segment_id:s.id}})},ie=async s=>{try{const t=await U.getStatistics(s.id);w.value=t,R.value=!0}catch(t){y.error("获取统计信息失败"),console.error(t)}},re=()=>{if(M.value.length===0){y.warning("请选择要操作的网段");return}y.info("批量操作功能开发中...")},ue=()=>{y.info("导出功能开发中...")},_e=s=>{M.value=s},pe=async(s,t)=>{switch(s){case"enable":case"disable":await me(t);break;case"delete":await ce(t);break}},me=async s=>{try{const t=s.is_active?"禁用":"启用";await X.confirm(`确定要${t}网段 ${s.name} 吗？`,`确认${t}`,{type:"warning"}),await U.update(s.id,{is_active:!s.is_active}),y.success(`${t}成功`),V()}catch(t){t!=="cancel"&&console.error("切换网段状态失败:",t)}},ce=async s=>{try{await X.confirm(`确定要删除网段 ${s.name} 吗？此操作不可恢复！`,"确认删除",{type:"warning"}),await U.delete(s.id),y.success("删除成功"),V()}catch(t){t!=="cancel"&&console.error("删除网段失败:",t)}},fe=()=>{Object.assign(o,{name:"",network:"",start_ip:"",end_ip:"",subnet_mask:"",gateway:"",dns_servers:[],vlan_id:void 0,purpose:"",location:"",responsible_department_id:void 0,responsible_user_id:void 0,is_active:!0}),D.value=[]},ve=s=>{m.size=s,m.page=1,V()},be=s=>{m.page=s,V()};return ze(()=>{V(),te()}),(s,t)=>{const f=d("el-input"),r=d("el-form-item"),k=d("el-option"),A=d("el-select"),C=d("el-icon"),v=d("el-button"),G=d("el-form"),q=d("el-card"),c=d("el-table-column"),B=d("el-tag"),H=d("el-dropdown-item"),ge=d("el-dropdown-menu"),ye=d("el-dropdown"),we=d("el-table"),Ve=d("el-pagination"),u=d("el-col"),x=d("el-row"),ke=d("el-input-number"),he=d("el-switch"),J=d("el-dialog"),Ce=Ue("loading");return p(),g("div",qe,[e(q,{class:"search-card"},{default:l(()=>[e(G,{inline:!0,model:h,class:"search-form"},{default:l(()=>[e(r,{label:"网段名称"},{default:l(()=>[e(f,{modelValue:h.search,"onUpdate:modelValue":t[0]||(t[0]=a=>h.search=a),placeholder:"请输入网段名称或网络地址",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(r,{label:"状态"},{default:l(()=>[e(A,{modelValue:h.is_active,"onUpdate:modelValue":t[1]||(t[1]=a=>h.is_active=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:l(()=>[e(k,{label:"启用",value:!0}),e(k,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:l(()=>[e(v,{type:"primary",onClick:T},{default:l(()=>[e(C,null,{default:l(()=>[e(z(De))]),_:1}),t[20]||(t[20]=i(" 搜索 ",-1))]),_:1}),e(v,{onClick:ae},{default:l(()=>[e(C,null,{default:l(()=>[e(z(K))]),_:1}),t[21]||(t[21]=i(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(q,{class:"toolbar-card"},{default:l(()=>[n("div",Be,[n("div",Fe,[e(v,{type:"primary",onClick:se},{default:l(()=>[e(C,null,{default:l(()=>[e(z(Ne))]),_:1}),t[22]||(t[22]=i(" 新增网段 ",-1))]),_:1}),e(v,{type:"success",onClick:re},{default:l(()=>[e(C,null,{default:l(()=>[e(z(Ae))]),_:1}),t[23]||(t[23]=i(" 批量操作 ",-1))]),_:1}),e(v,{type:"warning",onClick:ue},{default:l(()=>[e(C,null,{default:l(()=>[e(z(Ie))]),_:1}),t[24]||(t[24]=i(" 导出数据 ",-1))]),_:1})]),n("div",Oe,[e(v,{onClick:V},{default:l(()=>[e(C,null,{default:l(()=>[e(z(K))]),_:1}),t[25]||(t[25]=i(" 刷新 ",-1))]),_:1})])])]),_:1}),e(q,{class:"table-card"},{default:l(()=>[$e((p(),$(we,{data:P.value,stripe:"",border:"",style:{width:"100%"},onSelectionChange:_e},{default:l(()=>[e(c,{type:"selection",width:"50"}),e(c,{prop:"name",label:"网段名称",width:"150"}),e(c,{prop:"network",label:"网络地址",width:"140"},{default:l(({row:a})=>[e(B,{type:"info"},{default:l(()=>[i(_(a.network),1)]),_:2},1024)]),_:1}),e(c,{label:"IP范围",width:"200"},{default:l(({row:a})=>[n("div",null,_(a.start_ip)+" - "+_(a.end_ip),1)]),_:1}),e(c,{prop:"subnet_mask",label:"子网掩码",width:"140"}),e(c,{prop:"gateway",label:"网关",width:"140"},{default:l(({row:a})=>[a.gateway?(p(),g("span",Me,_(a.gateway),1)):(p(),g("span",Te,"-"))]),_:1}),e(c,{prop:"vlan_id",label:"VLAN ID",width:"100"},{default:l(({row:a})=>[a.vlan_id?(p(),$(B,{key:0,size:"small"},{default:l(()=>[i(_(a.vlan_id),1)]),_:2},1024)):(p(),g("span",Ge,"-"))]),_:1}),e(c,{label:"负责人",width:"120"},{default:l(({row:a})=>[a.responsible_user?(p(),g("div",He,_(a.responsible_user.real_name),1)):(p(),g("span",Je,"未指定"))]),_:1}),e(c,{label:"负责部门",width:"120"},{default:l(({row:a})=>[a.responsible_department?(p(),g("div",Ke,_(a.responsible_department.name),1)):(p(),g("span",Qe,"未指定"))]),_:1}),e(c,{prop:"purpose",label:"用途","min-width":"120","show-overflow-tooltip":""}),e(c,{prop:"location",label:"位置","min-width":"100","show-overflow-tooltip":""}),e(c,{label:"状态",width:"80"},{default:l(({row:a})=>[e(B,{type:a.is_active?"success":"danger",size:"small"},{default:l(()=>[i(_(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"created_at",label:"创建时间",width:"150"},{default:l(({row:a})=>[i(_(ee(a.created_at)),1)]),_:1}),e(c,{label:"操作",width:"250",fixed:"right"},{default:l(({row:a})=>[e(v,{type:"primary",size:"small",onClick:I=>de(a)},{default:l(()=>[...t[26]||(t[26]=[i(" 查看IP ",-1)])]),_:2},1032,["onClick"]),e(v,{type:"info",size:"small",onClick:I=>ie(a)},{default:l(()=>[...t[27]||(t[27]=[i(" 统计 ",-1)])]),_:2},1032,["onClick"]),e(v,{type:"warning",size:"small",onClick:I=>oe(a)},{default:l(()=>[...t[28]||(t[28]=[i(" 编辑 ",-1)])]),_:2},1032,["onClick"]),e(ye,{onCommand:I=>pe(I,a)},{dropdown:l(()=>[e(ge,null,{default:l(()=>[e(H,{command:a.is_active?"disable":"enable"},{default:l(()=>[i(_(a.is_active?"禁用":"启用"),1)]),_:2},1032,["command"]),e(H,{command:"delete",divided:""},{default:l(()=>[...t[30]||(t[30]=[i("删除",-1)])]),_:1})]),_:2},1024)]),default:l(()=>[e(v,{size:"small"},{default:l(()=>[t[29]||(t[29]=i(" 更多",-1)),e(C,null,{default:l(()=>[e(z(Le))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"])),[[Ce,L.value]]),n("div",We,[e(Ve,{"current-page":m.page,"onUpdate:currentPage":t[2]||(t[2]=a=>m.page=a),"page-size":m.size,"onUpdate:pageSize":t[3]||(t[3]=a=>m.size=a),"page-sizes":[10,20,50,100],total:m.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ve,onCurrentChange:be},null,8,["current-page","page-size","total"])])]),_:1}),e(J,{modelValue:S.value,"onUpdate:modelValue":t[18]||(t[18]=a=>S.value=a),title:N.value?"编辑网段":"新增网段",width:"800px"},{footer:l(()=>[e(v,{onClick:t[17]||(t[17]=a=>S.value=!1)},{default:l(()=>[...t[31]||(t[31]=[i("取消",-1)])]),_:1}),e(v,{type:"primary",onClick:ne},{default:l(()=>[...t[32]||(t[32]=[i("确认",-1)])]),_:1})]),default:l(()=>[e(G,{ref_key:"formRef",ref:E,model:o,rules:Z,"label-width":"120px"},{default:l(()=>[e(x,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[e(r,{label:"网段名称",prop:"name"},{default:l(()=>[e(f,{modelValue:o.name,"onUpdate:modelValue":t[4]||(t[4]=a=>o.name=a),placeholder:"请输入网段名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:12},{default:l(()=>[e(r,{label:"网络地址",prop:"network"},{default:l(()=>[e(f,{modelValue:o.network,"onUpdate:modelValue":t[5]||(t[5]=a=>o.network=a),placeholder:"如: 192.168.1.0/24"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[e(r,{label:"起始IP",prop:"start_ip"},{default:l(()=>[e(f,{modelValue:o.start_ip,"onUpdate:modelValue":t[6]||(t[6]=a=>o.start_ip=a),placeholder:"如: 192.168.1.1"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:12},{default:l(()=>[e(r,{label:"结束IP",prop:"end_ip"},{default:l(()=>[e(f,{modelValue:o.end_ip,"onUpdate:modelValue":t[7]||(t[7]=a=>o.end_ip=a),placeholder:"如: 192.168.1.254"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[e(r,{label:"子网掩码",prop:"subnet_mask"},{default:l(()=>[e(f,{modelValue:o.subnet_mask,"onUpdate:modelValue":t[8]||(t[8]=a=>o.subnet_mask=a),placeholder:"如: 255.255.255.0"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:12},{default:l(()=>[e(r,{label:"网关地址"},{default:l(()=>[e(f,{modelValue:o.gateway,"onUpdate:modelValue":t[9]||(t[9]=a=>o.gateway=a),placeholder:"如: 192.168.1.1"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[e(r,{label:"VLAN ID"},{default:l(()=>[e(ke,{modelValue:o.vlan_id,"onUpdate:modelValue":t[10]||(t[10]=a=>o.vlan_id=a),min:1,max:4094,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:12},{default:l(()=>[e(r,{label:"负责部门"},{default:l(()=>[e(A,{modelValue:o.responsible_department_id,"onUpdate:modelValue":t[11]||(t[11]=a=>o.responsible_department_id=a),placeholder:"请选择负责部门",style:{width:"100%"}},{default:l(()=>[(p(!0),g(Q,null,W(O.value,a=>(p(),$(k,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[e(r,{label:"负责人"},{default:l(()=>[e(A,{modelValue:o.responsible_user_id,"onUpdate:modelValue":t[12]||(t[12]=a=>o.responsible_user_id=a),placeholder:"请选择负责人",filterable:"",remote:"","remote-method":le,style:{width:"100%"}},{default:l(()=>[(p(!0),g(Q,null,W(D.value,a=>(p(),$(k,{key:a.id,label:`${a.real_name} (${a.username})`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(u,{span:12},{default:l(()=>[e(r,{label:"物理位置"},{default:l(()=>[e(f,{modelValue:o.location,"onUpdate:modelValue":t[13]||(t[13]=a=>o.location=a),placeholder:"请输入物理位置"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{label:"DNS服务器"},{default:l(()=>[e(A,{modelValue:o.dns_servers,"onUpdate:modelValue":t[14]||(t[14]=a=>o.dns_servers=a),multiple:"",filterable:"","allow-create":"",placeholder:"请输入DNS服务器地址",style:{width:"100%"}},{default:l(()=>[e(k,{value:"8.8.8.8"}),e(k,{value:"8.8.4.4"}),e(k,{value:"114.114.114.114"}),e(k,{value:"223.5.5.5"})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"用途说明"},{default:l(()=>[e(f,{modelValue:o.purpose,"onUpdate:modelValue":t[15]||(t[15]=a=>o.purpose=a),type:"textarea",rows:3,placeholder:"请输入用途说明"},null,8,["modelValue"])]),_:1}),e(r,{label:"状态"},{default:l(()=>[e(he,{modelValue:o.is_active,"onUpdate:modelValue":t[16]||(t[16]=a=>o.is_active=a),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(J,{modelValue:R.value,"onUpdate:modelValue":t[19]||(t[19]=a=>R.value=a),title:"网段统计信息",width:"600px"},{default:l(()=>[w.value?(p(),g("div",Xe,[e(x,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[n("div",Ye,[t[33]||(t[33]=n("div",{class:"stat-label"},"IP地址总数",-1)),n("div",Ze,_(w.value.total_ips),1)])]),_:1}),e(u,{span:12},{default:l(()=>[n("div",et,[t[34]||(t[34]=n("div",{class:"stat-label"},"利用率",-1)),n("div",tt,_(w.value.utilization_rate)+"%",1)])]),_:1})]),_:1}),e(x,{gutter:20,style:{"margin-top":"20px"}},{default:l(()=>[e(u,{span:6},{default:l(()=>[n("div",lt,[t[35]||(t[35]=n("div",{class:"stat-label"},"可用",-1)),n("div",at,_(w.value.available_ips),1)])]),_:1}),e(u,{span:6},{default:l(()=>[n("div",st,[t[36]||(t[36]=n("div",{class:"stat-label"},"已分配",-1)),n("div",ot,_(w.value.allocated_ips),1)])]),_:1}),e(u,{span:6},{default:l(()=>[n("div",nt,[t[37]||(t[37]=n("div",{class:"stat-label"},"保留",-1)),n("div",dt,_(w.value.reserved_ips),1)])]),_:1}),e(u,{span:6},{default:l(()=>[n("div",it,[t[38]||(t[38]=n("div",{class:"stat-label"},"黑名单",-1)),n("div",rt,_(w.value.blacklisted_ips),1)])]),_:1})]),_:1})])):Pe("",!0)]),_:1},8,["modelValue"])])}}});const vt=Ee(ut,[["__scopeId","data-v-350627a3"]]);export{vt as default};
