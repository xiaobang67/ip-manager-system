import{s as y,_ as ce,M as pe,A as fe,f as g,g as te,h as se,j as _e,r as c,o as d,c as M,a as i,b as a,w as s,d as $e,F as G,q as W,p as w,e as m,t as I,u as T,N as et,O as tt,P as lt,I as at,J as ot,E as U,K as me,Q as st}from"./index-665965f3-1757496061419.js";import{s as ge}from"./subnet-9ed2fc37-1757496061774.js";import{g as rt}from"./deviceTypes-1a93fcfe-1757496061777.js";import{getDepartmentOptions as nt}from"./departments-ac1aaa62-1757496061774.js";import{A as it}from"./AppLayout-bfa7eea0-1757496061774.js";import"./ThemeToggle-68291afb-1757496061653.js";const L={getIPs(r={}){return y({url:"/ips",method:"get",params:r})},searchIPs(r={}){return y({url:"/ips/search",method:"get",params:r})},advancedSearchIPs(r){return y({url:"/ips/advanced-search",method:"post",data:r})},allocateIP(r){return y({url:"/ips/allocate",method:"post",data:r})},reserveIP(r){return y({url:"/ips/reserve",method:"post",data:r})},releaseIP(r){return y({url:"/ips/release",method:"post",data:r})},getStatistics(r=null){const e={};return r&&(e.subnet_id=r),y({url:"/ips/statistics",method:"get",params:e})},getConflicts(r=null){const e={};return r&&(e.subnet_id=r),y({url:"/ips/conflicts",method:"get",params:e})},getRangeStatus(r){return y({url:"/ips/range-status",method:"post",data:r})},bulkOperation(r){return y({url:"/ips/bulk-operation",method:"post",data:r})},getIPHistory(r){return y({url:`/ips/${r}/history`,method:"get"})},syncSubnetIPs(r,e){return y({url:"/ips/sync",method:"post",data:{subnet_id:r,network:e}})},getAvailableIPs(r,e=10){return y({url:"/ips/available",method:"get",params:{subnet_id:r,limit:e}})},validateIP(r){return y({url:"/ips/validate",method:"post",data:{ip_address:r}})},getIPDetail(r){return y({url:`/ips/${r}`,method:"get"})},updateIP(r,e){return y({url:`/ips/${r}`,method:"put",data:e})},exportIPs(r={}){return y({url:"/ips/export",method:"get",params:r,responseType:"blob"})},importIPs(r){return y({url:"/ips/import",method:"post",data:r,headers:{"Content-Type":"multipart/form-data"}})},getSearchHistory(r=20){return y({url:"/ips/search-history",method:"get",params:{limit:r}})},getSearchFavorites(){return y({url:"/ips/search-favorites",method:"get"})},saveSearchHistory(r){return y({url:"/ips/search-history",method:"post",data:r})},toggleSearchFavorite(r){return y({url:`/ips/search-history/${r}/favorite`,method:"put"})},updateSearchName(r,e){return y({url:`/ips/search-history/${r}/name`,method:"put",params:{search_name:e}})},deleteSearchHistory(r){return y({url:`/ips/search-history/${r}`,method:"delete"})},getDepartments(){return y({url:"/ips/departments",method:"get"})},deleteIP(r){return y({url:"/ips/delete",method:"delete",data:r})}};const dt={name:"SimpleIPFilter",components:{Search:pe,Refresh:fe},emits:["search","reset"],setup(r,{emit:e}){const Q=g(!1),t=g(""),Y=g([]),k=g([]),C=te({subnet_id:null,status:null,assigned_to:null}),P=se(()=>C.subnet_id||C.status||C.assigned_to||t.value),v=async()=>{try{const u=await ge.getSubnets();Y.value=u.subnets||u.data||[]}catch(u){console.error("加载网段列表失败：",u)}},R=async()=>{try{const{getDepartmentOptions:u}=await et(()=>import("./departments-ac1aaa62-1757496061774.js"),["assets/departments-ac1aaa62-1757496061774.js","assets/index-665965f3-1757496061419.js","assets/index-d4e297f7-1757496061845.css"]),F=await u();if(F&&F.data&&F.data.departments){const h=F.data.departments.map(D=>D.name).sort();k.value=h;return}else if(F&&F.departments){const h=F.departments.map(D=>D.name).sort();k.value=h;return}const E=await L.searchIPs({status:"allocated",limit:1e3}),f=(E.data||E||[]).map(h=>h.assigned_to).filter(h=>h&&h.trim()).filter((h,D,q)=>q.indexOf(h)===D).sort(),X=[...["技术部","运维部","产品部","市场部","人事部","财务部","客服部"],...f].filter((h,D,q)=>q.indexOf(h)===D).sort();k.value=X}catch(u){console.error("加载部门列表失败：",u),k.value=["技术部","运维部","产品部","市场部","人事部","财务部","客服部"]}},O=()=>{V()},V=()=>{Q.value=!0;const u={query:t.value||void 0,subnet_id:C.subnet_id||void 0,status:C.status||void 0,assigned_to:C.assigned_to||void 0};Object.keys(u).forEach(F=>{(u[F]===void 0||u[F]==="")&&delete u[F]}),e("search",u),setTimeout(()=>{Q.value=!1},500)},B=()=>{t.value&&t.value.length>=2?V():t.value||V()},z=()=>{C.subnet_id=null,C.status=null,C.assigned_to=null,t.value="",e("reset")},b=u=>{C[u]=null,V()},N=()=>{t.value="",V()},_=u=>{const F=Y.value.find(E=>E.id===u);return F?F.network:`网段${u}`},H=u=>({available:"可用",allocated:"使用中",reserved:"保留",conflict:"冲突"})[u]||u;return _e(()=>{v(),R()}),{searching:Q,searchQuery:t,subnets:Y,departments:k,filters:C,hasActiveFilters:P,handleFilterChange:O,handleSearch:V,handleQuickSearch:B,handleReset:z,clearFilter:b,clearSearch:N,getSubnetName:_,getStatusText:H}}},ut={class:"simple-ip-filter"},mt={class:"filter-container"},ct={class:"theme-search-section"},pt={class:"filter-row"},ft={class:"filter-item"},_t={class:"filter-item"},gt={class:"filter-item"},vt={class:"filter-item"},bt={class:"filter-actions"},yt={key:0,class:"active-filters"};function ht(r,e,Q,t,Y,k){const C=c("Search"),P=c("el-icon"),v=c("el-input"),R=c("el-option"),O=c("el-select"),V=c("el-button"),B=c("Refresh"),z=c("el-tag");return d(),M("div",ut,[i("div",mt,[i("div",ct,[i("div",pt,[i("div",ft,[e[7]||(e[7]=i("label",{class:"filter-label"},"搜索关键词",-1)),a(v,{modelValue:t.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=b=>t.searchQuery=b),placeholder:"搜索IP地址、使用人、MAC地址...",onInput:t.handleQuickSearch,onKeyup:$e(t.handleSearch,["enter"]),clearable:"",size:"default"},{prefix:s(()=>[a(P,null,{default:s(()=>[a(C)]),_:1})]),_:1},8,["modelValue","onInput","onKeyup"])]),i("div",_t,[e[8]||(e[8]=i("label",{class:"filter-label"},"网段筛选",-1)),a(O,{modelValue:t.filters.subnet_id,"onUpdate:modelValue":e[1]||(e[1]=b=>t.filters.subnet_id=b),placeholder:"选择网段",clearable:"",onChange:t.handleFilterChange,size:"default"},{default:s(()=>[(d(!0),M(G,null,W(t.subnets,b=>(d(),w(R,{key:b.id,label:b.network,value:b.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),i("div",gt,[e[9]||(e[9]=i("label",{class:"filter-label"},"状态筛选",-1)),a(O,{modelValue:t.filters.status,"onUpdate:modelValue":e[2]||(e[2]=b=>t.filters.status=b),placeholder:"选择状态",clearable:"",onChange:t.handleFilterChange,size:"default"},{default:s(()=>[a(R,{label:"可用",value:"available"}),a(R,{label:"使用中",value:"allocated"}),a(R,{label:"保留",value:"reserved"}),a(R,{label:"冲突",value:"conflict"})]),_:1},8,["modelValue","onChange"])]),i("div",vt,[e[10]||(e[10]=i("label",{class:"filter-label"},"所属部门",-1)),a(O,{modelValue:t.filters.assigned_to,"onUpdate:modelValue":e[3]||(e[3]=b=>t.filters.assigned_to=b),placeholder:"选择部门",clearable:"",filterable:"","allow-create":"",onChange:t.handleFilterChange,size:"default"},{default:s(()=>[(d(!0),M(G,null,W(t.departments,b=>(d(),w(R,{key:b,label:b,value:b},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),i("div",bt,[a(V,{type:"primary",onClick:t.handleSearch,loading:t.searching,size:"default"},{default:s(()=>[a(P,null,{default:s(()=>[a(C)]),_:1}),e[11]||(e[11]=m(" 搜索 ",-1))]),_:1},8,["onClick","loading"]),a(V,{onClick:t.handleReset,size:"default"},{default:s(()=>[a(P,null,{default:s(()=>[a(B)]),_:1}),e[12]||(e[12]=m(" 重置 ",-1))]),_:1},8,["onClick"])])])])]),t.hasActiveFilters?(d(),M("div",yt,[e[13]||(e[13]=i("span",{class:"filter-label"},"当前筛选：",-1)),t.filters.subnet_id?(d(),w(z,{key:0,closable:"",onClose:e[4]||(e[4]=b=>t.clearFilter("subnet_id")),type:"primary",size:"small"},{default:s(()=>[m(" 网段: "+I(t.getSubnetName(t.filters.subnet_id)),1)]),_:1})):T("",!0),t.filters.status?(d(),w(z,{key:1,closable:"",onClose:e[5]||(e[5]=b=>t.clearFilter("status")),type:"success",size:"small"},{default:s(()=>[m(" 状态: "+I(t.getStatusText(t.filters.status)),1)]),_:1})):T("",!0),t.filters.assigned_to?(d(),w(z,{key:2,closable:"",onClose:e[6]||(e[6]=b=>t.clearFilter("assigned_to")),type:"warning",size:"small"},{default:s(()=>[m(" 部门: "+I(t.filters.assigned_to),1)]),_:1})):T("",!0),t.searchQuery?(d(),w(z,{key:3,closable:"",onClose:t.clearSearch,type:"info",size:"small"},{default:s(()=>[m(" 关键词: "+I(t.searchQuery),1)]),_:1},8,["onClose"])):T("",!0)])):T("",!0)])}const kt=ce(dt,[["render",ht],["__scopeId","data-v-6be62758"]]);const wt={name:"IPManagement",components:{AppLayout:it,Plus:tt,Operation:lt,Refresh:fe,Search:pe,SimpleIPFilter:kt},setup(){const r=at(),e=se(()=>r.getters["auth/currentUser"]),Q=se(()=>r.getters["auth/userRole"]),t=se(()=>{var o;return((o=Q.value)==null?void 0:o.toLowerCase())==="admin"}),Y=g(!1),k=g(!1),C=g(!1),P=g([]),v=g([]),R=g([]),O=g([]),V=g([]),B=g([]),z=g(""),b=g(""),N=g(""),_=g(1),H=g(50),u=g(0),F=g({total:0,available:0,allocated:0,reserved:0,utilization_rate:0}),E=g(!1),j=g(!1),f=g(!1),S=g(!1),X=g(!1),h=g(!1),D=g(!1),q=te({subnet_id:"",preferred_ip:"",mac_address:"",user_name:"",device_type:"",location:"",assigned_to:"",description:"",allocated_at:null}),le=te({ip_address:"",reason:""}),ae=te({ip_address:"",reason:""}),K=te({operation:"reserve",reason:""}),l=te({ip_address:"",reason:""}),A=te({ip_address:"",mac_address:"",user_name:"",device_type:"",assigned_to:"",description:"",allocated_at:null}),ve={subnet_id:[{required:!0,message:"请选择网段",trigger:"change"}],user_name:[{required:!0,message:"请填写使用人",trigger:"blur"}],device_type:[{required:!0,message:"请选择设备类型",trigger:"change"}],assigned_to:[{required:!0,message:"请选择使用部门",trigger:"change"}],allocated_at:[{required:!0,message:"请选择分配时间",trigger:"change"}],mac_address:[{pattern:/^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/,message:"MAC地址格式不正确",trigger:"blur"}]},be={reason:[{required:!0,message:"请填写保留原因",trigger:"blur"}]},ye={reason:[{required:!0,message:"请填写释放原因",trigger:"blur"}]},he={operation:[{required:!0,message:"请选择操作类型",trigger:"change"}],reason:[{required:!0,message:"请填写操作原因",trigger:"blur"}]},ke={reason:[{required:!0,message:"请填写删除原因",trigger:"blur"}]},we={user_name:[{required:!0,message:"请填写使用人",trigger:"blur"}],device_type:[{required:!0,message:"请选择设备类型",trigger:"change"}],assigned_to:[{required:!0,message:"请选择使用部门",trigger:"change"}],mac_address:[{pattern:/^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/,message:"MAC地址格式不正确",trigger:"blur"}]},Z=async()=>{Y.value=!0;try{const o={skip:(_.value-1)*H.value,limit:H.value};z.value&&(o.query=z.value),b.value&&(o.status=b.value),N.value&&(o.subnet_id=N.value);const n=await L.searchIPs(o);P.value=n.data||n||[],u.value=P.value.length>=H.value?_.value*H.value+1:(_.value-1)*H.value+P.value.length}catch(o){U.error("加载IP地址列表失败："+o.message)}finally{Y.value=!1}},Ce=async()=>{try{const o=await ge.getSubnets();v.value=o.subnets||o.data||[]}catch(o){U.error("加载网段列表失败："+o.message)}},Fe=async()=>{R.value=["技术部","运维部","产品部","市场部","人事部","财务部","客服部","测试部","设计部","销售部"];try{const o=await nt();if(o&&o.data&&o.data.departments){const n=o.data.departments.map(p=>p.name).sort();R.value=[...new Set([...R.value,...n])]}else if(o&&o.departments){const n=o.departments.map(p=>p.name).sort();R.value=[...new Set([...R.value,...n])]}}catch(o){console.error("从API加载部门列表失败，使用静态列表：",o)}},Ve=async()=>{try{const o=await rt();o&&o.data&&Array.isArray(o.data)?O.value=o.data.filter(n=>n.status==="active"):o&&Array.isArray(o)?O.value=o.filter(n=>n.status==="active"):O.value=[{code:"server",name:"服务器"},{code:"workstation",name:"工作站"},{code:"switch",name:"网络交换机"},{code:"router",name:"路由器"},{code:"printer",name:"打印机"},{code:"firewall",name:"防火墙"},{code:"other",name:"其他"}]}catch(o){console.error("加载设备类型列表失败：",o),O.value=[{code:"server",name:"服务器"},{code:"workstation",name:"工作站"},{code:"switch",name:"网络交换机"},{code:"router",name:"路由器"},{code:"printer",name:"打印机"},{code:"firewall",name:"防火墙"},{code:"other",name:"其他"}]}},oe=async()=>{try{const o=await L.getStatistics(N.value||void 0),n=o.data||o||{};F.value={total:n.total_ips||0,available:n.available_ips||0,allocated:n.allocated_ips||0,reserved:n.reserved_ips||0,utilization_rate:n.utilization_rate||0}}catch(o){console.error("加载统计信息失败：",o)}},$=()=>{Z(),oe()},Se=()=>{_.value=1,Z()},De=()=>{_.value=1,Z(),oe()},re=async o=>{Y.value=!0;try{ee.value=o,z.value=o.query||"",b.value=o.status||"",N.value=o.subnet_id||"",_.value=1;const n={...o,skip:0,limit:H.value},p=await L.searchIPs(n);if(p.data&&Array.isArray(p.data)?(P.value=p.data,u.value=p.total||p.data.length):Array.isArray(p.data)?(P.value=p.data,u.value=p.data.length):Array.isArray(p)?(P.value=p,u.value=p.length):(P.value=[],u.value=0),Object.keys(o).length>0){const J=o.query,x=o.subnet_id||o.status||o.assigned_to}oe()}catch(n){U.error("搜索失败："+n.message)}finally{Y.value=!1}},Ie=()=>{ee.value=null,_.value=1,Z(),oe()},ee=g(null),Pe=o=>{H.value=o,_.value=1,ee.value?re(ee.value):Z()},Re=o=>{_.value=o,ee.value?re(ee.value):Z()},Ae=o=>{V.value=o},xe=o=>{const n=V.value.findIndex(p=>p.id===o.id);n>-1&&V.value.splice(n,1)},Ue=o=>{o&&(q.subnet_id=o.subnet_id,q.preferred_ip=o.ip_address);const n=new Date,p=n.getFullYear(),J=String(n.getMonth()+1).padStart(2,"0"),x=String(n.getDate()).padStart(2,"0"),ne=String(n.getHours()).padStart(2,"0"),ie=String(n.getMinutes()).padStart(2,"0"),de=String(n.getSeconds()).padStart(2,"0");q.allocated_at=`${p}-${J}-${x} ${ne}:${ie}:${de}`,E.value=!0},ze=o=>{le.ip_address=o.ip_address,j.value=!0},Me=o=>{ae.ip_address=o.ip_address,f.value=!0},Oe=o=>{l.ip_address=o.ip_address,h.value=!0},Ee=o=>{A.ip_address=o.ip_address,A.mac_address=o.mac_address||"",A.user_name=o.user_name||"",A.device_type=o.device_type||"",A.assigned_to=o.assigned_to||"",A.description=o.description||"",A.allocated_at=o.allocated_at||null,D.value=!0,setTimeout(()=>{ue()},100)},ue=()=>{const o=document.documentElement.getAttribute("data-theme")==="dark";if(!o)return;document.querySelectorAll(".el-select-dropdown").forEach(p=>{p.style.backgroundColor="#1d1e1f",p.style.borderColor="#414243",p.style.color="#e5eaf3",p.querySelectorAll(".el-select-dropdown__item").forEach(x=>{x.style.color="#e5eaf3",x.style.backgroundColor="transparent",x.addEventListener("mouseenter",()=>{o&&(x.style.backgroundColor="#262727")}),x.addEventListener("mouseleave",()=>{o&&!x.classList.contains("selected")&&(x.style.backgroundColor="transparent")}),x.classList.contains("selected")&&(x.style.backgroundColor="#409eff",x.style.color="#ffffff")})})},qe=async o=>{C.value=!0,X.value=!0;try{const n=await L.getIPHistory(o.ip_address);B.value=n.data||[]}catch(n){U.error("加载历史记录失败："+n.message)}finally{C.value=!1}},He=async()=>{k.value=!0;try{const o={...q};if(o.allocated_at){const n=new Date(o.allocated_at);o.allocated_at=n.toISOString()}console.log("提交分配数据:",o),await L.allocateIP(o),U.success("IP地址分配成功"),E.value=!1,$()}catch(o){console.error("分配失败:",o),U.error("分配失败："+o.message)}finally{k.value=!1}},Te=async()=>{k.value=!0;try{await L.reserveIP(le),U.success("IP地址保留成功"),j.value=!1,$()}catch(o){U.error("保留失败："+o.message)}finally{k.value=!1}},Ye=async()=>{k.value=!0;try{await L.releaseIP(ae),U.success("IP地址释放成功"),f.value=!1,$()}catch(o){U.error("释放失败："+o.message)}finally{k.value=!1}},Be=()=>{switch(K.operation){case"reserve":return"warning";case"release":return"danger";case"delete":return"danger";default:return"primary"}},Le=async()=>{if(V.value.length===0){U.warning("请选择要操作的IP地址");return}k.value=!0;try{const n={ip_addresses:V.value.map(x=>x.ip_address),operation:K.operation,reason:K.reason},p=await L.bulkOperation(n),J=p.data||p;U.success(`批量操作完成：成功${J.success_count}个，失败${J.failed_count}个`),S.value=!1,V.value=[],$()}catch(o){U.error("批量操作失败："+o.message)}finally{k.value=!1}},Ne=()=>{Object.assign(q,{subnet_id:"",preferred_ip:"",mac_address:"",user_name:"",device_type:"",location:"",assigned_to:"",description:"",allocated_at:null})},je=()=>{Object.assign(le,{ip_address:"",reason:""})},Qe=()=>{Object.assign(ae,{ip_address:"",reason:""})},Ke=()=>{Object.assign(K,{operation:"reserve",reason:""})},Je=o=>({available:"success",allocated:"primary",reserved:"warning",conflict:"danger"})[o]||"info",Ge=o=>({available:{backgroundColor:"#f0f9ff",borderColor:"#67c23a",color:"#67c23a"},allocated:{backgroundColor:"#ecf5ff",borderColor:"#409eff",color:"#409eff"},reserved:{backgroundColor:"#fdf6ec",borderColor:"#e6a23c",color:"#e6a23c"},conflict:{backgroundColor:"#fef0f0",borderColor:"#f56c6c",color:"#f56c6c"}})[o]||{backgroundColor:"#f4f4f5",borderColor:"#909399",color:"#909399"},We=o=>({available:"可用",allocated:"使用中",reserved:"保留",conflict:"冲突"})[o]||o,Xe=o=>o?new Date(o).toLocaleString("zh-CN"):"-",Ze=o=>{if(!o)return"-";const n=O.value.find(p=>p.code===o);return n?n.name:o};return _e(()=>{Ce(),Fe(),Ve(),Z(),oe()}),{currentUser:e,userRole:Q,isAdmin:t,loading:Y,submitting:k,historyLoading:C,ipList:P,subnets:v,departments:R,deviceTypes:O,selectedIPs:V,historyData:B,searchQuery:z,statusFilter:b,subnetFilter:N,currentPage:_,pageSize:H,total:u,statistics:F,currentSearchParams:ee,showAllocationDialog:E,showReservationDialog:j,showReleaseDialog:f,showBulkDialog:S,showHistoryDialog:X,showDeleteDialog:h,showEditDialog:D,allocationForm:q,reservationForm:le,releaseForm:ae,bulkForm:K,deleteForm:l,editForm:A,allocationRules:ve,reservationRules:be,releaseRules:ye,bulkRules:he,deleteRules:ke,editRules:we,refreshData:$,handleSearch:Se,handleFilter:De,handleSimpleSearch:re,handleSearchReset:Ie,handleSizeChange:Pe,handleCurrentChange:Re,handleSelectionChange:Ae,removeSelectedIP:xe,allocateIP:Ue,reserveIP:ze,releaseIP:Me,deleteIP:Oe,editIP:Ee,fixDropdownStyles:ue,viewHistory:qe,submitAllocation:He,submitReservation:Te,submitRelease:Ye,submitBulkOperation:Le,submitDelete:async()=>{k.value=!0;try{await L.deleteIP(l),U.success("IP地址删除成功"),h.value=!1,$()}catch(o){U.error("删除失败："+o.message)}finally{k.value=!1}},submitEdit:async()=>{k.value=!0;try{const o={...A};if(o.allocated_at){const n=new Date(o.allocated_at),p=n.getFullYear(),J=String(n.getMonth()+1).padStart(2,"0"),x=String(n.getDate()).padStart(2,"0"),ne=String(n.getHours()).padStart(2,"0"),ie=String(n.getMinutes()).padStart(2,"0"),de=String(n.getSeconds()).padStart(2,"0");o.allocated_at=`${p}-${J}-${x} ${ne}:${ie}:${de}`}await L.updateIP(A.ip_address,o),U.success("IP地址修改成功"),D.value=!1,$()}catch(o){U.error("修改失败："+o.message)}finally{k.value=!1}},resetAllocationForm:Ne,resetReservationForm:je,resetReleaseForm:Qe,resetBulkForm:Ke,resetDeleteForm:()=>{Object.assign(l,{ip_address:"",reason:""})},resetEditForm:()=>{Object.assign(A,{ip_address:"",mac_address:"",user_name:"",device_type:"",assigned_to:"",description:"",allocated_at:null})},getBulkOperationButtonType:Be,getStatusTagType:Je,getStatusStyle:Ge,getStatusText:We,formatDate:Xe,getDeviceTypeName:Ze}}},Ct={class:"ip-management"},Ft={class:"header-section"},Vt={class:"header-actions"},St={class:"theme-stats-card"},Dt={class:"stats-item"},It={class:"stats-value"},Pt={class:"stats-item"},Rt={class:"stats-value"},At={class:"stats-item"},xt={class:"stats-value"},Ut={class:"stats-item"},zt={class:"stats-value"},Mt={class:"theme-table-section"},Ot={key:0,class:"search-status"},Et={class:"action-buttons"},qt={class:"pagination-section"},Ht={class:"selected-ips"},Tt={key:0,class:"no-selection"},Yt={key:0},Bt={key:1},Lt={key:0},Nt={key:1};function jt(r,e,Q,t,Y,k){const C=c("Plus"),P=c("el-icon"),v=c("el-button"),R=c("Operation"),O=c("Refresh"),V=c("SimpleIPFilter"),B=c("el-card"),z=c("el-col"),b=c("el-row"),N=c("el-alert"),_=c("el-table-column"),H=c("el-tag"),u=c("el-table"),F=c("el-pagination"),E=c("el-option"),j=c("el-select"),f=c("el-form-item"),S=c("el-input"),X=c("el-date-picker"),h=c("el-form"),D=c("el-dialog"),q=c("el-radio"),le=c("el-radio-group"),ae=c("AppLayout"),K=ot("loading");return d(),w(ae,null,{default:s(()=>[i("div",Ct,[i("div",Ft,[e[43]||(e[43]=i("h1",null,"IP地址管理",-1)),i("div",Vt,[a(v,{type:"primary",onClick:e[0]||(e[0]=l=>t.showAllocationDialog=!0)},{default:s(()=>[a(P,null,{default:s(()=>[a(C)]),_:1}),e[40]||(e[40]=m(" 分配地址 ",-1))]),_:1}),t.isAdmin?(d(),w(v,{key:0,type:"info",onClick:e[1]||(e[1]=l=>t.showBulkDialog=!0)},{default:s(()=>[a(P,null,{default:s(()=>[a(R)]),_:1}),e[41]||(e[41]=m(" 批量操作 ",-1))]),_:1})):T("",!0),a(v,{type:"info",onClick:t.refreshData},{default:s(()=>[a(P,null,{default:s(()=>[a(O)]),_:1}),e[42]||(e[42]=m(" 刷新 ",-1))]),_:1},8,["onClick"])])]),a(V,{onSearch:t.handleSimpleSearch,onReset:t.handleSearchReset},null,8,["onSearch","onReset"]),i("div",St,[a(b,{gutter:20},{default:s(()=>[a(z,{span:6},{default:s(()=>[a(B,{class:"theme-stats-card"},{default:s(()=>[i("div",Dt,[i("div",It,I(t.statistics.total),1),e[44]||(e[44]=i("div",{class:"stats-label"},"总IP数量",-1))])]),_:1})]),_:1}),a(z,{span:6},{default:s(()=>[a(B,{class:"theme-stats-card"},{default:s(()=>[i("div",Pt,[i("div",Rt,I(t.statistics.available),1),e[45]||(e[45]=i("div",{class:"stats-label"},"可用IP",-1))])]),_:1})]),_:1}),a(z,{span:6},{default:s(()=>[a(B,{class:"theme-stats-card"},{default:s(()=>[i("div",At,[i("div",xt,I(t.statistics.allocated),1),e[46]||(e[46]=i("div",{class:"stats-label"},"使用中",-1))])]),_:1})]),_:1}),a(z,{span:6},{default:s(()=>[a(B,{class:"theme-stats-card"},{default:s(()=>[i("div",Ut,[i("div",zt,I(t.statistics.utilization_rate)+"%",1),e[47]||(e[47]=i("div",{class:"stats-label"},"使用率",-1))])]),_:1})]),_:1})]),_:1})]),i("div",Mt,[t.currentSearchParams?(d(),M("div",Ot,[a(N,{title:`当前显示搜索结果：共 ${t.total} 条记录`,type:"info",closable:!1,"show-icon":""},{default:s(()=>[...e[48]||(e[48]=[i("span",null,'当前显示搜索结果，点击"重置"按钮可查看所有数据',-1)])]),_:1},8,["title"])])):T("",!0),me((d(),w(u,{data:t.ipList,stripe:"",onSelectionChange:t.handleSelectionChange},{default:s(()=>[a(_,{type:"selection",width:"70"}),a(_,{prop:"ip_address",label:"IP地址",width:"130",sortable:"",align:"center"}),a(_,{prop:"status",label:"状态",width:"120",align:"center"},{default:s(({row:l})=>[a(H,{type:t.getStatusTagType(l.status),size:"small",style:st(t.getStatusStyle(l.status))},{default:s(()=>[m(I(t.getStatusText(l.status)),1)]),_:2},1032,["type","style"])]),_:1}),a(_,{prop:"user_name",label:"使用人",width:"120",align:"center"},{default:s(({row:l})=>[i("span",null,I(l.user_name||"-"),1)]),_:1}),a(_,{prop:"mac_address",label:"MAC地址",width:"160",align:"center"},{default:s(({row:l})=>[i("span",null,I(l.mac_address||"-"),1)]),_:1}),a(_,{prop:"device_type",label:"设备类型",width:"140",align:"center"},{default:s(({row:l})=>[i("span",null,I(l.device_type||"-"),1)]),_:1}),a(_,{prop:"assigned_to",label:"所属部门",width:"140",align:"center"},{default:s(({row:l})=>[i("span",null,I(l.assigned_to||"-"),1)]),_:1}),a(_,{prop:"description",label:"描述",width:"200","show-overflow-tooltip":"",align:"center"},{default:s(({row:l})=>[i("span",null,I(l.description||"-"),1)]),_:1}),a(_,{prop:"allocated_at",label:"分配时间",width:"220",align:"center"},{default:s(({row:l})=>[i("span",null,I(l.allocated_at?t.formatDate(l.allocated_at):"-"),1)]),_:1}),a(_,{label:"操作",width:"280",fixed:"right",align:"center"},{default:s(({row:l})=>[i("div",Et,[l.status==="available"?(d(),w(v,{key:0,type:"primary",size:"small",onClick:A=>t.allocateIP(l)},{default:s(()=>[...e[49]||(e[49]=[m(" 分配 ",-1)])]),_:2},1032,["onClick"])):T("",!0),a(v,{type:"warning",size:"small",onClick:A=>t.editIP(l)},{default:s(()=>[...e[50]||(e[50]=[m(" 编辑 ",-1)])]),_:2},1032,["onClick"]),l.status==="available"?(d(),w(v,{key:1,type:"warning",size:"small",onClick:A=>t.reserveIP(l)},{default:s(()=>[...e[51]||(e[51]=[m(" 保留 ",-1)])]),_:2},1032,["onClick"])):T("",!0),l.status==="allocated"||l.status==="reserved"?(d(),w(v,{key:2,type:"danger",size:"small",onClick:A=>t.releaseIP(l)},{default:s(()=>[...e[52]||(e[52]=[m(" 释放 ",-1)])]),_:2},1032,["onClick"])):T("",!0),(l.status==="available"||l.status==="reserved")&&t.isAdmin?(d(),w(v,{key:3,type:"danger",size:"small",plain:"",onClick:A=>t.deleteIP(l)},{default:s(()=>[...e[53]||(e[53]=[m(" 删除 ",-1)])]),_:2},1032,["onClick"])):T("",!0)])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[K,t.loading]]),i("div",qt,[a(F,{"current-page":t.currentPage,"onUpdate:currentPage":e[2]||(e[2]=l=>t.currentPage=l),"page-size":t.pageSize,"onUpdate:pageSize":e[3]||(e[3]=l=>t.pageSize=l),"page-sizes":[20,50,100,200],total:t.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),a(D,{modelValue:t.showAllocationDialog,"onUpdate:modelValue":e[13]||(e[13]=l=>t.showAllocationDialog=l),title:"分配地址",width:"600px",onClose:t.resetAllocationForm},{footer:s(()=>[a(v,{onClick:e[12]||(e[12]=l=>t.showAllocationDialog=!1)},{default:s(()=>[...e[55]||(e[55]=[m("取消",-1)])]),_:1}),a(v,{type:"primary",onClick:t.submitAllocation,loading:t.submitting},{default:s(()=>[...e[56]||(e[56]=[m(" 确认分配 ",-1)])]),_:1},8,["onClick","loading"])]),default:s(()=>[a(h,{ref:"allocationFormRef",model:t.allocationForm,rules:t.allocationRules,"label-width":"100px"},{default:s(()=>[a(f,{label:"网段",prop:"subnet_id"},{default:s(()=>[a(j,{modelValue:t.allocationForm.subnet_id,"onUpdate:modelValue":e[4]||(e[4]=l=>t.allocationForm.subnet_id=l),placeholder:"选择网段",style:{width:"100%"}},{default:s(()=>[(d(!0),M(G,null,W(t.subnets,l=>(d(),w(E,{key:l.id,label:l.network,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"首选IP",prop:"preferred_ip"},{default:s(()=>[a(S,{modelValue:t.allocationForm.preferred_ip,"onUpdate:modelValue":e[5]||(e[5]=l=>t.allocationForm.preferred_ip=l),placeholder:"留空自动分配"},null,8,["modelValue"])]),_:1}),a(f,{label:"MAC地址",prop:"mac_address"},{default:s(()=>[a(S,{modelValue:t.allocationForm.mac_address,"onUpdate:modelValue":e[6]||(e[6]=l=>t.allocationForm.mac_address=l),placeholder:"如：00:11:22:33:44:55"},null,8,["modelValue"])]),_:1}),a(f,{label:"使用人",prop:"user_name"},{default:s(()=>[a(S,{modelValue:t.allocationForm.user_name,"onUpdate:modelValue":e[7]||(e[7]=l=>t.allocationForm.user_name=l),placeholder:"使用人"},null,8,["modelValue"])]),_:1}),a(f,{label:"设备类型",prop:"device_type"},{default:s(()=>[a(j,{modelValue:t.allocationForm.device_type,"onUpdate:modelValue":e[8]||(e[8]=l=>t.allocationForm.device_type=l),placeholder:"选择设备类型",style:{width:"100%"}},{default:s(()=>[(d(!0),M(G,null,W(t.deviceTypes,l=>(d(),w(E,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"使用部门",prop:"assigned_to"},{default:s(()=>[a(j,{modelValue:t.allocationForm.assigned_to,"onUpdate:modelValue":e[9]||(e[9]=l=>t.allocationForm.assigned_to=l),placeholder:"选择部门",filterable:"","allow-create":"",style:{width:"100%"}},{default:s(()=>[(d(!0),M(G,null,W(t.departments,l=>(d(),w(E,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"分配时间",prop:"allocated_at"},{default:s(()=>[a(X,{modelValue:t.allocationForm.allocated_at,"onUpdate:modelValue":e[10]||(e[10]=l=>t.allocationForm.allocated_at=l),type:"datetime",placeholder:"选择分配时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"]),e[54]||(e[54]=i("div",{class:"form-tip"},"默认为当前时间，可手动修改",-1))]),_:1}),a(f,{label:"描述",prop:"description"},{default:s(()=>[a(S,{modelValue:t.allocationForm.description,"onUpdate:modelValue":e[11]||(e[11]=l=>t.allocationForm.description=l),type:"textarea",rows:3,placeholder:"备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),a(D,{modelValue:t.showReservationDialog,"onUpdate:modelValue":e[17]||(e[17]=l=>t.showReservationDialog=l),title:"保留IP地址",width:"500px",onClose:t.resetReservationForm},{footer:s(()=>[a(v,{onClick:e[16]||(e[16]=l=>t.showReservationDialog=!1)},{default:s(()=>[...e[57]||(e[57]=[m("取消",-1)])]),_:1}),a(v,{type:"warning",onClick:t.submitReservation,loading:t.submitting},{default:s(()=>[...e[58]||(e[58]=[m(" 确认保留 ",-1)])]),_:1},8,["onClick","loading"])]),default:s(()=>[a(h,{ref:"reservationFormRef",model:t.reservationForm,rules:t.reservationRules,"label-width":"100px"},{default:s(()=>[a(f,{label:"IP地址"},{default:s(()=>[a(S,{modelValue:t.reservationForm.ip_address,"onUpdate:modelValue":e[14]||(e[14]=l=>t.reservationForm.ip_address=l),disabled:""},null,8,["modelValue"])]),_:1}),a(f,{label:"保留原因",prop:"reason"},{default:s(()=>[a(S,{modelValue:t.reservationForm.reason,"onUpdate:modelValue":e[15]||(e[15]=l=>t.reservationForm.reason=l),type:"textarea",rows:3,placeholder:"请说明保留原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),a(D,{modelValue:t.showReleaseDialog,"onUpdate:modelValue":e[21]||(e[21]=l=>t.showReleaseDialog=l),title:"释放IP地址",width:"500px",onClose:t.resetReleaseForm},{footer:s(()=>[a(v,{onClick:e[20]||(e[20]=l=>t.showReleaseDialog=!1)},{default:s(()=>[...e[59]||(e[59]=[m("取消",-1)])]),_:1}),a(v,{type:"danger",onClick:t.submitRelease,loading:t.submitting},{default:s(()=>[...e[60]||(e[60]=[m(" 确认释放 ",-1)])]),_:1},8,["onClick","loading"])]),default:s(()=>[a(h,{ref:"releaseFormRef",model:t.releaseForm,rules:t.releaseRules,"label-width":"100px"},{default:s(()=>[a(f,{label:"IP地址"},{default:s(()=>[a(S,{modelValue:t.releaseForm.ip_address,"onUpdate:modelValue":e[18]||(e[18]=l=>t.releaseForm.ip_address=l),disabled:""},null,8,["modelValue"])]),_:1}),a(f,{label:"释放原因",prop:"reason"},{default:s(()=>[a(S,{modelValue:t.releaseForm.reason,"onUpdate:modelValue":e[19]||(e[19]=l=>t.releaseForm.reason=l),type:"textarea",rows:3,placeholder:"请说明释放原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),a(D,{modelValue:t.showBulkDialog,"onUpdate:modelValue":e[25]||(e[25]=l=>t.showBulkDialog=l),title:"批量操作",width:"600px",onClose:t.resetBulkForm},{footer:s(()=>[a(v,{onClick:e[24]||(e[24]=l=>t.showBulkDialog=!1)},{default:s(()=>[...e[64]||(e[64]=[m("取消",-1)])]),_:1}),a(v,{type:t.getBulkOperationButtonType(),onClick:t.submitBulkOperation,loading:t.submitting,disabled:t.selectedIPs.length===0},{default:s(()=>[...e[65]||(e[65]=[m(" 执行操作 ",-1)])]),_:1},8,["type","onClick","loading","disabled"])]),default:s(()=>[a(h,{ref:"bulkFormRef",model:t.bulkForm,rules:t.bulkRules,"label-width":"100px"},{default:s(()=>[a(f,{label:"操作类型",prop:"operation"},{default:s(()=>[a(le,{modelValue:t.bulkForm.operation,"onUpdate:modelValue":e[22]||(e[22]=l=>t.bulkForm.operation=l)},{default:s(()=>[a(q,{label:"reserve"},{default:s(()=>[...e[61]||(e[61]=[m("批量保留",-1)])]),_:1}),a(q,{label:"release"},{default:s(()=>[...e[62]||(e[62]=[m("批量释放",-1)])]),_:1}),t.isAdmin?(d(),w(q,{key:0,label:"delete"},{default:s(()=>[...e[63]||(e[63]=[m("批量删除",-1)])]),_:1})):T("",!0)]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"选中IP"},{default:s(()=>[i("div",Ht,[(d(!0),M(G,null,W(t.selectedIPs,l=>(d(),w(H,{key:l.id,closable:"",onClose:A=>t.removeSelectedIP(l)},{default:s(()=>[m(I(l.ip_address),1)]),_:2},1032,["onClose"]))),128)),t.selectedIPs.length===0?(d(),M("div",Tt," 请在表格中选择要操作的IP地址 ")):T("",!0)])]),_:1}),a(f,{label:"操作原因",prop:"reason"},{default:s(()=>[a(S,{modelValue:t.bulkForm.reason,"onUpdate:modelValue":e[23]||(e[23]=l=>t.bulkForm.reason=l),type:"textarea",rows:3,placeholder:"请说明操作原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),a(D,{modelValue:t.showDeleteDialog,"onUpdate:modelValue":e[29]||(e[29]=l=>t.showDeleteDialog=l),title:"删除IP地址",width:"500px",onClose:t.resetDeleteForm},{footer:s(()=>[a(v,{onClick:e[28]||(e[28]=l=>t.showDeleteDialog=!1)},{default:s(()=>[...e[67]||(e[67]=[m("取消",-1)])]),_:1}),a(v,{type:"danger",onClick:t.submitDelete,loading:t.submitting},{default:s(()=>[...e[68]||(e[68]=[m(" 确认删除 ",-1)])]),_:1},8,["onClick","loading"])]),default:s(()=>[a(h,{ref:"deleteFormRef",model:t.deleteForm,rules:t.deleteRules,"label-width":"100px"},{default:s(()=>[a(f,{label:"IP地址"},{default:s(()=>[a(S,{modelValue:t.deleteForm.ip_address,"onUpdate:modelValue":e[26]||(e[26]=l=>t.deleteForm.ip_address=l),disabled:""},null,8,["modelValue"])]),_:1}),a(f,{label:"删除原因",prop:"reason"},{default:s(()=>[a(S,{modelValue:t.deleteForm.reason,"onUpdate:modelValue":e[27]||(e[27]=l=>t.deleteForm.reason=l),type:"textarea",rows:3,placeholder:"请说明删除原因"},null,8,["modelValue"])]),_:1}),a(N,{title:"警告",type:"warning",closable:!1,"show-icon":""},{default:s(()=>[...e[66]||(e[66]=[i("p",null,"删除IP地址将永久移除该记录，此操作不可恢复！",-1),i("p",null,"请确认该IP地址未被使用且确实需要删除。",-1)])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),a(D,{modelValue:t.showEditDialog,"onUpdate:modelValue":e[38]||(e[38]=l=>t.showEditDialog=l),title:"编辑IP地址",width:"600px",onClose:t.resetEditForm},{footer:s(()=>[a(v,{onClick:e[37]||(e[37]=l=>t.showEditDialog=!1)},{default:s(()=>[...e[69]||(e[69]=[m("取消",-1)])]),_:1}),a(v,{type:"primary",onClick:t.submitEdit,loading:t.submitting},{default:s(()=>[...e[70]||(e[70]=[m(" 确认修改 ",-1)])]),_:1},8,["onClick","loading"])]),default:s(()=>[a(h,{ref:"editFormRef",model:t.editForm,rules:t.editRules,"label-width":"100px"},{default:s(()=>[a(f,{label:"IP地址"},{default:s(()=>[a(S,{modelValue:t.editForm.ip_address,"onUpdate:modelValue":e[30]||(e[30]=l=>t.editForm.ip_address=l),disabled:""},null,8,["modelValue"])]),_:1}),a(f,{label:"MAC地址",prop:"mac_address"},{default:s(()=>[a(S,{modelValue:t.editForm.mac_address,"onUpdate:modelValue":e[31]||(e[31]=l=>t.editForm.mac_address=l),placeholder:"如：00:11:22:33:44:55"},null,8,["modelValue"])]),_:1}),a(f,{label:"使用人",prop:"user_name"},{default:s(()=>[a(S,{modelValue:t.editForm.user_name,"onUpdate:modelValue":e[32]||(e[32]=l=>t.editForm.user_name=l),placeholder:"使用人"},null,8,["modelValue"])]),_:1}),a(f,{label:"设备类型",prop:"device_type"},{default:s(()=>[a(j,{modelValue:t.editForm.device_type,"onUpdate:modelValue":e[33]||(e[33]=l=>t.editForm.device_type=l),placeholder:"选择设备类型",style:{width:"100%"}},{default:s(()=>[(d(!0),M(G,null,W(t.deviceTypes,l=>(d(),w(E,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"使用部门",prop:"assigned_to"},{default:s(()=>[a(j,{modelValue:t.editForm.assigned_to,"onUpdate:modelValue":e[34]||(e[34]=l=>t.editForm.assigned_to=l),placeholder:"选择部门",filterable:"","allow-create":"",style:{width:"100%"},"popper-class":"dark-mode-select-dropdown"},{default:s(()=>[(d(!0),M(G,null,W(t.departments,l=>(d(),w(E,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"分配时间",prop:"allocated_at"},{default:s(()=>[a(X,{modelValue:t.editForm.allocated_at,"onUpdate:modelValue":e[35]||(e[35]=l=>t.editForm.allocated_at=l),type:"datetime",placeholder:"选择分配时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(f,{label:"描述",prop:"description"},{default:s(()=>[a(S,{modelValue:t.editForm.description,"onUpdate:modelValue":e[36]||(e[36]=l=>t.editForm.description=l),type:"textarea",rows:3,placeholder:"备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),a(D,{modelValue:t.showHistoryDialog,"onUpdate:modelValue":e[39]||(e[39]=l=>t.showHistoryDialog=l),title:"IP地址历史记录",width:"800px"},{default:s(()=>[me((d(),w(u,{data:t.historyData},{default:s(()=>[a(_,{prop:"action",label:"操作",width:"100"}),a(_,{prop:"username",label:"操作人",width:"120"}),a(_,{prop:"created_at",label:"操作时间",width:"160"},{default:s(({row:l})=>[m(I(t.formatDate(l.created_at)),1)]),_:1}),a(_,{prop:"old_values",label:"变更前","min-width":"200"},{default:s(({row:l})=>[l.old_values?(d(),M("pre",Yt,I(JSON.stringify(l.old_values,null,2)),1)):(d(),M("span",Bt,"-"))]),_:1}),a(_,{prop:"new_values",label:"变更后","min-width":"200"},{default:s(({row:l})=>[l.new_values?(d(),M("pre",Lt,I(JSON.stringify(l.new_values,null,2)),1)):(d(),M("span",Nt,"-"))]),_:1})]),_:1},8,["data"])),[[K,t.historyLoading]])]),_:1},8,["modelValue"])])]),_:1})}const ll=ce(wt,[["render",jt],["__scopeId","data-v-b8d435cb"]]);export{ll as default};
