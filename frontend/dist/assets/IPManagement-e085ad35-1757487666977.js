import{s as g,_ as ie,M as de,A as ue,f as _,g as $,h as se,j as ce,r as c,o as d,c as U,a as i,b as l,w as s,d as Je,F as ee,q as te,p as I,e as m,t as V,u as M,N as Ge,O as We,P as Xe,I as Ze,J as $e,E as x,K as ne,Q as et}from"./index-9c6477ff-1757487666975.js";import{s as me}from"./subnet-b974a625-1757487667213.js";import{g as tt}from"./deviceTypes-15340867-1757487667215.js";import{getDepartmentOptions as lt}from"./departments-7778efac-1757487667213.js";import{A as at}from"./AppLayout-bae8690e-1757487667213.js";import"./ThemeToggle-d445fee0-1757487667116.js";const N={getIPs(r={}){return g({url:"/ips",method:"get",params:r})},searchIPs(r={}){return g({url:"/ips/search",method:"get",params:r})},advancedSearchIPs(r){return g({url:"/ips/advanced-search",method:"post",data:r})},allocateIP(r){return g({url:"/ips/allocate",method:"post",data:r})},reserveIP(r){return g({url:"/ips/reserve",method:"post",data:r})},releaseIP(r){return g({url:"/ips/release",method:"post",data:r})},getStatistics(r=null){const e={};return r&&(e.subnet_id=r),g({url:"/ips/statistics",method:"get",params:e})},getConflicts(r=null){const e={};return r&&(e.subnet_id=r),g({url:"/ips/conflicts",method:"get",params:e})},getRangeStatus(r){return g({url:"/ips/range-status",method:"post",data:r})},bulkOperation(r){return g({url:"/ips/bulk-operation",method:"post",data:r})},getIPHistory(r){return g({url:`/ips/${r}/history`,method:"get"})},syncSubnetIPs(r,e){return g({url:"/ips/sync",method:"post",data:{subnet_id:r,network:e}})},getAvailableIPs(r,e=10){return g({url:"/ips/available",method:"get",params:{subnet_id:r,limit:e}})},validateIP(r){return g({url:"/ips/validate",method:"post",data:{ip_address:r}})},getIPDetail(r){return g({url:`/ips/${r}`,method:"get"})},updateIP(r,e){return g({url:`/ips/${r}`,method:"put",data:e})},exportIPs(r={}){return g({url:"/ips/export",method:"get",params:r,responseType:"blob"})},importIPs(r){return g({url:"/ips/import",method:"post",data:r,headers:{"Content-Type":"multipart/form-data"}})},getSearchHistory(r=20){return g({url:"/ips/search-history",method:"get",params:{limit:r}})},getSearchFavorites(){return g({url:"/ips/search-favorites",method:"get"})},saveSearchHistory(r){return g({url:"/ips/search-history",method:"post",data:r})},toggleSearchFavorite(r){return g({url:`/ips/search-history/${r}/favorite`,method:"put"})},updateSearchName(r,e){return g({url:`/ips/search-history/${r}/name`,method:"put",params:{search_name:e}})},deleteSearchHistory(r){return g({url:`/ips/search-history/${r}`,method:"delete"})},getDepartments(){return g({url:"/ips/departments",method:"get"})},deleteIP(r){return g({url:"/ips/delete",method:"delete",data:r})}};const ot={name:"SimpleIPFilter",components:{Search:de,Refresh:ue},emits:["search","reset"],setup(r,{emit:e}){const Q=_(!1),t=_(""),q=_([]),S=_([]),w=$({subnet_id:null,status:null,assigned_to:null}),P=se(()=>w.subnet_id||w.status||w.assigned_to||t.value),v=async()=>{try{const u=await me.getSubnets();q.value=u.subnets||u.data||[]}catch(u){console.error("加载网段列表失败：",u)}},D=async()=>{try{const{getDepartmentOptions:u}=await Ge(()=>import("./departments-7778efac-1757487667213.js"),["assets/departments-7778efac-1757487667213.js","assets/index-9c6477ff-1757487666975.js","assets/index-d4e297f7-1757487667282.css"]),k=await u();if(k&&k.data&&k.data.departments){const y=k.data.departments.map(h=>h.name).sort();S.value=y;return}else if(k&&k.departments){const y=k.departments.map(h=>h.name).sort();S.value=y;return}const T=await N.searchIPs({status:"allocated",limit:1e3}),b=(T.data||T||[]).map(y=>y.assigned_to).filter(y=>y&&y.trim()).filter((y,h,B)=>B.indexOf(y)===h).sort(),W=[...["技术部","运维部","产品部","市场部","人事部","财务部","客服部"],...b].filter((y,h,B)=>B.indexOf(y)===h).sort();S.value=W}catch(u){console.error("加载部门列表失败：",u),S.value=["技术部","运维部","产品部","市场部","人事部","财务部","客服部"]}},z=()=>{F()},F=()=>{Q.value=!0;const u={query:t.value||void 0,subnet_id:w.subnet_id||void 0,status:w.status||void 0,assigned_to:w.assigned_to||void 0};Object.keys(u).forEach(k=>{(u[k]===void 0||u[k]==="")&&delete u[k]}),e("search",u),setTimeout(()=>{Q.value=!1},500)},H=()=>{t.value&&t.value.length>=2?F():t.value||F()},R=()=>{w.subnet_id=null,w.status=null,w.assigned_to=null,t.value="",e("reset")},f=u=>{w[u]=null,F()},L=()=>{t.value="",F()},p=u=>{const k=q.value.find(T=>T.id===u);return k?k.network:`网段${u}`},O=u=>({available:"可用",allocated:"使用中",reserved:"保留",conflict:"冲突"})[u]||u;return ce(()=>{v(),D()}),{searching:Q,searchQuery:t,subnets:q,departments:S,filters:w,hasActiveFilters:P,handleFilterChange:z,handleSearch:F,handleQuickSearch:H,handleReset:R,clearFilter:f,clearSearch:L,getSubnetName:p,getStatusText:O}}},st={class:"simple-ip-filter"},rt={class:"filter-container"},nt={class:"theme-search-section"},it={class:"filter-row"},dt={class:"filter-item"},ut={class:"filter-item"},ct={class:"filter-item"},mt={class:"filter-item"},pt={class:"filter-actions"},ft={key:0,class:"active-filters"};function _t(r,e,Q,t,q,S){const w=c("Search"),P=c("el-icon"),v=c("el-input"),D=c("el-option"),z=c("el-select"),F=c("el-button"),H=c("Refresh"),R=c("el-tag");return d(),U("div",st,[i("div",rt,[i("div",nt,[i("div",it,[i("div",dt,[e[7]||(e[7]=i("label",{class:"filter-label"},"搜索关键词",-1)),l(v,{modelValue:t.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=f=>t.searchQuery=f),placeholder:"搜索IP地址、使用人、MAC地址...",onInput:t.handleQuickSearch,onKeyup:Je(t.handleSearch,["enter"]),clearable:"",size:"default"},{prefix:s(()=>[l(P,null,{default:s(()=>[l(w)]),_:1})]),_:1},8,["modelValue","onInput","onKeyup"])]),i("div",ut,[e[8]||(e[8]=i("label",{class:"filter-label"},"网段筛选",-1)),l(z,{modelValue:t.filters.subnet_id,"onUpdate:modelValue":e[1]||(e[1]=f=>t.filters.subnet_id=f),placeholder:"选择网段",clearable:"",onChange:t.handleFilterChange,size:"default"},{default:s(()=>[(d(!0),U(ee,null,te(t.subnets,f=>(d(),I(D,{key:f.id,label:f.network,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),i("div",ct,[e[9]||(e[9]=i("label",{class:"filter-label"},"状态筛选",-1)),l(z,{modelValue:t.filters.status,"onUpdate:modelValue":e[2]||(e[2]=f=>t.filters.status=f),placeholder:"选择状态",clearable:"",onChange:t.handleFilterChange,size:"default"},{default:s(()=>[l(D,{label:"可用",value:"available"}),l(D,{label:"使用中",value:"allocated"}),l(D,{label:"保留",value:"reserved"}),l(D,{label:"冲突",value:"conflict"})]),_:1},8,["modelValue","onChange"])]),i("div",mt,[e[10]||(e[10]=i("label",{class:"filter-label"},"所属部门",-1)),l(z,{modelValue:t.filters.assigned_to,"onUpdate:modelValue":e[3]||(e[3]=f=>t.filters.assigned_to=f),placeholder:"选择部门",clearable:"",filterable:"","allow-create":"",onChange:t.handleFilterChange,size:"default"},{default:s(()=>[(d(!0),U(ee,null,te(t.departments,f=>(d(),I(D,{key:f,label:f,value:f},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),i("div",pt,[l(F,{type:"primary",onClick:t.handleSearch,loading:t.searching,size:"default"},{default:s(()=>[l(P,null,{default:s(()=>[l(w)]),_:1}),e[11]||(e[11]=m(" 搜索 ",-1))]),_:1},8,["onClick","loading"]),l(F,{onClick:t.handleReset,size:"default"},{default:s(()=>[l(P,null,{default:s(()=>[l(H)]),_:1}),e[12]||(e[12]=m(" 重置 ",-1))]),_:1},8,["onClick"])])])])]),t.hasActiveFilters?(d(),U("div",ft,[e[13]||(e[13]=i("span",{class:"filter-label"},"当前筛选：",-1)),t.filters.subnet_id?(d(),I(R,{key:0,closable:"",onClose:e[4]||(e[4]=f=>t.clearFilter("subnet_id")),type:"primary",size:"small"},{default:s(()=>[m(" 网段: "+V(t.getSubnetName(t.filters.subnet_id)),1)]),_:1})):M("",!0),t.filters.status?(d(),I(R,{key:1,closable:"",onClose:e[5]||(e[5]=f=>t.clearFilter("status")),type:"success",size:"small"},{default:s(()=>[m(" 状态: "+V(t.getStatusText(t.filters.status)),1)]),_:1})):M("",!0),t.filters.assigned_to?(d(),I(R,{key:2,closable:"",onClose:e[6]||(e[6]=f=>t.clearFilter("assigned_to")),type:"warning",size:"small"},{default:s(()=>[m(" 部门: "+V(t.filters.assigned_to),1)]),_:1})):M("",!0),t.searchQuery?(d(),I(R,{key:3,closable:"",onClose:t.clearSearch,type:"info",size:"small"},{default:s(()=>[m(" 关键词: "+V(t.searchQuery),1)]),_:1},8,["onClose"])):M("",!0)])):M("",!0)])}const gt=ie(ot,[["render",_t],["__scopeId","data-v-6be62758"]]);const vt={name:"IPManagement",components:{AppLayout:at,Plus:We,Operation:Xe,Refresh:ue,Search:de,SimpleIPFilter:gt},setup(){const r=Ze(),e=se(()=>r.getters["auth/currentUser"]),Q=se(()=>r.getters["auth/userRole"]),t=se(()=>{var o;return((o=Q.value)==null?void 0:o.toLowerCase())==="admin"}),q=_(!1),S=_(!1),w=_(!1),P=_([]),v=_([]),D=_([]),z=_([]),F=_([]),H=_([]),R=_(""),f=_(""),L=_(""),p=_(1),O=_(50),u=_(0),k=_({total:0,available:0,allocated:0,reserved:0,utilization_rate:0}),T=_(!1),j=_(!1),b=_(!1),A=_(!1),W=_(!1),y=_(!1),h=$({subnet_id:"",preferred_ip:"",mac_address:"",user_name:"",device_type:"",location:"",assigned_to:"",description:"",allocated_at:null}),B=$({ip_address:"",reason:""}),X=$({ip_address:"",reason:""}),Y=$({operation:"reserve",reason:""}),E=$({ip_address:"",reason:""}),a={subnet_id:[{required:!0,message:"请选择网段",trigger:"change"}],user_name:[{required:!0,message:"请填写使用人",trigger:"blur"}],device_type:[{required:!0,message:"请选择设备类型",trigger:"change"}],assigned_to:[{required:!0,message:"请选择使用部门",trigger:"change"}],allocated_at:[{required:!0,message:"请选择分配时间",trigger:"change"}],mac_address:[{pattern:/^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/,message:"MAC地址格式不正确",trigger:"blur"}]},K={reason:[{required:!0,message:"请填写保留原因",trigger:"blur"}]},pe={reason:[{required:!0,message:"请填写释放原因",trigger:"blur"}]},fe={operation:[{required:!0,message:"请选择操作类型",trigger:"change"}],reason:[{required:!0,message:"请填写操作原因",trigger:"blur"}]},_e={reason:[{required:!0,message:"请填写删除原因",trigger:"blur"}]},J=async()=>{q.value=!0;try{const o={skip:(p.value-1)*O.value,limit:O.value};R.value&&(o.query=R.value),f.value&&(o.status=f.value),L.value&&(o.subnet_id=L.value);const n=await N.searchIPs(o);P.value=n.data||n||[],u.value=P.value.length>=O.value?p.value*O.value+1:(p.value-1)*O.value+P.value.length}catch(o){x.error("加载IP地址列表失败："+o.message)}finally{q.value=!1}},ge=async()=>{try{const o=await me.getSubnets();v.value=o.subnets||o.data||[]}catch(o){x.error("加载网段列表失败："+o.message)}},ve=async()=>{try{const o=await lt();o&&o.data&&o.data.departments?D.value=o.data.departments.map(n=>n.name).sort():o&&o.departments?D.value=o.departments.map(n=>n.name).sort():D.value=["技术部","运维部","产品部","市场部","人事部","财务部","客服部"]}catch(o){console.error("加载部门列表失败：",o),D.value=["技术部","运维部","产品部","市场部","人事部","财务部","客服部"]}},be=async()=>{try{const o=await tt();o&&o.data&&Array.isArray(o.data)?z.value=o.data.filter(n=>n.status==="active"):o&&Array.isArray(o)?z.value=o.filter(n=>n.status==="active"):z.value=[{code:"server",name:"服务器"},{code:"workstation",name:"工作站"},{code:"switch",name:"网络交换机"},{code:"router",name:"路由器"},{code:"printer",name:"打印机"},{code:"firewall",name:"防火墙"},{code:"other",name:"其他"}]}catch(o){console.error("加载设备类型列表失败：",o),z.value=[{code:"server",name:"服务器"},{code:"workstation",name:"工作站"},{code:"switch",name:"网络交换机"},{code:"router",name:"路由器"},{code:"printer",name:"打印机"},{code:"firewall",name:"防火墙"},{code:"other",name:"其他"}]}},le=async()=>{try{const o=await N.getStatistics(L.value||void 0),n=o.data||o||{};k.value={total:n.total_ips||0,available:n.available_ips||0,allocated:n.allocated_ips||0,reserved:n.reserved_ips||0,utilization_rate:n.utilization_rate||0}}catch(o){console.error("加载统计信息失败：",o)}},Z=()=>{J(),le()},ye=()=>{p.value=1,J()},he=()=>{p.value=1,J(),le()},re=async o=>{q.value=!0;try{G.value=o,R.value=o.query||"",f.value=o.status||"",L.value=o.subnet_id||"",p.value=1;const n={...o,skip:0,limit:O.value},C=await N.searchIPs(n);if(C.data&&Array.isArray(C.data)?(P.value=C.data,u.value=C.total||C.data.length):Array.isArray(C.data)?(P.value=C.data,u.value=C.data.length):Array.isArray(C)?(P.value=C,u.value=C.length):(P.value=[],u.value=0),Object.keys(o).length>0){const ae=o.query,oe=o.subnet_id||o.status||o.assigned_to}le()}catch(n){x.error("搜索失败："+n.message)}finally{q.value=!1}},we=()=>{G.value=null,p.value=1,J(),le()},G=_(null),ke=o=>{O.value=o,p.value=1,G.value?re(G.value):J()},Ce=o=>{p.value=o,G.value?re(G.value):J()},Se=o=>{F.value=o},Fe=o=>{const n=F.value.findIndex(C=>C.id===o.id);n>-1&&F.value.splice(n,1)},Ve=o=>{o&&(h.subnet_id=o.subnet_id,h.preferred_ip=o.ip_address);const n=new Date,C=n.getFullYear(),ae=String(n.getMonth()+1).padStart(2,"0"),oe=String(n.getDate()).padStart(2,"0"),Ye=String(n.getHours()).padStart(2,"0"),Ee=String(n.getMinutes()).padStart(2,"0"),Ke=String(n.getSeconds()).padStart(2,"0");h.allocated_at=`${C}-${ae}-${oe} ${Ye}:${Ee}:${Ke}`,T.value=!0},Ie=o=>{B.ip_address=o.ip_address,j.value=!0},Pe=o=>{X.ip_address=o.ip_address,b.value=!0},De=o=>{E.ip_address=o.ip_address,y.value=!0},Re=async o=>{w.value=!0,W.value=!0;try{const n=await N.getIPHistory(o.ip_address);H.value=n.data||[]}catch(n){x.error("加载历史记录失败："+n.message)}finally{w.value=!1}},Ae=async()=>{S.value=!0;try{const o={...h};if(o.allocated_at){const n=new Date(o.allocated_at);o.allocated_at=n.toISOString()}console.log("提交分配数据:",o),await N.allocateIP(o),x.success("IP地址分配成功"),T.value=!1,Z()}catch(o){console.error("分配失败:",o),x.error("分配失败："+o.message)}finally{S.value=!1}},xe=async()=>{S.value=!0;try{await N.reserveIP(B),x.success("IP地址保留成功"),j.value=!1,Z()}catch(o){x.error("保留失败："+o.message)}finally{S.value=!1}},ze=async()=>{S.value=!0;try{await N.releaseIP(X),x.success("IP地址释放成功"),b.value=!1,Z()}catch(o){x.error("释放失败："+o.message)}finally{S.value=!1}},Ue=()=>{switch(Y.operation){case"reserve":return"warning";case"release":return"danger";case"delete":return"danger";default:return"primary"}},Oe=async()=>{if(F.value.length===0){x.warning("请选择要操作的IP地址");return}S.value=!0;try{const n={ip_addresses:F.value.map(oe=>oe.ip_address),operation:Y.operation,reason:Y.reason},C=await N.bulkOperation(n),ae=C.data||C;x.success(`批量操作完成：成功${ae.success_count}个，失败${ae.failed_count}个`),A.value=!1,F.value=[],Z()}catch(o){x.error("批量操作失败："+o.message)}finally{S.value=!1}},Me=()=>{Object.assign(h,{subnet_id:"",preferred_ip:"",mac_address:"",user_name:"",device_type:"",location:"",assigned_to:"",description:"",allocated_at:null})},Te=()=>{Object.assign(B,{ip_address:"",reason:""})},Be=()=>{Object.assign(X,{ip_address:"",reason:""})},qe=()=>{Object.assign(Y,{operation:"reserve",reason:""})},He=o=>({available:"success",allocated:"primary",reserved:"warning",conflict:"danger"})[o]||"info",Le=o=>({available:{backgroundColor:"#f0f9ff",borderColor:"#67c23a",color:"#67c23a"},allocated:{backgroundColor:"#ecf5ff",borderColor:"#409eff",color:"#409eff"},reserved:{backgroundColor:"#fdf6ec",borderColor:"#e6a23c",color:"#e6a23c"},conflict:{backgroundColor:"#fef0f0",borderColor:"#f56c6c",color:"#f56c6c"}})[o]||{backgroundColor:"#f4f4f5",borderColor:"#909399",color:"#909399"},Ne=o=>({available:"可用",allocated:"使用中",reserved:"保留",conflict:"冲突"})[o]||o,Qe=o=>o?new Date(o).toLocaleString("zh-CN"):"-",je=o=>{if(!o)return"-";const n=z.value.find(C=>C.code===o);return n?n.name:o};return ce(()=>{ge(),ve(),be(),J(),le()}),{currentUser:e,userRole:Q,isAdmin:t,loading:q,submitting:S,historyLoading:w,ipList:P,subnets:v,departments:D,deviceTypes:z,selectedIPs:F,historyData:H,searchQuery:R,statusFilter:f,subnetFilter:L,currentPage:p,pageSize:O,total:u,statistics:k,currentSearchParams:G,showAllocationDialog:T,showReservationDialog:j,showReleaseDialog:b,showBulkDialog:A,showHistoryDialog:W,showDeleteDialog:y,allocationForm:h,reservationForm:B,releaseForm:X,bulkForm:Y,deleteForm:E,allocationRules:a,reservationRules:K,releaseRules:pe,bulkRules:fe,deleteRules:_e,refreshData:Z,handleSearch:ye,handleFilter:he,handleSimpleSearch:re,handleSearchReset:we,handleSizeChange:ke,handleCurrentChange:Ce,handleSelectionChange:Se,removeSelectedIP:Fe,allocateIP:Ve,reserveIP:Ie,releaseIP:Pe,deleteIP:De,viewHistory:Re,submitAllocation:Ae,submitReservation:xe,submitRelease:ze,submitBulkOperation:Oe,submitDelete:async()=>{S.value=!0;try{await N.deleteIP(E),x.success("IP地址删除成功"),y.value=!1,Z()}catch(o){x.error("删除失败："+o.message)}finally{S.value=!1}},resetAllocationForm:Me,resetReservationForm:Te,resetReleaseForm:Be,resetBulkForm:qe,resetDeleteForm:()=>{Object.assign(E,{ip_address:"",reason:""})},getBulkOperationButtonType:Ue,getStatusTagType:He,getStatusStyle:Le,getStatusText:Ne,formatDate:Qe,getDeviceTypeName:je}}},bt={class:"ip-management"},yt={class:"header-section"},ht={class:"header-actions"},wt={class:"theme-stats-card"},kt={class:"stats-item"},Ct={class:"stats-value"},St={class:"stats-item"},Ft={class:"stats-value"},Vt={class:"stats-item"},It={class:"stats-value"},Pt={class:"stats-item"},Dt={class:"stats-value"},Rt={class:"theme-table-section"},At={key:0,class:"search-status"},xt={class:"action-buttons"},zt={class:"pagination-section"},Ut={class:"selected-ips"},Ot={key:0,class:"no-selection"},Mt={key:0},Tt={key:1},Bt={key:0},qt={key:1};function Ht(r,e,Q,t,q,S){const w=c("Plus"),P=c("el-icon"),v=c("el-button"),D=c("Operation"),z=c("Refresh"),F=c("SimpleIPFilter"),H=c("el-card"),R=c("el-col"),f=c("el-row"),L=c("el-alert"),p=c("el-table-column"),O=c("el-tag"),u=c("el-table"),k=c("el-pagination"),T=c("el-option"),j=c("el-select"),b=c("el-form-item"),A=c("el-input"),W=c("el-date-picker"),y=c("el-form"),h=c("el-dialog"),B=c("el-radio"),X=c("el-radio-group"),Y=c("AppLayout"),E=$e("loading");return d(),I(Y,null,{default:s(()=>[i("div",bt,[i("div",yt,[e[34]||(e[34]=i("h1",null,"IP地址管理",-1)),i("div",ht,[l(v,{type:"primary",onClick:e[0]||(e[0]=a=>t.showAllocationDialog=!0)},{default:s(()=>[l(P,null,{default:s(()=>[l(w)]),_:1}),e[31]||(e[31]=m(" 分配地址 ",-1))]),_:1}),t.isAdmin?(d(),I(v,{key:0,type:"info",onClick:e[1]||(e[1]=a=>t.showBulkDialog=!0)},{default:s(()=>[l(P,null,{default:s(()=>[l(D)]),_:1}),e[32]||(e[32]=m(" 批量操作 ",-1))]),_:1})):M("",!0),l(v,{type:"info",onClick:t.refreshData},{default:s(()=>[l(P,null,{default:s(()=>[l(z)]),_:1}),e[33]||(e[33]=m(" 刷新 ",-1))]),_:1},8,["onClick"])])]),l(F,{onSearch:t.handleSimpleSearch,onReset:t.handleSearchReset},null,8,["onSearch","onReset"]),i("div",wt,[l(f,{gutter:20},{default:s(()=>[l(R,{span:6},{default:s(()=>[l(H,{class:"theme-stats-card"},{default:s(()=>[i("div",kt,[i("div",Ct,V(t.statistics.total),1),e[35]||(e[35]=i("div",{class:"stats-label"},"总IP数量",-1))])]),_:1})]),_:1}),l(R,{span:6},{default:s(()=>[l(H,{class:"theme-stats-card"},{default:s(()=>[i("div",St,[i("div",Ft,V(t.statistics.available),1),e[36]||(e[36]=i("div",{class:"stats-label"},"可用IP",-1))])]),_:1})]),_:1}),l(R,{span:6},{default:s(()=>[l(H,{class:"theme-stats-card"},{default:s(()=>[i("div",Vt,[i("div",It,V(t.statistics.allocated),1),e[37]||(e[37]=i("div",{class:"stats-label"},"使用中",-1))])]),_:1})]),_:1}),l(R,{span:6},{default:s(()=>[l(H,{class:"theme-stats-card"},{default:s(()=>[i("div",Pt,[i("div",Dt,V(t.statistics.utilization_rate)+"%",1),e[38]||(e[38]=i("div",{class:"stats-label"},"使用率",-1))])]),_:1})]),_:1})]),_:1})]),i("div",Rt,[t.currentSearchParams?(d(),U("div",At,[l(L,{title:`当前显示搜索结果：共 ${t.total} 条记录`,type:"info",closable:!1,"show-icon":""},{default:s(()=>[...e[39]||(e[39]=[i("span",null,'当前显示搜索结果，点击"重置"按钮可查看所有数据',-1)])]),_:1},8,["title"])])):M("",!0),ne((d(),I(u,{data:t.ipList,stripe:"",onSelectionChange:t.handleSelectionChange},{default:s(()=>[l(p,{type:"selection",width:"70"}),l(p,{prop:"ip_address",label:"IP地址",width:"130",sortable:"",align:"center"}),l(p,{prop:"status",label:"状态",width:"120",align:"center"},{default:s(({row:a})=>[l(O,{type:t.getStatusTagType(a.status),size:"small",style:et(t.getStatusStyle(a.status))},{default:s(()=>[m(V(t.getStatusText(a.status)),1)]),_:2},1032,["type","style"])]),_:1}),l(p,{prop:"user_name",label:"使用人",width:"120",align:"center"},{default:s(({row:a})=>[i("span",null,V(a.user_name||"-"),1)]),_:1}),l(p,{prop:"mac_address",label:"MAC地址",width:"160",align:"center"},{default:s(({row:a})=>[i("span",null,V(a.mac_address||"-"),1)]),_:1}),l(p,{prop:"device_type",label:"设备类型",width:"140",align:"center"},{default:s(({row:a})=>[i("span",null,V(a.device_type||"-"),1)]),_:1}),l(p,{prop:"assigned_to",label:"所属部门",width:"140",align:"center"},{default:s(({row:a})=>[i("span",null,V(a.assigned_to||"-"),1)]),_:1}),l(p,{prop:"description",label:"描述",width:"200","show-overflow-tooltip":"",align:"center"},{default:s(({row:a})=>[i("span",null,V(a.description||"-"),1)]),_:1}),l(p,{prop:"allocated_at",label:"分配时间",width:"220",align:"center"},{default:s(({row:a})=>[i("span",null,V(a.allocated_at?t.formatDate(a.allocated_at):"-"),1)]),_:1}),l(p,{label:"操作",width:"280",fixed:"right",align:"center"},{default:s(({row:a})=>[i("div",xt,[a.status==="available"?(d(),I(v,{key:0,type:"primary",size:"small",onClick:K=>t.allocateIP(a)},{default:s(()=>[...e[40]||(e[40]=[m(" 分配 ",-1)])]),_:2},1032,["onClick"])):M("",!0),a.status==="available"?(d(),I(v,{key:1,type:"warning",size:"small",onClick:K=>t.reserveIP(a)},{default:s(()=>[...e[41]||(e[41]=[m(" 保留 ",-1)])]),_:2},1032,["onClick"])):M("",!0),a.status==="allocated"||a.status==="reserved"?(d(),I(v,{key:2,type:"danger",size:"small",onClick:K=>t.releaseIP(a)},{default:s(()=>[...e[42]||(e[42]=[m(" 释放 ",-1)])]),_:2},1032,["onClick"])):M("",!0),(a.status==="available"||a.status==="reserved")&&t.isAdmin?(d(),I(v,{key:3,type:"danger",size:"small",plain:"",onClick:K=>t.deleteIP(a)},{default:s(()=>[...e[43]||(e[43]=[m(" 删除 ",-1)])]),_:2},1032,["onClick"])):M("",!0),l(v,{type:"info",size:"small",onClick:K=>t.viewHistory(a)},{default:s(()=>[...e[44]||(e[44]=[m(" 历史 ",-1)])]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[E,t.loading]]),i("div",zt,[l(k,{"current-page":t.currentPage,"onUpdate:currentPage":e[2]||(e[2]=a=>t.currentPage=a),"page-size":t.pageSize,"onUpdate:pageSize":e[3]||(e[3]=a=>t.pageSize=a),"page-sizes":[20,50,100,200],total:t.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),l(h,{modelValue:t.showAllocationDialog,"onUpdate:modelValue":e[13]||(e[13]=a=>t.showAllocationDialog=a),title:"分配地址",width:"600px",onClose:t.resetAllocationForm},{footer:s(()=>[l(v,{onClick:e[12]||(e[12]=a=>t.showAllocationDialog=!1)},{default:s(()=>[...e[46]||(e[46]=[m("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:t.submitAllocation,loading:t.submitting},{default:s(()=>[...e[47]||(e[47]=[m(" 确认分配 ",-1)])]),_:1},8,["onClick","loading"])]),default:s(()=>[l(y,{ref:"allocationFormRef",model:t.allocationForm,rules:t.allocationRules,"label-width":"100px"},{default:s(()=>[l(b,{label:"网段",prop:"subnet_id"},{default:s(()=>[l(j,{modelValue:t.allocationForm.subnet_id,"onUpdate:modelValue":e[4]||(e[4]=a=>t.allocationForm.subnet_id=a),placeholder:"选择网段",style:{width:"100%"}},{default:s(()=>[(d(!0),U(ee,null,te(t.subnets,a=>(d(),I(T,{key:a.id,label:a.network,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"首选IP",prop:"preferred_ip"},{default:s(()=>[l(A,{modelValue:t.allocationForm.preferred_ip,"onUpdate:modelValue":e[5]||(e[5]=a=>t.allocationForm.preferred_ip=a),placeholder:"留空自动分配"},null,8,["modelValue"])]),_:1}),l(b,{label:"MAC地址",prop:"mac_address"},{default:s(()=>[l(A,{modelValue:t.allocationForm.mac_address,"onUpdate:modelValue":e[6]||(e[6]=a=>t.allocationForm.mac_address=a),placeholder:"如：00:11:22:33:44:55"},null,8,["modelValue"])]),_:1}),l(b,{label:"使用人",prop:"user_name"},{default:s(()=>[l(A,{modelValue:t.allocationForm.user_name,"onUpdate:modelValue":e[7]||(e[7]=a=>t.allocationForm.user_name=a),placeholder:"使用人"},null,8,["modelValue"])]),_:1}),l(b,{label:"设备类型",prop:"device_type"},{default:s(()=>[l(j,{modelValue:t.allocationForm.device_type,"onUpdate:modelValue":e[8]||(e[8]=a=>t.allocationForm.device_type=a),placeholder:"选择设备类型",style:{width:"100%"}},{default:s(()=>[(d(!0),U(ee,null,te(t.deviceTypes,a=>(d(),I(T,{key:a.code,label:a.name,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"使用部门",prop:"assigned_to"},{default:s(()=>[l(j,{modelValue:t.allocationForm.assigned_to,"onUpdate:modelValue":e[9]||(e[9]=a=>t.allocationForm.assigned_to=a),placeholder:"选择部门",filterable:"","allow-create":"",style:{width:"100%"}},{default:s(()=>[(d(!0),U(ee,null,te(t.departments,a=>(d(),I(T,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"分配时间",prop:"allocated_at"},{default:s(()=>[l(W,{modelValue:t.allocationForm.allocated_at,"onUpdate:modelValue":e[10]||(e[10]=a=>t.allocationForm.allocated_at=a),type:"datetime",placeholder:"选择分配时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"]),e[45]||(e[45]=i("div",{class:"form-tip"},"默认为当前时间，可手动修改",-1))]),_:1}),l(b,{label:"描述",prop:"description"},{default:s(()=>[l(A,{modelValue:t.allocationForm.description,"onUpdate:modelValue":e[11]||(e[11]=a=>t.allocationForm.description=a),type:"textarea",rows:3,placeholder:"备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),l(h,{modelValue:t.showReservationDialog,"onUpdate:modelValue":e[17]||(e[17]=a=>t.showReservationDialog=a),title:"保留IP地址",width:"500px",onClose:t.resetReservationForm},{footer:s(()=>[l(v,{onClick:e[16]||(e[16]=a=>t.showReservationDialog=!1)},{default:s(()=>[...e[48]||(e[48]=[m("取消",-1)])]),_:1}),l(v,{type:"warning",onClick:t.submitReservation,loading:t.submitting},{default:s(()=>[...e[49]||(e[49]=[m(" 确认保留 ",-1)])]),_:1},8,["onClick","loading"])]),default:s(()=>[l(y,{ref:"reservationFormRef",model:t.reservationForm,rules:t.reservationRules,"label-width":"100px"},{default:s(()=>[l(b,{label:"IP地址"},{default:s(()=>[l(A,{modelValue:t.reservationForm.ip_address,"onUpdate:modelValue":e[14]||(e[14]=a=>t.reservationForm.ip_address=a),disabled:""},null,8,["modelValue"])]),_:1}),l(b,{label:"保留原因",prop:"reason"},{default:s(()=>[l(A,{modelValue:t.reservationForm.reason,"onUpdate:modelValue":e[15]||(e[15]=a=>t.reservationForm.reason=a),type:"textarea",rows:3,placeholder:"请说明保留原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),l(h,{modelValue:t.showReleaseDialog,"onUpdate:modelValue":e[21]||(e[21]=a=>t.showReleaseDialog=a),title:"释放IP地址",width:"500px",onClose:t.resetReleaseForm},{footer:s(()=>[l(v,{onClick:e[20]||(e[20]=a=>t.showReleaseDialog=!1)},{default:s(()=>[...e[50]||(e[50]=[m("取消",-1)])]),_:1}),l(v,{type:"danger",onClick:t.submitRelease,loading:t.submitting},{default:s(()=>[...e[51]||(e[51]=[m(" 确认释放 ",-1)])]),_:1},8,["onClick","loading"])]),default:s(()=>[l(y,{ref:"releaseFormRef",model:t.releaseForm,rules:t.releaseRules,"label-width":"100px"},{default:s(()=>[l(b,{label:"IP地址"},{default:s(()=>[l(A,{modelValue:t.releaseForm.ip_address,"onUpdate:modelValue":e[18]||(e[18]=a=>t.releaseForm.ip_address=a),disabled:""},null,8,["modelValue"])]),_:1}),l(b,{label:"释放原因",prop:"reason"},{default:s(()=>[l(A,{modelValue:t.releaseForm.reason,"onUpdate:modelValue":e[19]||(e[19]=a=>t.releaseForm.reason=a),type:"textarea",rows:3,placeholder:"请说明释放原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),l(h,{modelValue:t.showBulkDialog,"onUpdate:modelValue":e[25]||(e[25]=a=>t.showBulkDialog=a),title:"批量操作",width:"600px",onClose:t.resetBulkForm},{footer:s(()=>[l(v,{onClick:e[24]||(e[24]=a=>t.showBulkDialog=!1)},{default:s(()=>[...e[55]||(e[55]=[m("取消",-1)])]),_:1}),l(v,{type:t.getBulkOperationButtonType(),onClick:t.submitBulkOperation,loading:t.submitting,disabled:t.selectedIPs.length===0},{default:s(()=>[...e[56]||(e[56]=[m(" 执行操作 ",-1)])]),_:1},8,["type","onClick","loading","disabled"])]),default:s(()=>[l(y,{ref:"bulkFormRef",model:t.bulkForm,rules:t.bulkRules,"label-width":"100px"},{default:s(()=>[l(b,{label:"操作类型",prop:"operation"},{default:s(()=>[l(X,{modelValue:t.bulkForm.operation,"onUpdate:modelValue":e[22]||(e[22]=a=>t.bulkForm.operation=a)},{default:s(()=>[l(B,{label:"reserve"},{default:s(()=>[...e[52]||(e[52]=[m("批量保留",-1)])]),_:1}),l(B,{label:"release"},{default:s(()=>[...e[53]||(e[53]=[m("批量释放",-1)])]),_:1}),t.isAdmin?(d(),I(B,{key:0,label:"delete"},{default:s(()=>[...e[54]||(e[54]=[m("批量删除",-1)])]),_:1})):M("",!0)]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"选中IP"},{default:s(()=>[i("div",Ut,[(d(!0),U(ee,null,te(t.selectedIPs,a=>(d(),I(O,{key:a.id,closable:"",onClose:K=>t.removeSelectedIP(a)},{default:s(()=>[m(V(a.ip_address),1)]),_:2},1032,["onClose"]))),128)),t.selectedIPs.length===0?(d(),U("div",Ot," 请在表格中选择要操作的IP地址 ")):M("",!0)])]),_:1}),l(b,{label:"操作原因",prop:"reason"},{default:s(()=>[l(A,{modelValue:t.bulkForm.reason,"onUpdate:modelValue":e[23]||(e[23]=a=>t.bulkForm.reason=a),type:"textarea",rows:3,placeholder:"请说明操作原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),l(h,{modelValue:t.showDeleteDialog,"onUpdate:modelValue":e[29]||(e[29]=a=>t.showDeleteDialog=a),title:"删除IP地址",width:"500px",onClose:t.resetDeleteForm},{footer:s(()=>[l(v,{onClick:e[28]||(e[28]=a=>t.showDeleteDialog=!1)},{default:s(()=>[...e[58]||(e[58]=[m("取消",-1)])]),_:1}),l(v,{type:"danger",onClick:t.submitDelete,loading:t.submitting},{default:s(()=>[...e[59]||(e[59]=[m(" 确认删除 ",-1)])]),_:1},8,["onClick","loading"])]),default:s(()=>[l(y,{ref:"deleteFormRef",model:t.deleteForm,rules:t.deleteRules,"label-width":"100px"},{default:s(()=>[l(b,{label:"IP地址"},{default:s(()=>[l(A,{modelValue:t.deleteForm.ip_address,"onUpdate:modelValue":e[26]||(e[26]=a=>t.deleteForm.ip_address=a),disabled:""},null,8,["modelValue"])]),_:1}),l(b,{label:"删除原因",prop:"reason"},{default:s(()=>[l(A,{modelValue:t.deleteForm.reason,"onUpdate:modelValue":e[27]||(e[27]=a=>t.deleteForm.reason=a),type:"textarea",rows:3,placeholder:"请说明删除原因"},null,8,["modelValue"])]),_:1}),l(L,{title:"警告",type:"warning",closable:!1,"show-icon":""},{default:s(()=>[...e[57]||(e[57]=[i("p",null,"删除IP地址将永久移除该记录，此操作不可恢复！",-1),i("p",null,"请确认该IP地址未被使用且确实需要删除。",-1)])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),l(h,{modelValue:t.showHistoryDialog,"onUpdate:modelValue":e[30]||(e[30]=a=>t.showHistoryDialog=a),title:"IP地址历史记录",width:"800px"},{default:s(()=>[ne((d(),I(u,{data:t.historyData},{default:s(()=>[l(p,{prop:"action",label:"操作",width:"100"}),l(p,{prop:"username",label:"操作人",width:"120"}),l(p,{prop:"created_at",label:"操作时间",width:"160"},{default:s(({row:a})=>[m(V(t.formatDate(a.created_at)),1)]),_:1}),l(p,{prop:"old_values",label:"变更前","min-width":"200"},{default:s(({row:a})=>[a.old_values?(d(),U("pre",Mt,V(JSON.stringify(a.old_values,null,2)),1)):(d(),U("span",Tt,"-"))]),_:1}),l(p,{prop:"new_values",label:"变更后","min-width":"200"},{default:s(({row:a})=>[a.new_values?(d(),U("pre",Bt,V(JSON.stringify(a.new_values,null,2)),1)):(d(),U("span",qt,"-"))]),_:1})]),_:1},8,["data"])),[[E,t.historyLoading]])]),_:1},8,["modelValue"])])]),_:1})}const Gt=ie(vt,[["render",Ht],["__scopeId","data-v-6b1edd0f"]]);export{Gt as default};
