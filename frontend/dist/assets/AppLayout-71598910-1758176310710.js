import{S as B,m as E,_ as N,r as l,o as p,z as f,w as s,a as o,f as u,x as I,b as n,c as T,d as x,y as S,T as A,F as j,K as R,U as H}from"./index-1a649ac5-1758176310446.js";const J={name:"UserProfile",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{activeTab:"profile",profileLoading:!1,passwordLoading:!1,profileForm:{email:""},passwordForm:{oldPassword:"",newPassword:"",confirmPassword:""},profileRules:{email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},passwordRules:{oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:8,message:"密码长度至少8位",trigger:"blur"},{validator:this.validatePassword,trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:this.validateConfirmPassword,trigger:"blur"}]}}},computed:{...B("auth",["currentUser"]),visible:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}},watch:{visible(t){t&&this.initForms()}},methods:{...E("auth",["updateProfile","changePassword"]),initForms(){this.profileForm={email:this.currentUser.email||""},this.resetPasswordForm()},resetPasswordForm(){this.passwordForm={oldPassword:"",newPassword:"",confirmPassword:""},this.$nextTick(()=>{this.$refs.passwordForm&&this.$refs.passwordForm.clearValidate()})},validatePassword(t,e,a){if(!e){a(new Error("请输入新密码"));return}const F=/[A-Z]/.test(e),r=/[a-z]/.test(e),i=/\d/.test(e);if(!F){a(new Error("密码必须包含至少一个大写字母"));return}if(!r){a(new Error("密码必须包含至少一个小写字母"));return}if(!i){a(new Error("密码必须包含至少一个数字"));return}a()},validateConfirmPassword(t,e,a){if(!e){a(new Error("请确认新密码"));return}if(e!==this.passwordForm.newPassword){a(new Error("两次输入的密码不一致"));return}a()},async handleUpdateProfile(){var t,e;try{if(!await this.$refs.profileForm.validate())return;this.profileLoading=!0,await this.updateProfile(this.profileForm),this.$message.success("个人信息更新成功")}catch(a){console.error("Update profile error:",a),this.$message.error(((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.detail)||"更新个人信息失败")}finally{this.profileLoading=!1}},async handleChangePassword(){var t,e;try{if(!await this.$refs.passwordForm.validate())return;this.passwordLoading=!0,await this.changePassword({old_password:this.passwordForm.oldPassword,new_password:this.passwordForm.newPassword}),this.$message.success("密码修改成功"),this.resetPasswordForm(),this.activeTab="profile"}catch(a){console.error("Change password error:",a),this.$message.error(((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.detail)||"密码修改失败")}finally{this.passwordLoading=!1}},handleClose(){this.visible=!1,this.activeTab="profile",this.resetPasswordForm()},getRoleType(t){return{admin:"danger",manager:"warning",user:"info"}[t]||"info"},getRoleText(t){return{admin:"超级管理员",manager:"管理员",user:"普通用户"}[t]||"未知角色"}}},Q={class:"dialog-footer"},X={class:"dialog-footer"};function Y(t,e,a,F,r,i){const w=l("el-input"),_=l("el-form-item"),d=l("el-tag"),h=l("el-form"),c=l("el-button"),y=l("el-tab-pane"),P=l("el-alert"),v=l("el-tabs"),U=l("el-dialog");return p(),f(U,{modelValue:i.visible,"onUpdate:modelValue":e[6]||(e[6]=m=>i.visible=m),title:"个人信息",width:"500px","before-close":i.handleClose},{default:s(()=>[o(v,{modelValue:r.activeTab,"onUpdate:modelValue":e[5]||(e[5]=m=>r.activeTab=m),type:"border-card"},{default:s(()=>[o(y,{label:"个人信息",name:"profile"},{default:s(()=>[o(h,{ref:"profileForm",model:r.profileForm,rules:r.profileRules,"label-width":"80px"},{default:s(()=>[o(_,{label:"用户名"},{default:s(()=>[o(w,{modelValue:t.currentUser.username,"onUpdate:modelValue":e[0]||(e[0]=m=>t.currentUser.username=m),disabled:""},null,8,["modelValue"])]),_:1}),o(_,{label:"角色"},{default:s(()=>[o(d,{type:i.getRoleType(t.currentUser.role)},{default:s(()=>[u(I(i.getRoleText(t.currentUser.role)),1)]),_:1},8,["type"])]),_:1}),o(_,{label:"邮箱",prop:"email"},{default:s(()=>[o(w,{modelValue:r.profileForm.email,"onUpdate:modelValue":e[1]||(e[1]=m=>r.profileForm.email=m),placeholder:"请输入邮箱地址",type:"email"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),n("div",Q,[o(c,{onClick:i.handleClose},{default:s(()=>[...e[7]||(e[7]=[u("取消",-1)])]),_:1},8,["onClick"]),o(c,{type:"primary",loading:r.profileLoading,onClick:i.handleUpdateProfile},{default:s(()=>[...e[8]||(e[8]=[u(" 保存 ",-1)])]),_:1},8,["loading","onClick"])])]),_:1}),o(y,{label:"修改密码",name:"password"},{default:s(()=>[o(h,{ref:"passwordForm",model:r.passwordForm,rules:r.passwordRules,"label-width":"80px"},{default:s(()=>[o(_,{label:"旧密码",prop:"oldPassword"},{default:s(()=>[o(w,{modelValue:r.passwordForm.oldPassword,"onUpdate:modelValue":e[2]||(e[2]=m=>r.passwordForm.oldPassword=m),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),o(_,{label:"新密码",prop:"newPassword"},{default:s(()=>[o(w,{modelValue:r.passwordForm.newPassword,"onUpdate:modelValue":e[3]||(e[3]=m=>r.passwordForm.newPassword=m),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(_,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[o(w,{modelValue:r.passwordForm.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=m=>r.passwordForm.confirmPassword=m),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(P,{title:"密码要求",type:"info",closable:!1,"show-icon":""},{default:s(()=>[...e[9]||(e[9]=[n("ul",{style:{margin:"0","padding-left":"20px"}},[n("li",null,"长度至少8位"),n("li",null,"包含至少一个大写字母"),n("li",null,"包含至少一个小写字母"),n("li",null,"包含至少一个数字")],-1)])]),_:1})]),_:1},8,["model","rules"]),n("div",X,[o(c,{onClick:i.resetPasswordForm},{default:s(()=>[...e[10]||(e[10]=[u("重置",-1)])]),_:1},8,["onClick"]),o(c,{type:"primary",loading:r.passwordLoading,onClick:i.handleChangePassword},{default:s(()=>[...e[11]||(e[11]=[u(" 修改密码 ",-1)])]),_:1},8,["loading","onClick"])])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","before-close"])}const $=N(J,[["render",Y],["__scopeId","data-v-7e6c9025"]]);const ee={name:"AppLayout",components:{UserProfile:$},data(){return{showUserProfile:!1,sidebarCollapsed:!1}},computed:{...B("auth",["isAuthenticated","userName","userRole"]),sidebarWidth(){return this.sidebarCollapsed?"64px":"240px"},activeMenu(){return this.$route.path}},methods:{...E("auth",["logout"]),toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed,localStorage.setItem("sidebarCollapsed",this.sidebarCollapsed.toString())},handleUserMenuCommand(t){switch(t){case"profile":this.showUserProfile=!0;break;case"logout":this.handleLogout();break}},async handleLogout(){try{await this.logout(),this.$message.success("退出登录成功"),this.$router.push("/login")}catch(t){console.error("Logout error:",t),this.$message.error("退出登录失败")}}},mounted(){const t=localStorage.getItem("sidebarCollapsed");t!==null&&(this.sidebarCollapsed=t==="true"),console.log("AppLayout mounted - 用户信息:",{isAuthenticated:this.isAuthenticated,userName:this.userName,userRole:this.userRole,currentUser:this.$store.getters["auth/currentUser"]})}},oe={class:"app-layout"},se={class:"header-left"},te={class:"header-right"},le={class:"sidebar-content"},re={class:"sidebar-header"},ae={class:"system-info"},ne={class:"system-title"},de={class:"system-subtitle"};function ie(t,e,a,F,r,i){const w=l("Expand"),_=l("Fold"),d=l("el-icon"),h=l("el-button"),c=l("User"),y=l("arrow-down"),P=l("Setting"),v=l("el-dropdown-item"),U=l("SwitchButton"),m=l("el-dropdown-menu"),M=l("el-dropdown"),q=l("el-header"),C=l("Grid"),g=l("el-menu-item"),k=l("Monitor"),z=l("Connection"),V=l("el-sub-menu"),G=l("OfficeBuilding"),O=l("el-menu"),D=l("el-aside"),W=l("el-main"),K=l("el-container"),Z=l("UserProfile");return p(),T("div",oe,[o(q,{class:"app-header"},{default:s(()=>[n("div",se,[t.isAuthenticated?(p(),f(h,{key:0,type:"text",class:"sidebar-toggle",onClick:i.toggleSidebar},{default:s(()=>[o(d,null,{default:s(()=>[r.sidebarCollapsed?(p(),f(w,{key:0})):(p(),f(_,{key:1}))]),_:1})]),_:1},8,["onClick"])):x("",!0),e[2]||(e[2]=n("h1",{class:"app-title"},"OST网络资源管理系统",-1))]),n("div",te,[t.isAuthenticated?(p(),f(M,{key:0,onCommand:i.handleUserMenuCommand},{dropdown:s(()=>[o(m,null,{default:s(()=>[o(v,{command:"profile"},{default:s(()=>[o(d,null,{default:s(()=>[o(P)]),_:1}),e[3]||(e[3]=u(" 个人设置 ",-1))]),_:1}),o(v,{divided:"",command:"logout"},{default:s(()=>[o(d,null,{default:s(()=>[o(U)]),_:1}),e[4]||(e[4]=u(" 退出登录 ",-1))]),_:1})]),_:1})]),default:s(()=>[o(h,{type:"text",class:"user-menu-button"},{default:s(()=>[o(d,null,{default:s(()=>[o(c)]),_:1}),u(" "+I(t.userName)+" ",1),o(d,{class:"el-icon--right"},{default:s(()=>[o(y)]),_:1})]),_:1})]),_:1},8,["onCommand"])):(p(),f(h,{key:1,type:"primary",onClick:e[0]||(e[0]=b=>t.$router.push("/login"))},{default:s(()=>[...e[5]||(e[5]=[u(" 登录 ",-1)])]),_:1}))])]),_:1}),o(K,{class:"app-container"},{default:s(()=>[t.isAuthenticated?(p(),f(D,{key:0,width:i.sidebarWidth,class:R(["app-sidebar",{"sidebar-collapsed":r.sidebarCollapsed}])},{default:s(()=>[n("div",le,[n("div",re,[n("div",ae,[S(n("div",ne,"网络资源管理系统",512),[[A,!r.sidebarCollapsed]]),S(n("div",de,"企业网络资源管理平台",512),[[A,!r.sidebarCollapsed]])])]),o(O,{"default-active":i.activeMenu,class:"sidebar-menu",collapse:r.sidebarCollapsed,"collapse-transition":!1,router:""},{default:s(()=>{var b,L;return[((b=t.userRole)==null?void 0:b.toLowerCase())==="readonly"?(p(),f(g,{key:0,index:"/ip-management"},{title:s(()=>[...e[6]||(e[6]=[u("IP地址管理",-1)])]),default:s(()=>[o(d,null,{default:s(()=>[o(C)]),_:1})]),_:1})):(p(),T(j,{key:1},[o(g,{index:"/dashboard"},{title:s(()=>[...e[7]||(e[7]=[u("仪表盘",-1)])]),default:s(()=>[o(d,null,{default:s(()=>[o(k)]),_:1})]),_:1}),o(V,{index:"network-resources"},{title:s(()=>[o(d,null,{default:s(()=>[o(z)]),_:1}),e[8]||(e[8]=n("span",null,"网络资源管理",-1))]),default:s(()=>[o(g,{index:"/ip-management"},{title:s(()=>[...e[9]||(e[9]=[u("IP地址管理",-1)])]),default:s(()=>[o(d,null,{default:s(()=>[o(C)]),_:1})]),_:1}),o(g,{index:"/device-type-management"},{title:s(()=>[...e[10]||(e[10]=[u("设备类型管理",-1)])]),default:s(()=>[o(d,null,{default:s(()=>[o(k)]),_:1})]),_:1})]),_:1}),o(V,{index:"subnet-resources"},{title:s(()=>[o(d,null,{default:s(()=>[o(C)]),_:1}),e[11]||(e[11]=n("span",null,"网段资源管理",-1))]),default:s(()=>[o(g,{index:"/subnet-management"},{title:s(()=>[...e[12]||(e[12]=[u("网段管理",-1)])]),default:s(()=>[o(d,null,{default:s(()=>[o(C)]),_:1})]),_:1})]),_:1})],64)),((L=t.userRole)==null?void 0:L.toLowerCase())==="admin"?(p(),f(V,{key:2,index:"system-management"},{title:s(()=>[o(d,null,{default:s(()=>[o(P)]),_:1}),e[13]||(e[13]=n("span",null,"系统管理",-1))]),default:s(()=>[o(g,{index:"/user-management"},{title:s(()=>[...e[14]||(e[14]=[u("用户管理",-1)])]),default:s(()=>[o(d,null,{default:s(()=>[o(c)]),_:1})]),_:1}),o(g,{index:"/department-management"},{title:s(()=>[...e[15]||(e[15]=[u("组织管理",-1)])]),default:s(()=>[o(d,null,{default:s(()=>[o(G)]),_:1})]),_:1})]),_:1})):x("",!0)]}),_:1},8,["default-active","collapse"])])]),_:1},8,["width","class"])):x("",!0),o(W,{class:R(["app-main",{"main-expanded":!t.isAuthenticated||r.sidebarCollapsed}])},{default:s(()=>[H(t.$slots,"default",{},void 0,!0)]),_:3},8,["class"])]),_:3}),o(Z,{modelValue:r.showUserProfile,"onUpdate:modelValue":e[1]||(e[1]=b=>r.showUserProfile=b)},null,8,["modelValue"])])}const me=N(ee,[["render",ie],["__scopeId","data-v-049562a7"]]);export{me as A};
