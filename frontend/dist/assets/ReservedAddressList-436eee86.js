import{m as c,d as Me,r as v,a as J,o as Te,c as m,e,w as a,n as b,i as u,D as Be,j as n,F as A,y as R,g as U,G as Oe,l as r,x as se,b as M,H as je,O as qe,P as Ne,I as Fe,J as Ge,K as h,t as x,Q as He,z as K,L as Je,M as Q,_ as Ke}from"./index-de8d932e.js";import{n as Qe}from"./networkSegment-d69ecc2b.js";import{d as We}from"./department-9b96297e.js";import{u as Xe}from"./user-ac9e02c0.js";const C={getList(i){return c.get("/v1/reserved-addresses",{params:i})},getById(i){return c.get(`/v1/reserved-addresses/${i}`)},getByIp(i){return c.get(`/v1/reserved-addresses/by-ip/${i}`)},create(i){return c.post("/v1/reserved-addresses",i)},update(i,$){return c.put(`/v1/reserved-addresses/${i}`,$)},delete(i){return c.delete(`/v1/reserved-addresses/${i}`)},activate(i){return c.post(`/v1/reserved-addresses/${i}/activate`)},deactivate(i){return c.post(`/v1/reserved-addresses/${i}/deactivate`)},getExpired(){return c.get("/v1/reserved-addresses/expired/list")},cleanupExpired(){return c.post("/v1/reserved-addresses/expired/cleanup")},getUpcomingExpiration(i=7){return c.get("/v1/reserved-addresses/upcoming/expiration",{params:{days:i}})},extend(i,$){return c.post(`/v1/reserved-addresses/${i}/extend`,{new_end_date:$})},getStatistics(){return c.get("/v1/reserved-addresses/statistics/overview")}},Ye={class:"reserved-address-list"},Ze={class:"toolbar"},et={class:"toolbar-left"},tt={class:"toolbar-right"},lt={key:0},at={key:1,class:"text-muted"},st={key:0,class:"permanent-tag"},dt={key:1},rt={key:2,class:"text-muted"},nt={key:0,class:"text-success"},ot={key:1},it={key:2,class:"text-muted"},ut={class:"pagination-container"},_t=Me({__name:"ReservedAddressList",setup(i){const $=v(!1),W=v([]),j=v([]),X=v([]),E=v([]),de=v([]),f=J({search:"",network_segment_id:void 0,is_active:void 0,reserved_by_user_id:void 0}),y=J({page:1,size:20,total:0}),S=v(!1),T=v(!1),q=v(),d=J({ip_address:"",network_segment_id:0,reserved_for:"",reserved_by_user_id:0,reserved_by_department_id:void 0,start_date:new Date().toISOString().split("T")[0],end_date:void 0,is_permanent:!1,priority:"medium",notes:"",is_active:!0}),re={ip_address:[{required:!0,message:"请输入IP地址",trigger:"blur"}],network_segment_id:[{required:!0,message:"请选择网段",trigger:"change"}],reserved_for:[{required:!0,message:"请输入保留用途",trigger:"blur"}],reserved_by_user_id:[{required:!0,message:"请选择保留人",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}]},I=v(!1),L=v(),P=v(""),N=v(),ne=s=>({low:"info",medium:"success",high:"warning",critical:"danger"})[s]||"info",oe=s=>({low:"低",medium:"中",high:"高",critical:"紧急"})[s]||s,Y=s=>{const l=new Date,o=new Date(s).getTime()-l.getTime();return Math.ceil(o/(1e3*60*60*24))},ie=s=>s<0?"text-danger":s<=7?"text-warning":s<=30?"text-info":"text-success",ue=s=>new Date(s).toLocaleString("zh-CN"),g=async()=>{$.value=!0;try{const s={skip:(y.page-1)*y.size,limit:y.size,...f};Object.keys(s).forEach(w=>{(s[w]===""||s[w]===void 0)&&delete s[w]});const l=await C.getList(s);W.value=l}catch(s){b.error("加载数据失败"),console.error(s)}finally{$.value=!1}},_e=async()=>{try{const s=await Qe.getList({limit:1e3});j.value=s.items||[]}catch(s){console.error("加载网段列表失败:",s)}},pe=async()=>{try{const s=await We.getList({limit:1e3});X.value=s}catch(s){console.error("加载部门列表失败:",s)}},Z=async s=>{if(!s){E.value=[];return}try{const l=await Xe.search({q:s,limit:20});E.value=l}catch(l){console.error("搜索用户失败:",l)}},ee=()=>{y.page=1,g()},me=()=>{Object.assign(f,{search:"",network_segment_id:void 0,is_active:void 0,reserved_by_user_id:void 0}),ee()},ce=()=>{T.value=!1,$e(),S.value=!0},ve=s=>{T.value=!0,N.value=s,Object.assign(d,{ip_address:s.ip_address,network_segment_id:s.network_segment_id,reserved_for:s.reserved_for,reserved_by_user_id:s.reserved_by_user_id,reserved_by_department_id:s.reserved_by_department_id,start_date:s.start_date,end_date:s.end_date,is_permanent:s.is_permanent,priority:s.priority,notes:s.notes||"",is_active:s.is_active}),s.reserved_by_user&&(E.value=[s.reserved_by_user]),S.value=!0},fe=async()=>{if(q.value)try{await q.value.validate(),T.value&&N.value?(await C.update(N.value.id,d),b.success("地址保留更新成功")):(await C.create(d),b.success("地址保留创建成功")),S.value=!1,g()}catch(s){console.error("保存地址保留失败:",s)}},ye=async s=>{try{await C.activate(s.id),b.success("激活成功"),g()}catch(l){console.error("激活失败:",l)}},ge=async s=>{try{await Q.confirm(`确定要停用地址保留 ${s.ip_address} 吗？`,"确认停用",{type:"warning"}),await C.deactivate(s.id),b.success("停用成功"),g()}catch(l){l!=="cancel"&&console.error("停用失败:",l)}},be=s=>{L.value=s,P.value="",I.value=!0},we=async()=>{if(!P.value||!L.value){b.warning("请选择新的到期日期");return}try{await C.extend(L.value.id,P.value),b.success("延期成功"),I.value=!1,g()}catch(s){console.error("延期失败:",s)}},ke=async()=>{try{await Q.confirm("确定要清理所有过期的地址保留吗？","确认清理",{type:"warning"});const s=await C.cleanupExpired();b.success(s.message),g()}catch(s){s!=="cancel"&&console.error("清理过期保留失败:",s)}},Ve=async()=>{try{const s=await C.getUpcomingExpiration(7);s.length===0?b.info("没有即将过期的地址保留"):(b.info(`有 ${s.length} 个地址保留即将在7天内过期`),f.search="",g())}catch(s){console.error("获取即将过期的保留失败:",s)}},he=()=>{b.info("导出功能开发中...")},xe=s=>{de.value=s},Ce=async(s,l)=>{switch(s){case"delete":await ze(l);break}},ze=async s=>{try{await Q.confirm(`确定要删除地址保留 ${s.ip_address} 吗？此操作不可恢复！`,"确认删除",{type:"warning"}),await C.delete(s.id),b.success("删除成功"),g()}catch(l){l!=="cancel"&&console.error("删除地址保留失败:",l)}},Ue=s=>{s&&(d.end_date=void 0)},$e=()=>{Object.assign(d,{ip_address:"",network_segment_id:0,reserved_for:"",reserved_by_user_id:0,reserved_by_department_id:void 0,start_date:new Date().toISOString().split("T")[0],end_date:void 0,is_permanent:!1,priority:"medium",notes:"",is_active:!0}),E.value=[]},De=s=>{y.size=s,y.page=1,g()},Ee=s=>{y.page=s,g()};return Te(()=>{g(),_e(),pe()}),(s,l)=>{const w=u("el-input"),o=u("el-form-item"),k=u("el-option"),D=u("el-select"),z=u("el-icon"),_=u("el-button"),F=u("el-form"),G=u("el-card"),p=u("el-table-column"),B=u("el-tag"),Se=u("el-dropdown-item"),Ie=u("el-dropdown-menu"),Le=u("el-dropdown"),Pe=u("el-table"),Ae=u("el-pagination"),H=u("el-date-picker"),O=u("el-col"),te=u("el-row"),le=u("el-switch"),ae=u("el-dialog"),Re=Be("loading");return n(),m("div",Ye,[e(G,{class:"search-card"},{default:a(()=>[e(F,{inline:!0,model:f,class:"search-form"},{default:a(()=>[e(o,{label:"IP地址"},{default:a(()=>[e(w,{modelValue:f.search,"onUpdate:modelValue":l[0]||(l[0]=t=>f.search=t),placeholder:"请输入IP地址或保留用途",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(o,{label:"网段"},{default:a(()=>[e(D,{modelValue:f.network_segment_id,"onUpdate:modelValue":l[1]||(l[1]=t=>f.network_segment_id=t),placeholder:"请选择网段",clearable:"",style:{width:"200px"}},{default:a(()=>[(n(!0),m(A,null,R(j.value,t=>(n(),h(k,{key:t.id,label:`${t.name} (${t.network})`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(o,{label:"状态"},{default:a(()=>[e(D,{modelValue:f.is_active,"onUpdate:modelValue":l[2]||(l[2]=t=>f.is_active=t),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:a(()=>[e(k,{label:"生效",value:!0}),e(k,{label:"失效",value:!1})]),_:1},8,["modelValue"])]),_:1}),e(o,{label:"保留人"},{default:a(()=>[e(D,{modelValue:f.reserved_by_user_id,"onUpdate:modelValue":l[3]||(l[3]=t=>f.reserved_by_user_id=t),placeholder:"请选择保留人",clearable:"",filterable:"",remote:"","remote-method":Z,style:{width:"150px"}},{default:a(()=>[(n(!0),m(A,null,R(E.value,t=>(n(),h(k,{key:t.id,label:t.real_name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(o,null,{default:a(()=>[e(_,{type:"primary",onClick:ee},{default:a(()=>[e(z,null,{default:a(()=>[e(U(Oe))]),_:1}),l[22]||(l[22]=r(" 搜索 ",-1))]),_:1}),e(_,{onClick:me},{default:a(()=>[e(z,null,{default:a(()=>[e(U(se))]),_:1}),l[23]||(l[23]=r(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(G,{class:"toolbar-card"},{default:a(()=>[M("div",Ze,[M("div",et,[e(_,{type:"primary",onClick:ce},{default:a(()=>[e(z,null,{default:a(()=>[e(U(je))]),_:1}),l[24]||(l[24]=r(" 新增保留 ",-1))]),_:1}),e(_,{type:"warning",onClick:ke},{default:a(()=>[e(z,null,{default:a(()=>[e(U(qe))]),_:1}),l[25]||(l[25]=r(" 清理过期 ",-1))]),_:1}),e(_,{type:"info",onClick:Ve},{default:a(()=>[e(z,null,{default:a(()=>[e(U(Ne))]),_:1}),l[26]||(l[26]=r(" 即将过期 ",-1))]),_:1}),e(_,{type:"success",onClick:he},{default:a(()=>[e(z,null,{default:a(()=>[e(U(Fe))]),_:1}),l[27]||(l[27]=r(" 导出数据 ",-1))]),_:1})]),M("div",tt,[e(_,{onClick:g},{default:a(()=>[e(z,null,{default:a(()=>[e(U(se))]),_:1}),l[28]||(l[28]=r(" 刷新 ",-1))]),_:1})])])]),_:1}),e(G,{class:"table-card"},{default:a(()=>[Ge((n(),h(Pe,{data:W.value,stripe:"",border:"",style:{width:"100%"},onSelectionChange:xe},{default:a(()=>[e(p,{type:"selection",width:"50"}),e(p,{prop:"ip_address",label:"IP地址",width:"140"},{default:a(({row:t})=>[e(B,null,{default:a(()=>[r(x(t.ip_address),1)]),_:2},1024)]),_:1}),e(p,{prop:"reserved_for",label:"保留用途","min-width":"150","show-overflow-tooltip":""}),e(p,{label:"保留人",width:"120"},{default:a(({row:t})=>{var V;return[r(x((V=t.reserved_by_user)==null?void 0:V.real_name),1)]}),_:1}),e(p,{label:"保留部门",width:"120"},{default:a(({row:t})=>[t.reserved_by_department?(n(),m("span",lt,x(t.reserved_by_department.name),1)):(n(),m("span",at,"-"))]),_:1}),e(p,{prop:"start_date",label:"开始日期",width:"120"}),e(p,{prop:"end_date",label:"结束日期",width:"120"},{default:a(({row:t})=>[t.is_permanent?(n(),m("span",st,[e(B,{type:"success",size:"small"},{default:a(()=>[...l[29]||(l[29]=[r("永久",-1)])]),_:1})])):t.end_date?(n(),m("span",dt,x(t.end_date),1)):(n(),m("span",rt,"-"))]),_:1}),e(p,{prop:"priority",label:"优先级",width:"100"},{default:a(({row:t})=>[e(B,{type:ne(t.priority),size:"small"},{default:a(()=>[r(x(oe(t.priority)),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"剩余天数",width:"100"},{default:a(({row:t})=>[t.is_permanent?(n(),m("span",nt,"永久")):t.end_date?(n(),m("span",ot,[M("span",{class:He(ie(Y(t.end_date)))},x(Y(t.end_date))+"天 ",3)])):(n(),m("span",it,"-"))]),_:1}),e(p,{prop:"network_segment",label:"所属网段",width:"120"},{default:a(({row:t})=>{var V;return[r(x((V=t.network_segment)==null?void 0:V.name),1)]}),_:1}),e(p,{label:"状态",width:"80"},{default:a(({row:t})=>[e(B,{type:t.is_active?"success":"danger",size:"small"},{default:a(()=>[r(x(t.is_active?"生效":"失效"),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"notes",label:"备注","min-width":"120","show-overflow-tooltip":""}),e(p,{prop:"created_at",label:"创建时间",width:"150"},{default:a(({row:t})=>[r(x(ue(t.created_at)),1)]),_:1}),e(p,{label:"操作",width:"250",fixed:"right"},{default:a(({row:t})=>[t.is_active?K("",!0):(n(),h(_,{key:0,type:"success",size:"small",onClick:V=>ye(t)},{default:a(()=>[...l[30]||(l[30]=[r(" 激活 ",-1)])]),_:2},1032,["onClick"])),t.is_active?(n(),h(_,{key:1,type:"warning",size:"small",onClick:V=>ge(t)},{default:a(()=>[...l[31]||(l[31]=[r(" 停用 ",-1)])]),_:2},1032,["onClick"])):K("",!0),!t.is_permanent&&t.end_date?(n(),h(_,{key:2,type:"primary",size:"small",onClick:V=>be(t)},{default:a(()=>[...l[32]||(l[32]=[r(" 延期 ",-1)])]),_:2},1032,["onClick"])):K("",!0),e(_,{type:"info",size:"small",onClick:V=>ve(t)},{default:a(()=>[...l[33]||(l[33]=[r(" 编辑 ",-1)])]),_:2},1032,["onClick"]),e(Le,{onCommand:V=>Ce(V,t)},{dropdown:a(()=>[e(Ie,null,{default:a(()=>[e(Se,{command:"delete",divided:""},{default:a(()=>[...l[35]||(l[35]=[r("删除",-1)])]),_:1})]),_:1})]),default:a(()=>[e(_,{size:"small"},{default:a(()=>[l[34]||(l[34]=r(" 更多",-1)),e(z,null,{default:a(()=>[e(U(Je))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"])),[[Re,$.value]]),M("div",ut,[e(Ae,{"current-page":y.page,"onUpdate:currentPage":l[4]||(l[4]=t=>y.page=t),"page-size":y.size,"onUpdate:pageSize":l[5]||(l[5]=t=>y.size=t),"page-sizes":[10,20,50,100],total:y.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:De,onCurrentChange:Ee},null,8,["current-page","page-size","total"])])]),_:1}),e(ae,{modelValue:S.value,"onUpdate:modelValue":l[18]||(l[18]=t=>S.value=t),title:T.value?"编辑地址保留":"新增地址保留",width:"600px"},{footer:a(()=>[e(_,{onClick:l[17]||(l[17]=t=>S.value=!1)},{default:a(()=>[...l[36]||(l[36]=[r("取消",-1)])]),_:1}),e(_,{type:"primary",onClick:fe},{default:a(()=>[...l[37]||(l[37]=[r("确认",-1)])]),_:1})]),default:a(()=>[e(F,{ref_key:"formRef",ref:q,model:d,rules:re,"label-width":"120px"},{default:a(()=>[e(o,{label:"IP地址",prop:"ip_address"},{default:a(()=>[e(w,{modelValue:d.ip_address,"onUpdate:modelValue":l[6]||(l[6]=t=>d.ip_address=t),placeholder:"请输入IP地址"},null,8,["modelValue"])]),_:1}),e(o,{label:"所属网段",prop:"network_segment_id"},{default:a(()=>[e(D,{modelValue:d.network_segment_id,"onUpdate:modelValue":l[7]||(l[7]=t=>d.network_segment_id=t),placeholder:"请选择网段",style:{width:"100%"}},{default:a(()=>[(n(!0),m(A,null,R(j.value,t=>(n(),h(k,{key:t.id,label:`${t.name} (${t.network})`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(o,{label:"保留用途",prop:"reserved_for"},{default:a(()=>[e(w,{modelValue:d.reserved_for,"onUpdate:modelValue":l[8]||(l[8]=t=>d.reserved_for=t),placeholder:"请输入保留用途"},null,8,["modelValue"])]),_:1}),e(o,{label:"保留人",prop:"reserved_by_user_id"},{default:a(()=>[e(D,{modelValue:d.reserved_by_user_id,"onUpdate:modelValue":l[9]||(l[9]=t=>d.reserved_by_user_id=t),placeholder:"请选择保留人",filterable:"",remote:"","remote-method":Z,style:{width:"100%"}},{default:a(()=>[(n(!0),m(A,null,R(E.value,t=>(n(),h(k,{key:t.id,label:`${t.real_name} (${t.username})`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(o,{label:"保留部门"},{default:a(()=>[e(D,{modelValue:d.reserved_by_department_id,"onUpdate:modelValue":l[10]||(l[10]=t=>d.reserved_by_department_id=t),placeholder:"请选择保留部门",style:{width:"100%"}},{default:a(()=>[(n(!0),m(A,null,R(X.value,t=>(n(),h(k,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(te,{gutter:20},{default:a(()=>[e(O,{span:12},{default:a(()=>[e(o,{label:"开始日期",prop:"start_date"},{default:a(()=>[e(H,{modelValue:d.start_date,"onUpdate:modelValue":l[11]||(l[11]=t=>d.start_date=t),type:"date",placeholder:"选择开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(O,{span:12},{default:a(()=>[e(o,{label:"结束日期"},{default:a(()=>[e(H,{modelValue:d.end_date,"onUpdate:modelValue":l[12]||(l[12]=t=>d.end_date=t),type:"date",placeholder:"选择结束日期",disabled:d.is_permanent,style:{width:"100%"}},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(te,{gutter:20},{default:a(()=>[e(O,{span:12},{default:a(()=>[e(o,{label:"优先级"},{default:a(()=>[e(D,{modelValue:d.priority,"onUpdate:modelValue":l[13]||(l[13]=t=>d.priority=t),placeholder:"请选择优先级",style:{width:"100%"}},{default:a(()=>[e(k,{label:"低",value:"low"}),e(k,{label:"中",value:"medium"}),e(k,{label:"高",value:"high"}),e(k,{label:"紧急",value:"critical"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(O,{span:12},{default:a(()=>[e(o,{label:"永久保留"},{default:a(()=>[e(le,{modelValue:d.is_permanent,"onUpdate:modelValue":l[14]||(l[14]=t=>d.is_permanent=t),"active-text":"是","inactive-text":"否",onChange:Ue},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(o,{label:"备注说明"},{default:a(()=>[e(w,{modelValue:d.notes,"onUpdate:modelValue":l[15]||(l[15]=t=>d.notes=t),type:"textarea",rows:3,placeholder:"请输入备注说明"},null,8,["modelValue"])]),_:1}),e(o,{label:"状态"},{default:a(()=>[e(le,{modelValue:d.is_active,"onUpdate:modelValue":l[16]||(l[16]=t=>d.is_active=t),"active-text":"生效","inactive-text":"失效"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(ae,{modelValue:I.value,"onUpdate:modelValue":l[21]||(l[21]=t=>I.value=t),title:"延长保留期限",width:"400px"},{footer:a(()=>[e(_,{onClick:l[20]||(l[20]=t=>I.value=!1)},{default:a(()=>[...l[38]||(l[38]=[r("取消",-1)])]),_:1}),e(_,{type:"primary",onClick:we},{default:a(()=>[...l[39]||(l[39]=[r("确认延期",-1)])]),_:1})]),default:a(()=>[e(F,{"label-width":"100px"},{default:a(()=>[e(o,{label:"当前IP"},{default:a(()=>{var t;return[e(w,{"model-value":(t=L.value)==null?void 0:t.ip_address,disabled:""},null,8,["model-value"])]}),_:1}),e(o,{label:"当前到期日"},{default:a(()=>{var t;return[e(w,{"model-value":(t=L.value)==null?void 0:t.end_date,disabled:""},null,8,["model-value"])]}),_:1}),e(o,{label:"新到期日",required:""},{default:a(()=>[e(H,{modelValue:P.value,"onUpdate:modelValue":l[19]||(l[19]=t=>P.value=t),type:"date",placeholder:"选择新的到期日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});const ft=Ke(_t,[["__scopeId","data-v-30aba1a6"]]);export{ft as default};
