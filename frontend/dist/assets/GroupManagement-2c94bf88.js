import{d as ne,r as c,a as j,o as oe,c as I,b as r,e as l,w as t,J as ie,K as L,U as k,n as x,i,D as re,j as C,g as z,H as de,l as n,k as ue,G as O,x as pe,t as f,F as me,y as _e,z as ce,E as fe,M as P,_ as ge}from"./index-de8d932e.js";const ve={class:"group-management"},be={class:"page-header"},ye={class:"header-actions"},we={class:"search-section"},Ve={class:"table-section"},ke={class:"pagination-section"},xe={class:"permission-section"},Ce={class:"permission-section"},ze={class:"permission-section"},Ge=ne({__name:"GroupManagement",setup(Ue){const E=c(!1),F=c(!1),B=c([]),g=c(!1),v=c(!1),$=c(null),G=c(),b=j({search:"",is_active:null}),u=j({page:1,size:20,total:0}),o=j({name:"",display_name:"",description:"",permissions:[]}),R={name:[{required:!0,message:"请输入组名",trigger:"blur"},{min:2,max:50,message:"组名长度在 2 到 50 个字符",trigger:"blur"}],display_name:[{required:!0,message:"请输入显示名称",trigger:"blur"}]},K={user:"普通用户",admin:"管理员",superuser:"超级管理员",ip_management:"IP管理",network_management:"网段管理",user_management:"用户管理",system_settings:"系统设置",data_export:"数据导出",data_import:"数据导入",data_delete:"数据删除"},q=a=>K[a]||a,A=a=>new Date(a).toLocaleString("zh-CN"),y=async()=>{E.value=!0;try{const a={skip:(u.page-1)*u.size,limit:u.size,...b};Object.keys(a).forEach(p=>{(a[p]===""||a[p]===null)&&delete a[p]});const e=await k.getGroups(a);B.value=e}catch(a){x.error("加载组列表失败"),console.error(a)}finally{E.value=!1}},w=()=>{u.page=1,y()},H=()=>{Object.assign(b,{search:"",is_active:null}),w()},J=()=>{v.value=!1,g.value=!0,N()},T=a=>{v.value=!0,$.value=a.id,g.value=!0,Object.assign(o,{name:a.name,display_name:a.display_name,description:a.description,permissions:[...a.permissions]})},N=()=>{var a;Object.assign(o,{name:"",display_name:"",description:"",permissions:[]}),(a=G.value)==null||a.clearValidate()},Q=async()=>{if(G.value)try{if(await G.value.validate(),F.value=!0,v.value&&$.value){const a={display_name:o.display_name,description:o.description,permissions:o.permissions};await k.updateGroup($.value,a),x.success("组更新成功")}else await k.createGroup(o),x.success("组创建成功");g.value=!1,y()}catch(a){console.error("提交组数据失败:",a)}finally{F.value=!1}},W=async a=>{try{await P.confirm(`确定要${a.is_active?"禁用":"启用"}组 ${a.name} 吗？`,"确认操作",{type:"warning"}),await k.updateGroup(a.id,{is_active:!a.is_active}),x.success(`组${a.is_active?"禁用":"启用"}成功`),y()}catch(e){e!=="cancel"&&console.error("切换组状态失败:",e)}},X=async a=>{try{await P.confirm(`确定要删除组 ${a.name} 吗？此操作不可恢复！`,"确认删除",{type:"error"}),await k.deleteGroup(a.id),x.success("组删除成功"),y()}catch(e){e!=="cancel"&&console.error("删除组失败:",e)}};return oe(()=>{y()}),(a,e)=>{const p=i("el-icon"),m=i("el-button"),U=i("el-input"),M=i("el-col"),S=i("el-option"),Y=i("el-select"),Z=i("el-row"),_=i("el-table-column"),D=i("el-tag"),ee=i("el-table"),le=i("el-pagination"),h=i("el-form-item"),d=i("el-checkbox"),te=i("el-checkbox-group"),ae=i("el-dialog"),se=re("loading");return C(),I("div",ve,[r("div",be,[e[11]||(e[11]=r("div",{class:"header-content"},[r("h1",null,"组管理"),r("p",null,"管理用户组和权限配置")],-1)),r("div",ye,[l(m,{type:"primary",onClick:J},{default:t(()=>[l(p,null,{default:t(()=>[l(z(de))]),_:1}),e[10]||(e[10]=n(" 新增组 ",-1))]),_:1})])]),r("div",we,[l(Z,{gutter:20},{default:t(()=>[l(M,{span:6},{default:t(()=>[l(U,{modelValue:b.search,"onUpdate:modelValue":e[0]||(e[0]=s=>b.search=s),placeholder:"搜索组名、显示名称",clearable:"",onKeyup:ue(w,["enter"])},{prefix:t(()=>[l(p,null,{default:t(()=>[l(z(O))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(M,{span:4},{default:t(()=>[l(Y,{modelValue:b.is_active,"onUpdate:modelValue":e[1]||(e[1]=s=>b.is_active=s),placeholder:"状态筛选",clearable:""},{default:t(()=>[l(S,{label:"全部",value:null}),l(S,{label:"启用",value:!0}),l(S,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),_:1}),l(M,{span:6},{default:t(()=>[l(m,{type:"primary",onClick:w},{default:t(()=>[l(p,null,{default:t(()=>[l(z(O))]),_:1}),e[12]||(e[12]=n(" 搜索 ",-1))]),_:1}),l(m,{onClick:H},{default:t(()=>[l(p,null,{default:t(()=>[l(z(pe))]),_:1}),e[13]||(e[13]=n(" 重置 ",-1))]),_:1})]),_:1})]),_:1})]),r("div",Ve,[ie((C(),L(ee,{data:B.value,style:{width:"100%"},"row-key":"id"},{default:t(()=>[l(_,{prop:"name",label:"组名",width:"150"}),l(_,{prop:"display_name",label:"显示名称",width:"150"}),l(_,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),l(_,{label:"状态",width:"80"},{default:t(({row:s})=>[l(D,{type:s.is_active?"success":"danger"},{default:t(()=>[n(f(s.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(_,{prop:"user_count",label:"用户数量",width:"100"},{default:t(({row:s})=>[l(D,{type:"info"},{default:t(()=>[n(f(s.user_count||0),1)]),_:2},1024)]),_:1}),l(_,{label:"权限",width:"200"},{default:t(({row:s})=>[(C(!0),I(me,null,_e(s.permissions.slice(0,3),V=>(C(),L(D,{key:V,size:"small",style:{"margin-right":"5px"}},{default:t(()=>[n(f(q(V)),1)]),_:2},1024))),128)),s.permissions.length>3?(C(),L(D,{key:0,size:"small",type:"info"},{default:t(()=>[n(" +"+f(s.permissions.length-3),1)]),_:2},1024)):ce("",!0)]),_:1}),l(_,{prop:"created_at",label:"创建时间",width:"160"},{default:t(({row:s})=>[n(f(A(s.created_at)),1)]),_:1}),l(_,{label:"操作",width:"180",fixed:"right"},{default:t(({row:s})=>[l(m,{size:"small",onClick:V=>T(s)},{default:t(()=>[...e[14]||(e[14]=[n("编辑",-1)])]),_:2},1032,["onClick"]),l(m,{size:"small",type:s.is_active?"warning":"success",onClick:V=>W(s)},{default:t(()=>[n(f(s.is_active?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(m,{size:"small",type:"danger",onClick:V=>X(s)},{default:t(()=>[...e[15]||(e[15]=[n(" 删除 ",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,E.value]]),r("div",ke,[l(le,{"current-page":u.page,"onUpdate:currentPage":e[2]||(e[2]=s=>u.page=s),"page-size":u.size,"onUpdate:pageSize":e[3]||(e[3]=s=>u.size=s),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:w,onCurrentChange:w},null,8,["current-page","page-size","total"])])]),l(ae,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=s=>g.value=s),title:v.value?"编辑组":"新增组",width:"600px",onClose:N},{footer:t(()=>[l(m,{onClick:e[8]||(e[8]=s=>g.value=!1)},{default:t(()=>[...e[29]||(e[29]=[n("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:Q,loading:F.value},{default:t(()=>[n(f(v.value?"更新":"创建"),1)]),_:1},8,["loading"])]),default:t(()=>[l(z(fe),{ref_key:"groupFormRef",ref:G,model:o,rules:R,"label-width":"100px"},{default:t(()=>[l(h,{label:"组名",prop:"name"},{default:t(()=>[l(U,{modelValue:o.name,"onUpdate:modelValue":e[4]||(e[4]=s=>o.name=s),disabled:v.value,placeholder:"请输入组名"},null,8,["modelValue","disabled"])]),_:1}),l(h,{label:"显示名称",prop:"display_name"},{default:t(()=>[l(U,{modelValue:o.display_name,"onUpdate:modelValue":e[5]||(e[5]=s=>o.display_name=s),placeholder:"请输入显示名称"},null,8,["modelValue"])]),_:1}),l(h,{label:"描述",prop:"description"},{default:t(()=>[l(U,{modelValue:o.description,"onUpdate:modelValue":e[6]||(e[6]=s=>o.description=s),type:"textarea",rows:3,placeholder:"请输入组描述"},null,8,["modelValue"])]),_:1}),l(h,{label:"权限配置"},{default:t(()=>[l(te,{modelValue:o.permissions,"onUpdate:modelValue":e[7]||(e[7]=s=>o.permissions=s)},{default:t(()=>[r("div",xe,[e[19]||(e[19]=r("h4",null,"基础权限",-1)),l(d,{label:"user"},{default:t(()=>[...e[16]||(e[16]=[n("普通用户",-1)])]),_:1}),l(d,{label:"admin"},{default:t(()=>[...e[17]||(e[17]=[n("管理员",-1)])]),_:1}),l(d,{label:"superuser"},{default:t(()=>[...e[18]||(e[18]=[n("超级管理员",-1)])]),_:1})]),r("div",Ce,[e[24]||(e[24]=r("h4",null,"功能权限",-1)),l(d,{label:"ip_management"},{default:t(()=>[...e[20]||(e[20]=[n("IP管理",-1)])]),_:1}),l(d,{label:"network_management"},{default:t(()=>[...e[21]||(e[21]=[n("网段管理",-1)])]),_:1}),l(d,{label:"user_management"},{default:t(()=>[...e[22]||(e[22]=[n("用户管理",-1)])]),_:1}),l(d,{label:"system_settings"},{default:t(()=>[...e[23]||(e[23]=[n("系统设置",-1)])]),_:1})]),r("div",ze,[e[28]||(e[28]=r("h4",null,"数据权限",-1)),l(d,{label:"data_export"},{default:t(()=>[...e[25]||(e[25]=[n("数据导出",-1)])]),_:1}),l(d,{label:"data_import"},{default:t(()=>[...e[26]||(e[26]=[n("数据导入",-1)])]),_:1}),l(d,{label:"data_delete"},{default:t(()=>[...e[27]||(e[27]=[n("数据删除",-1)])]),_:1})])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const he=ge(Ge,[["__scopeId","data-v-ffce9cdb"]]);export{he as default};
