import{d as le,r as g,a as F,o as ae,c as te,b as f,e as l,w as t,J as se,K as h,U as V,n as U,i,D as oe,j as k,g as C,H as ne,l as n,k as ie,G as K,x as re,t as E,E as de,M as L,_ as ue}from"./index-de8d932e.js";const pe={class:"user-management"},me={class:"page-header"},_e={class:"header-actions"},fe={class:"search-section"},ce={class:"table-section"},ge={class:"pagination-section"},ve=le({__name:"UserManagement",setup(ye){const D=g(!1),$=g(!1),B=g([]),v=g(!1),c=g(!1),M=g(null),x=g(),y=F({search:"",is_active:null}),u=F({page:1,size:20,total:0}),o=F({username:"",real_name:"",display_name:"",email:"",employee_id:"",department:"",password:"",is_admin:!1,is_superuser:!1}),q={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:50,message:"用户名长度在 3 到 50 个字符",trigger:"blur"}],real_name:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{validator:(s,e,r)=>{!e&&!c.value?r(new Error("请输入密码")):e&&e.length<6?r(new Error("密码长度不能少于6个字符")):r()},trigger:"blur"}]},I=s=>new Date(s).toLocaleString("zh-CN"),b=async()=>{D.value=!0;try{const s={skip:(u.page-1)*u.size,limit:u.size,...y};Object.keys(s).forEach(r=>{(s[r]===""||s[r]===null)&&delete s[r]});const e=await V.getUsers(s);B.value=e}catch(s){U.error("加载用户列表失败"),console.error(s)}finally{D.value=!1}},w=()=>{u.page=1,b()},A=()=>{Object.assign(y,{search:"",is_active:null}),w()},G=()=>{c.value=!1,v.value=!0,N()},H=s=>{c.value=!0,M.value=s.id,v.value=!0,Object.assign(o,{username:s.username,real_name:s.real_name,display_name:s.display_name,email:s.email,employee_id:s.employee_id,department:s.department,password:"",is_admin:s.is_admin,is_superuser:s.is_superuser})},N=()=>{var s;Object.assign(o,{username:"",real_name:"",display_name:"",email:"",employee_id:"",department:"",password:"",is_admin:!1,is_superuser:!1}),(s=x.value)==null||s.clearValidate()},J=async()=>{if(x.value)try{if(await x.value.validate(),$.value=!0,c.value&&M.value){const s={real_name:o.real_name,display_name:o.display_name,email:o.email,employee_id:o.employee_id,department:o.department,is_admin:o.is_admin,is_superuser:o.is_superuser};o.password&&(s.password=o.password),await V.updateUser(M.value,s),U.success("用户更新成功")}else await V.createUser(o),U.success("用户创建成功");v.value=!1,b()}catch(s){console.error("提交用户数据失败:",s)}finally{$.value=!1}},P=async s=>{try{await L.confirm(`确定要${s.is_active?"禁用":"启用"}用户 ${s.username} 吗？`,"确认操作",{type:"warning"}),await V.updateUser(s.id,{is_active:!s.is_active}),U.success(`用户${s.is_active?"禁用":"启用"}成功`),b()}catch(e){e!=="cancel"&&console.error("切换用户状态失败:",e)}},T=async s=>{try{await L.confirm(`确定要删除用户 ${s.username} 吗？此操作不可恢复！`,"确认删除",{type:"error"}),await V.deleteUser(s.id),U.success("用户删除成功"),b()}catch(e){e!=="cancel"&&console.error("删除用户失败:",e)}};return ae(()=>{b()}),(s,e)=>{const r=i("el-icon"),p=i("el-button"),m=i("el-input"),S=i("el-col"),j=i("el-option"),Q=i("el-select"),W=i("el-row"),d=i("el-table-column"),z=i("el-tag"),X=i("el-table"),Y=i("el-pagination"),_=i("el-form-item"),O=i("el-checkbox"),Z=i("el-dialog"),ee=oe("loading");return k(),te("div",pe,[f("div",me,[e[16]||(e[16]=f("div",{class:"header-content"},[f("h1",null,"用户管理"),f("p",null,"管理系统用户账户和权限")],-1)),f("div",_e,[l(p,{type:"primary",onClick:G},{default:t(()=>[l(r,null,{default:t(()=>[l(C(ne))]),_:1}),e[15]||(e[15]=n(" 新增用户 ",-1))]),_:1})])]),f("div",fe,[l(W,{gutter:20},{default:t(()=>[l(S,{span:6},{default:t(()=>[l(m,{modelValue:y.search,"onUpdate:modelValue":e[0]||(e[0]=a=>y.search=a),placeholder:"搜索用户名、姓名、邮箱",clearable:"",onKeyup:ie(w,["enter"])},{prefix:t(()=>[l(r,null,{default:t(()=>[l(C(K))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(S,{span:4},{default:t(()=>[l(Q,{modelValue:y.is_active,"onUpdate:modelValue":e[1]||(e[1]=a=>y.is_active=a),placeholder:"状态筛选",clearable:""},{default:t(()=>[l(j,{label:"全部",value:null}),l(j,{label:"启用",value:!0}),l(j,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),_:1}),l(S,{span:6},{default:t(()=>[l(p,{type:"primary",onClick:w},{default:t(()=>[l(r,null,{default:t(()=>[l(C(K))]),_:1}),e[17]||(e[17]=n(" 搜索 ",-1))]),_:1}),l(p,{onClick:A},{default:t(()=>[l(r,null,{default:t(()=>[l(C(re))]),_:1}),e[18]||(e[18]=n(" 重置 ",-1))]),_:1})]),_:1})]),_:1})]),f("div",ce,[se((k(),h(X,{data:B.value,style:{width:"100%"},"row-key":"id"},{default:t(()=>[l(d,{prop:"username",label:"用户名",width:"120"}),l(d,{prop:"real_name",label:"真实姓名",width:"120"}),l(d,{prop:"display_name",label:"显示名称",width:"120"}),l(d,{prop:"email",label:"邮箱",width:"180"}),l(d,{prop:"employee_id",label:"员工编号",width:"120"}),l(d,{label:"角色",width:"120"},{default:t(({row:a})=>[a.is_superuser?(k(),h(z,{key:0,type:"danger"},{default:t(()=>[...e[19]||(e[19]=[n("超级管理员",-1)])]),_:1})):a.is_admin?(k(),h(z,{key:1,type:"warning"},{default:t(()=>[...e[20]||(e[20]=[n("管理员",-1)])]),_:1})):(k(),h(z,{key:2,type:"info"},{default:t(()=>[...e[21]||(e[21]=[n("普通用户",-1)])]),_:1}))]),_:1}),l(d,{label:"状态",width:"80"},{default:t(({row:a})=>[l(z,{type:a.is_active?"success":"danger"},{default:t(()=>[n(E(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(d,{prop:"last_login",label:"最后登录",width:"160"},{default:t(({row:a})=>[n(E(a.last_login?I(a.last_login):"从未登录"),1)]),_:1}),l(d,{prop:"login_count",label:"登录次数",width:"100"}),l(d,{label:"操作",width:"180",fixed:"right"},{default:t(({row:a})=>[l(p,{size:"small",onClick:R=>H(a)},{default:t(()=>[...e[22]||(e[22]=[n("编辑",-1)])]),_:2},1032,["onClick"]),l(p,{size:"small",type:a.is_active?"warning":"success",onClick:R=>P(a)},{default:t(()=>[n(E(a.is_active?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(p,{size:"small",type:"danger",onClick:R=>T(a)},{default:t(()=>[...e[23]||(e[23]=[n(" 删除 ",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,D.value]]),f("div",ge,[l(Y,{"current-page":u.page,"onUpdate:currentPage":e[2]||(e[2]=a=>u.page=a),"page-size":u.size,"onUpdate:pageSize":e[3]||(e[3]=a=>u.size=a),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:w,onCurrentChange:w},null,8,["current-page","page-size","total"])])]),l(Z,{modelValue:v.value,"onUpdate:modelValue":e[14]||(e[14]=a=>v.value=a),title:c.value?"编辑用户":"新增用户",width:"600px",onClose:N},{footer:t(()=>[l(p,{onClick:e[13]||(e[13]=a=>v.value=!1)},{default:t(()=>[...e[26]||(e[26]=[n("取消",-1)])]),_:1}),l(p,{type:"primary",onClick:J,loading:$.value},{default:t(()=>[n(E(c.value?"更新":"创建"),1)]),_:1},8,["loading"])]),default:t(()=>[l(C(de),{ref_key:"userFormRef",ref:x,model:o,rules:q,"label-width":"100px"},{default:t(()=>[l(_,{label:"用户名",prop:"username"},{default:t(()=>[l(m,{modelValue:o.username,"onUpdate:modelValue":e[4]||(e[4]=a=>o.username=a),disabled:c.value,placeholder:"请输入用户名"},null,8,["modelValue","disabled"])]),_:1}),l(_,{label:"真实姓名",prop:"real_name"},{default:t(()=>[l(m,{modelValue:o.real_name,"onUpdate:modelValue":e[5]||(e[5]=a=>o.real_name=a),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),l(_,{label:"显示名称",prop:"display_name"},{default:t(()=>[l(m,{modelValue:o.display_name,"onUpdate:modelValue":e[6]||(e[6]=a=>o.display_name=a),placeholder:"请输入显示名称"},null,8,["modelValue"])]),_:1}),l(_,{label:"邮箱",prop:"email"},{default:t(()=>[l(m,{modelValue:o.email,"onUpdate:modelValue":e[7]||(e[7]=a=>o.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(_,{label:"员工编号",prop:"employee_id"},{default:t(()=>[l(m,{modelValue:o.employee_id,"onUpdate:modelValue":e[8]||(e[8]=a=>o.employee_id=a),placeholder:"请输入员工编号"},null,8,["modelValue"])]),_:1}),l(_,{label:"部门",prop:"department"},{default:t(()=>[l(m,{modelValue:o.department,"onUpdate:modelValue":e[9]||(e[9]=a=>o.department=a),placeholder:"请输入部门"},null,8,["modelValue"])]),_:1}),l(_,{label:"密码",prop:"password"},{default:t(()=>[l(m,{modelValue:o.password,"onUpdate:modelValue":e[10]||(e[10]=a=>o.password=a),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),l(_,{label:"权限设置"},{default:t(()=>[l(O,{modelValue:o.is_admin,"onUpdate:modelValue":e[11]||(e[11]=a=>o.is_admin=a)},{default:t(()=>[...e[24]||(e[24]=[n("管理员",-1)])]),_:1},8,["modelValue"]),l(O,{modelValue:o.is_superuser,"onUpdate:modelValue":e[12]||(e[12]=a=>o.is_superuser=a)},{default:t(()=>[...e[25]||(e[25]=[n("超级管理员",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});const we=ue(ve,[["__scopeId","data-v-acf374a5"]]);export{we as default};
