import{_ as X,G as Y,j as $,B as ee,k as te,q,l as u,n as ae,t as oe,r,v as se,o as N,z as j,w as s,E as T,M as E,b as n,a as e,f as m,e as le,x as y,y as ne,I as ie,K as re,d as ce}from"./index-1a649ac5-1758176310446.js";import{A as de}from"./AppLayout-71598910-1758176310710.js";import{a as ue,b as pe,t as ge,d as me,u as ve,c as _e}from"./deviceTypes-27cbf10e-1758176310715.js";const ye={name:"DeviceTypeManagement",components:{AppLayout:de,Plus:Y,Refresh:$,Search:ee},setup(){const V=te(),o=q(()=>V.getters["auth/currentUser"]),M=q(()=>V.getters["auth/userRole"]),a=q(()=>{var t;return((t=M.value)==null?void 0:t.toLowerCase())==="admin"}),x=u(!1),k=u(!1),w=u([]),C=u([]),d=u(""),f=u(1),S=u(20),h=u(0),p=u({total:0,active:0,inactive:0,usage_count:0}),D=u(!1),g=u(null),c=ae({name:"",code:"",category:"",status:"active",description:""}),z={name:[{required:!0,message:"请输入设备类型名称",trigger:"blur"},{min:2,max:50,message:"名称长度在 2 到 50 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入类型代码",trigger:"blur"},{pattern:/^[a-zA-Z][a-zA-Z0-9_-]*$/,message:"代码必须以字母开头，只能包含字母、数字、下划线和连字符",trigger:"blur"}],category:[{required:!0,message:"请选择设备分类",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},v=async()=>{x.value=!0;try{const t={skip:(f.value-1)*S.value,limit:S.value};d.value&&(t.search=d.value);const i=await ue(t);i&&i.data?(w.value=i.data,h.value=i.total||i.data.length):(w.value=[],h.value=0),await F()}catch(t){console.error("加载设备类型列表失败：",t),T.error("加载设备类型列表失败："+t.message)}finally{x.value=!1}},F=async()=>{try{const t=await pe();t&&t.data?p.value=t.data:t&&(p.value=t)}catch(t){console.error("加载统计信息失败：",t)}},_=()=>{v()},b=()=>{f.value=1,v()},A=()=>{d.value="",f.value=1,v()},U=t=>{S.value=t,f.value=1,v()},B=t=>{f.value=t,v()},R=t=>{C.value=t},L=t=>{g.value=t,Object.assign(c,{name:t.name,code:t.code,category:t.category,status:t.status,description:t.description}),D.value=!0},l=async t=>{try{const i=t.status==="active"?"inactive":"active",K=i==="active"?"启用":"禁用";await E.confirm(`确定要${K}设备类型"${t.name}"吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ge(t.id,{status:i}),T.success(`${K}成功`),_()}catch(i){i!=="cancel"&&T.error("操作失败："+i.message)}},P=async t=>{try{await E.confirm(`确定要删除设备类型"${t.name}"吗？此操作不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await me(t.id),T.success("删除成功"),_()}catch(i){i!=="cancel"&&T.error("删除失败："+i.message)}},Q=async()=>{k.value=!0;try{g.value?(await ve(g.value.id,c),T.success("设备类型更新成功")):(await _e(c),T.success("设备类型添加成功")),D.value=!1,_()}catch(t){T.error("操作失败："+t.message)}finally{k.value=!1}},H=()=>{Object.assign(c,{name:"",code:"",category:"",status:"active",description:""}),g.value=null},I=t=>t?new Date(t).toLocaleString("zh-CN"):"-",O=t=>({computing:"primary",network:"success",storage:"warning",security:"danger",office:"info",other:""})[t]||"",Z=t=>({computing:"计算设备",network:"网络设备",storage:"存储设备",security:"安全设备",office:"办公设备",other:"其他设备"})[t]||t,G=t=>({active:"success",inactive:"danger"})[t]||"info",J=t=>({active:{backgroundColor:"#f0f9ff",borderColor:"#67c23a",color:"#67c23a"},inactive:{backgroundColor:"#fef0f0",borderColor:"#f56c6c",color:"#f56c6c"}})[t]||{backgroundColor:"#f4f4f5",borderColor:"#909399",color:"#909399"},W=t=>({active:"启用",inactive:"禁用"})[t]||t;return oe(()=>{v()}),{loading:x,submitting:k,deviceTypeList:w,selectedDeviceTypes:C,searchQuery:d,currentPage:f,pageSize:S,total:h,statistics:p,showAddDialog:D,editingDeviceType:g,deviceTypeForm:c,deviceTypeRules:z,currentUser:o,userRole:M,isAdmin:a,loadDeviceTypes:v,refreshData:_,handleSearch:b,handleReset:A,handleSizeChange:U,handleCurrentChange:B,handleSelectionChange:R,editDeviceType:L,toggleStatus:l,deleteDeviceTypeHandler:P,submitForm:Q,resetForm:H,formatDate:I,getCategoryTagType:O,getCategoryText:Z,getStatusTagType:G,getStatusStyle:J,getStatusText:W}}},fe={class:"device-type-management"},he={class:"header-section"},be={class:"header-actions"},Te={class:"search-section"},Ce={class:"stats-section"},Se={class:"stats-item"},De={class:"stats-value"},we={class:"stats-item"},xe={class:"stats-value"},ke={class:"stats-item"},ze={class:"stats-value"},Ve={class:"stats-item"},Me={class:"stats-value"},Fe={class:"table-section"},Ae={class:"action-buttons"},Ue={class:"pagination-section"};function Be(V,o,M,a,x,k){const w=r("Plus"),C=r("el-icon"),d=r("el-button"),f=r("Refresh"),S=r("Search"),h=r("el-input"),p=r("el-col"),D=r("el-row"),g=r("el-card"),c=r("el-table-column"),z=r("el-tag"),v=r("el-table"),F=r("el-pagination"),_=r("el-form-item"),b=r("el-option"),A=r("el-select"),U=r("el-form"),B=r("el-dialog"),R=r("AppLayout"),L=se("loading");return N(),j(R,null,{default:s(()=>[n("div",fe,[n("div",he,[o[12]||(o[12]=n("h1",null,"设备类型管理",-1)),n("div",be,[e(d,{type:"primary",onClick:o[0]||(o[0]=l=>a.showAddDialog=!0)},{default:s(()=>[e(C,null,{default:s(()=>[e(w)]),_:1}),o[10]||(o[10]=m(" 添加设备类型 ",-1))]),_:1}),e(d,{type:"primary",onClick:a.refreshData},{default:s(()=>[e(C,null,{default:s(()=>[e(f)]),_:1}),o[11]||(o[11]=m(" 刷新 ",-1))]),_:1},8,["onClick"])])]),n("div",Te,[e(D,{gutter:20},{default:s(()=>[e(p,{span:8},{default:s(()=>[e(h,{modelValue:a.searchQuery,"onUpdate:modelValue":o[1]||(o[1]=l=>a.searchQuery=l),placeholder:"搜索设备类型名称或描述",clearable:"",onKeyup:le(a.handleSearch,["enter"])},{prefix:s(()=>[e(C,null,{default:s(()=>[e(S)]),_:1})]),_:1},8,["modelValue","onKeyup"])]),_:1}),e(p,{span:4},{default:s(()=>[e(d,{type:"primary",onClick:a.handleSearch},{default:s(()=>[...o[13]||(o[13]=[m("搜索",-1)])]),_:1},8,["onClick"]),e(d,{onClick:a.resetForm},{default:s(()=>[...o[14]||(o[14]=[m("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),n("div",Ce,[e(D,{gutter:20},{default:s(()=>[e(p,{span:6},{default:s(()=>[e(g,{class:"stats-card"},{default:s(()=>[n("div",Se,[n("div",De,y(a.statistics.total),1),o[15]||(o[15]=n("div",{class:"stats-label"},"设备类型总数",-1))])]),_:1})]),_:1}),e(p,{span:6},{default:s(()=>[e(g,{class:"stats-card"},{default:s(()=>[n("div",we,[n("div",xe,y(a.statistics.active),1),o[16]||(o[16]=n("div",{class:"stats-label"},"启用状态",-1))])]),_:1})]),_:1}),e(p,{span:6},{default:s(()=>[e(g,{class:"stats-card"},{default:s(()=>[n("div",ke,[n("div",ze,y(a.statistics.inactive),1),o[17]||(o[17]=n("div",{class:"stats-label"},"禁用状态",-1))])]),_:1})]),_:1}),e(p,{span:6},{default:s(()=>[e(g,{class:"stats-card"},{default:s(()=>[n("div",Ve,[n("div",Me,y(a.statistics.usage_count),1),o[18]||(o[18]=n("div",{class:"stats-label"},"使用中设备",-1))])]),_:1})]),_:1})]),_:1})]),n("div",Fe,[ne((N(),j(v,{data:a.deviceTypeList,stripe:"",onSelectionChange:a.handleSelectionChange},{default:s(()=>[e(c,{type:"selection",width:"80"}),e(c,{prop:"name",label:"设备类型名称",width:"220",sortable:"",align:"center"}),e(c,{prop:"code",label:"类型代码",width:"160",align:"center"}),e(c,{prop:"category",label:"设备分类",width:"160",align:"center"},{default:s(({row:l})=>[e(z,{type:a.getCategoryTagType(l.category),size:"small"},{default:s(()=>[m(y(a.getCategoryText(l.category)),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"status",label:"状态",width:"120",align:"center"},{default:s(({row:l})=>[e(z,{type:a.getStatusTagType(l.status),size:"small",style:ie(a.getStatusStyle(l.status))},{default:s(()=>[m(y(a.getStatusText(l.status)),1)]),_:2},1032,["type","style"])]),_:1}),e(c,{prop:"usage_count",label:"使用数量",width:"140",align:"center"}),e(c,{prop:"description",label:"描述",width:"200","show-overflow-tooltip":"",align:"center"},{default:s(({row:l})=>[n("span",null,y(l.description||"-"),1)]),_:1}),e(c,{prop:"created_at",label:"创建时间",width:"200",align:"center"},{default:s(({row:l})=>[n("span",null,y(a.formatDate(l.created_at)),1)]),_:1}),e(c,{label:"操作",width:"260",fixed:"right",align:"center"},{default:s(({row:l})=>[n("div",Ae,[e(d,{type:"primary",size:"small",onClick:P=>a.editDeviceType(l)},{default:s(()=>[...o[19]||(o[19]=[m(" 编辑 ",-1)])]),_:2},1032,["onClick"]),a.isAdmin?(N(),j(d,{key:0,type:"danger",plain:"",size:"small",disabled:l.usage_count>0,onClick:P=>a.deleteDeviceTypeHandler(l),title:l.usage_count>0?`该设备类型正在被 ${l.usage_count} 个设备使用，无法删除`:"删除设备类型",class:re({"delete-disabled":l.usage_count>0})},{default:s(()=>[...o[20]||(o[20]=[m(" 删除 ",-1)])]),_:2},1032,["disabled","onClick","title","class"])):ce("",!0)])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[L,a.loading]]),n("div",Ue,[e(F,{"current-page":a.currentPage,"onUpdate:currentPage":o[2]||(o[2]=l=>a.currentPage=l),"page-size":a.pageSize,"onUpdate:pageSize":o[3]||(o[3]=l=>a.pageSize=l),"page-sizes":[20,50,100],total:a.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),e(B,{modelValue:a.showAddDialog,"onUpdate:modelValue":o[9]||(o[9]=l=>a.showAddDialog=l),title:a.editingDeviceType?"编辑设备类型":"添加设备类型",width:"600px",onClose:a.resetForm},{footer:s(()=>[e(d,{onClick:o[8]||(o[8]=l=>a.showAddDialog=!1)},{default:s(()=>[...o[22]||(o[22]=[m("取消",-1)])]),_:1}),e(d,{type:"primary",onClick:a.submitForm,loading:a.submitting},{default:s(()=>[m(y(a.editingDeviceType?"更新":"添加"),1)]),_:1},8,["onClick","loading"])]),default:s(()=>[e(U,{ref:"deviceTypeFormRef",model:a.deviceTypeForm,rules:a.deviceTypeRules,"label-width":"120px"},{default:s(()=>[e(_,{label:"设备类型名称",prop:"name"},{default:s(()=>[e(h,{modelValue:a.deviceTypeForm.name,"onUpdate:modelValue":o[4]||(o[4]=l=>a.deviceTypeForm.name=l),placeholder:"如：服务器、工作站等"},null,8,["modelValue"])]),_:1}),e(_,{label:"类型代码",prop:"code"},{default:s(()=>[e(h,{modelValue:a.deviceTypeForm.code,"onUpdate:modelValue":o[5]||(o[5]=l=>a.deviceTypeForm.code=l),placeholder:"如：server、workstation等"},null,8,["modelValue"]),o[21]||(o[21]=n("div",{class:"form-tip"},"类型代码用于系统内部标识，建议使用英文",-1))]),_:1}),e(_,{label:"设备分类",prop:"category"},{default:s(()=>[e(A,{modelValue:a.deviceTypeForm.category,"onUpdate:modelValue":o[6]||(o[6]=l=>a.deviceTypeForm.category=l),placeholder:"选择设备分类",style:{width:"100%"}},{default:s(()=>[e(b,{label:"计算设备",value:"computing"}),e(b,{label:"网络设备",value:"network"}),e(b,{label:"存储设备",value:"storage"}),e(b,{label:"安全设备",value:"security"}),e(b,{label:"办公设备",value:"office"}),e(b,{label:"其他设备",value:"other"})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"描述",prop:"description"},{default:s(()=>[e(h,{modelValue:a.deviceTypeForm.description,"onUpdate:modelValue":o[7]||(o[7]=l=>a.deviceTypeForm.description=l),type:"textarea",rows:3,placeholder:"设备类型的详细描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","onClose"])])]),_:1})}const qe=X(ye,[["render",Be],["__scopeId","data-v-1391c4a8"]]);export{qe as default};
