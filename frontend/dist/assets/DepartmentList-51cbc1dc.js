import{d as we,r as c,a as Ce,R as W,o as Ve,c as V,e as t,w as l,n as b,i as d,D as ke,j as y,b as n,g,H as he,l as s,S as De,t as _,I as xe,G as ze,x as Se,L as X,J as $e,K as Le,z as Ue,M as Y,_ as Ee}from"./index-de8d932e.js";import{d as w}from"./department-9b96297e.js";const Re={class:"department-list"},Te={class:"toolbar"},Be={class:"toolbar-left"},Ne={class:"toolbar-right"},Ae={key:0},Me={class:"tree-node"},je={class:"node-content"},Ie={class:"node-label"},Pe={class:"node-actions"},qe={key:1},Fe={key:0},Ke={key:1,class:"text-muted"},Oe={key:0,class:"stats-container"},Ge={class:"stat-item"},He={class:"stat-value"},Je={class:"stat-item"},Qe={class:"stat-value"},We={class:"stat-item"},Xe={class:"stat-value"},Ye={class:"stat-item"},Ze={class:"stat-value"},et=we({__name:"DepartmentList",setup(tt){const T=c(!1),B=c([]),N=c([]),Z=c([]),k=c(""),z=c(!0),f=c(!1),h=c(!1),S=c(!1),A=c(),r=Ce({name:"",code:"",parent_id:void 0,description:"",is_active:!0}),ee={name:[{required:!0,message:"请输入部门名称",trigger:"blur"}],code:[{required:!0,message:"请输入部门编码",trigger:"blur"}]},M=c(!1),C=c(),$=c(),j=c(),te={children:"children",label:"name"},le={children:"children",label:"name",value:"id"},ae=W(()=>k.value?B.value.filter(a=>a.name.toLowerCase().includes(k.value.toLowerCase())||a.code.toLowerCase().includes(k.value.toLowerCase())):B.value),oe=W(()=>{var e;const a=(p,i)=>p.filter(m=>m.id!==i).map(m=>({...m,children:m.children?a(m.children,i):void 0}));return a(N.value,(e=$.value)==null?void 0:e.id)}),se=a=>new Date(a).toLocaleString("zh-CN"),D=async()=>{T.value=!0;try{const a=await w.getList({limit:1e3});B.value=a;const e=await w.getTree();N.value=e}catch(a){b.error("加载数据失败"),console.error(a)}finally{T.value=!1}},ne=()=>{},de=()=>{z.value=!z.value},ie=()=>{h.value=!1,S.value=!1,j.value=void 0,K(),f.value=!0},I=a=>{h.value=!1,S.value=!0,j.value=a,K(),r.parent_id=a.id,f.value=!0},P=a=>{h.value=!0,S.value=!1,$.value=a,Object.assign(r,{name:a.name,code:a.code,parent_id:a.parent_id,description:a.description||"",is_active:a.is_active}),f.value=!0},re=async()=>{if(A.value)try{await A.value.validate(),h.value&&$.value?(await w.update($.value.id,r),b.success("部门更新成功")):(await w.create(r),b.success("部门创建成功")),f.value=!1,D()}catch(a){console.error("保存部门失败:",a)}},q=async a=>{try{const e=await w.getStatistics(a.id);C.value=e,M.value=!0}catch(e){b.error("获取统计信息失败"),console.error(e)}},ue=()=>{b.info("导出功能开发中...")},ce=a=>{Z.value=a},F=async(a,e)=>{switch(a){case"enable":case"disable":await _e(e);break;case"delete":await me(e);break}},_e=async a=>{try{const e=a.is_active?"禁用":"启用";await Y.confirm(`确定要${e}部门 ${a.name} 吗？`,`确认${e}`,{type:"warning"}),await w.update(a.id,{is_active:!a.is_active}),b.success(`${e}成功`),D()}catch(e){e!=="cancel"&&console.error("切换部门状态失败:",e)}},me=async a=>{try{await Y.confirm(`确定要删除部门 ${a.name} 吗？此操作不可恢复！`,"确认删除",{type:"warning"}),await w.delete(a.id),b.success("删除成功"),D()}catch(e){e!=="cancel"&&console.error("删除部门失败:",e)}},K=()=>{Object.assign(r,{name:"",code:"",parent_id:void 0,description:"",is_active:!0})};return Ve(()=>{D()}),(a,e)=>{const p=d("el-icon"),i=d("el-button"),m=d("el-input"),O=d("el-card"),L=d("el-tag"),U=d("el-dropdown-item"),G=d("el-dropdown-menu"),H=d("el-dropdown"),pe=d("el-tree"),v=d("el-table-column"),ve=d("el-table"),x=d("el-form-item"),fe=d("el-tree-select"),be=d("el-switch"),ye=d("el-form"),J=d("el-dialog"),E=d("el-col"),Q=d("el-row"),ge=ke("loading");return y(),V("div",Re,[t(O,{class:"toolbar-card"},{default:l(()=>[n("div",Te,[n("div",Be,[t(i,{type:"primary",onClick:ie},{default:l(()=>[t(p,null,{default:l(()=>[t(g(he))]),_:1}),e[9]||(e[9]=s(" 新增部门 ",-1))]),_:1}),t(i,{type:"success",onClick:de},{default:l(()=>[t(p,null,{default:l(()=>[t(g(De))]),_:1}),s(" "+_(z.value?"列表视图":"树形视图"),1)]),_:1}),t(i,{type:"warning",onClick:ue},{default:l(()=>[t(p,null,{default:l(()=>[t(g(xe))]),_:1}),e[10]||(e[10]=s(" 导出数据 ",-1))]),_:1})]),n("div",Ne,[t(m,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=o=>k.value=o),placeholder:"搜索部门名称或编码",clearable:"",style:{width:"200px","margin-right":"10px"},onInput:ne},{prefix:l(()=>[t(p,null,{default:l(()=>[t(g(ze))]),_:1})]),_:1},8,["modelValue"]),t(i,{onClick:D},{default:l(()=>[t(p,null,{default:l(()=>[t(g(Se))]),_:1}),e[11]||(e[11]=s(" 刷新 ",-1))]),_:1})])])]),_:1}),t(O,{class:"table-card"},{default:l(()=>[z.value?(y(),V("div",Ae,[t(pe,{data:N.value,props:te,"expand-on-click-node":!1,"default-expand-all":"","node-key":"id",class:"department-tree"},{default:l(({node:o,data:u})=>[n("div",Me,[n("div",je,[n("span",Ie,_(u.name),1),t(L,{size:"small",class:"node-code"},{default:l(()=>[s(_(u.code),1)]),_:2},1024),t(L,{type:u.is_active?"success":"danger",size:"small",class:"node-status"},{default:l(()=>[s(_(u.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),n("div",Pe,[t(i,{type:"primary",size:"small",onClick:R=>I(u)},{default:l(()=>[...e[12]||(e[12]=[s(" 添加子部门 ",-1)])]),_:2},1032,["onClick"]),t(i,{type:"info",size:"small",onClick:R=>q(u)},{default:l(()=>[...e[13]||(e[13]=[s(" 统计 ",-1)])]),_:2},1032,["onClick"]),t(i,{type:"warning",size:"small",onClick:R=>P(u)},{default:l(()=>[...e[14]||(e[14]=[s(" 编辑 ",-1)])]),_:2},1032,["onClick"]),t(H,{onCommand:R=>F(R,u)},{dropdown:l(()=>[t(G,null,{default:l(()=>[t(U,{command:u.is_active?"disable":"enable"},{default:l(()=>[s(_(u.is_active?"禁用":"启用"),1)]),_:2},1032,["command"]),t(U,{command:"delete",divided:""},{default:l(()=>[...e[16]||(e[16]=[s("删除",-1)])]),_:1})]),_:2},1024)]),default:l(()=>[t(i,{size:"small"},{default:l(()=>[e[15]||(e[15]=s(" 更多",-1)),t(p,null,{default:l(()=>[t(g(X))]),_:1})]),_:1})]),_:2},1032,["onCommand"])])])]),_:1},8,["data"])])):(y(),V("div",qe,[$e((y(),Le(ve,{data:ae.value,stripe:"",border:"",style:{width:"100%"},onSelectionChange:ce},{default:l(()=>[t(v,{type:"selection",width:"50"}),t(v,{prop:"name",label:"部门名称",width:"200"}),t(v,{prop:"code",label:"部门编码",width:"150"},{default:l(({row:o})=>[t(L,null,{default:l(()=>[s(_(o.code),1)]),_:2},1024)]),_:1}),t(v,{label:"上级部门",width:"150"},{default:l(({row:o})=>[o.parent?(y(),V("span",Fe,_(o.parent.name),1)):(y(),V("span",Ke,"无"))]),_:1}),t(v,{prop:"description",label:"部门描述","min-width":"200","show-overflow-tooltip":""}),t(v,{label:"状态",width:"80"},{default:l(({row:o})=>[t(L,{type:o.is_active?"success":"danger",size:"small"},{default:l(()=>[s(_(o.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(v,{prop:"created_at",label:"创建时间",width:"150"},{default:l(({row:o})=>[s(_(se(o.created_at)),1)]),_:1}),t(v,{label:"操作",width:"280",fixed:"right"},{default:l(({row:o})=>[t(i,{type:"primary",size:"small",onClick:u=>I(o)},{default:l(()=>[...e[17]||(e[17]=[s(" 添加子部门 ",-1)])]),_:2},1032,["onClick"]),t(i,{type:"info",size:"small",onClick:u=>q(o)},{default:l(()=>[...e[18]||(e[18]=[s(" 统计 ",-1)])]),_:2},1032,["onClick"]),t(i,{type:"warning",size:"small",onClick:u=>P(o)},{default:l(()=>[...e[19]||(e[19]=[s(" 编辑 ",-1)])]),_:2},1032,["onClick"]),t(H,{onCommand:u=>F(u,o)},{dropdown:l(()=>[t(G,null,{default:l(()=>[t(U,{command:o.is_active?"disable":"enable"},{default:l(()=>[s(_(o.is_active?"禁用":"启用"),1)]),_:2},1032,["command"]),t(U,{command:"delete",divided:""},{default:l(()=>[...e[21]||(e[21]=[s("删除",-1)])]),_:1})]),_:2},1024)]),default:l(()=>[t(i,{size:"small"},{default:l(()=>[e[20]||(e[20]=s(" 更多",-1)),t(p,null,{default:l(()=>[t(g(X))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"])),[[ge,T.value]])]))]),_:1}),t(J,{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=o=>f.value=o),title:h.value?"编辑部门":S.value?"新增子部门":"新增部门",width:"600px"},{footer:l(()=>[t(i,{onClick:e[6]||(e[6]=o=>f.value=!1)},{default:l(()=>[...e[22]||(e[22]=[s("取消",-1)])]),_:1}),t(i,{type:"primary",onClick:re},{default:l(()=>[...e[23]||(e[23]=[s("确认",-1)])]),_:1})]),default:l(()=>[t(ye,{ref_key:"formRef",ref:A,model:r,rules:ee,"label-width":"100px"},{default:l(()=>[t(x,{label:"部门名称",prop:"name"},{default:l(()=>[t(m,{modelValue:r.name,"onUpdate:modelValue":e[1]||(e[1]=o=>r.name=o),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),t(x,{label:"部门编码",prop:"code"},{default:l(()=>[t(m,{modelValue:r.code,"onUpdate:modelValue":e[2]||(e[2]=o=>r.code=o),placeholder:"请输入部门编码"},null,8,["modelValue"])]),_:1}),t(x,{label:"上级部门"},{default:l(()=>[t(fe,{modelValue:r.parent_id,"onUpdate:modelValue":e[3]||(e[3]=o=>r.parent_id=o),data:oe.value,props:le,placeholder:"请选择上级部门",clearable:"","check-strictly":"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),t(x,{label:"部门描述"},{default:l(()=>[t(m,{modelValue:r.description,"onUpdate:modelValue":e[4]||(e[4]=o=>r.description=o),type:"textarea",rows:3,placeholder:"请输入部门描述"},null,8,["modelValue"])]),_:1}),t(x,{label:"状态"},{default:l(()=>[t(be,{modelValue:r.is_active,"onUpdate:modelValue":e[5]||(e[5]=o=>r.is_active=o),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(J,{modelValue:M.value,"onUpdate:modelValue":e[8]||(e[8]=o=>M.value=o),title:"部门统计信息",width:"500px"},{default:l(()=>[C.value?(y(),V("div",Oe,[t(Q,{gutter:20},{default:l(()=>[t(E,{span:12},{default:l(()=>[n("div",Ge,[e[24]||(e[24]=n("div",{class:"stat-label"},"用户数量",-1)),n("div",He,_(C.value.user_count),1)])]),_:1}),t(E,{span:12},{default:l(()=>[n("div",Je,[e[25]||(e[25]=n("div",{class:"stat-label"},"子部门数量",-1)),n("div",Qe,_(C.value.children_count),1)])]),_:1})]),_:1}),t(Q,{gutter:20,style:{"margin-top":"20px"}},{default:l(()=>[t(E,{span:12},{default:l(()=>[n("div",We,[e[26]||(e[26]=n("div",{class:"stat-label"},"负责网段",-1)),n("div",Xe,_(C.value.segment_count),1)])]),_:1}),t(E,{span:12},{default:l(()=>[n("div",Ye,[e[27]||(e[27]=n("div",{class:"stat-label"},"分配IP数",-1)),n("div",Ze,_(C.value.ip_count),1)])]),_:1})]),_:1})])):Ue("",!0)]),_:1},8,["modelValue"])])}}});const ot=Ee(et,[["__scopeId","data-v-56e8e765"]]);export{ot as default};
