import{a0 as E,m as N,_ as M,r as l,o as p,p as _,w as s,b as o,e as n,t as I,a as i,c as H,u as C,K as R,a1 as A,R as B,a2 as J}from"./index-9c6477ff-1757487666975.js";import{T as Q}from"./ThemeToggle-d445fee0-1757487667116.js";const X={name:"UserProfile",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{activeTab:"profile",profileLoading:!1,passwordLoading:!1,profileForm:{email:"",theme:"light"},passwordForm:{oldPassword:"",newPassword:"",confirmPassword:""},profileRules:{email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},passwordRules:{oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:8,message:"密码长度至少8位",trigger:"blur"},{validator:this.validatePassword,trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:this.validateConfirmPassword,trigger:"blur"}]}}},computed:{...E("auth",["currentUser"]),visible:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}},watch:{visible(t){t&&this.initForms()}},methods:{...N("auth",["updateProfile","changePassword"]),initForms(){this.profileForm={email:this.currentUser.email||"",theme:this.currentUser.theme||"light"},this.resetPasswordForm()},resetPasswordForm(){this.passwordForm={oldPassword:"",newPassword:"",confirmPassword:""},this.$nextTick(()=>{this.$refs.passwordForm&&this.$refs.passwordForm.clearValidate()})},validatePassword(t,e,a){if(!e){a(new Error("请输入新密码"));return}const F=/[A-Z]/.test(e),r=/[a-z]/.test(e),u=/\d/.test(e);if(!F){a(new Error("密码必须包含至少一个大写字母"));return}if(!r){a(new Error("密码必须包含至少一个小写字母"));return}if(!u){a(new Error("密码必须包含至少一个数字"));return}a()},validateConfirmPassword(t,e,a){if(!e){a(new Error("请确认新密码"));return}if(e!==this.passwordForm.newPassword){a(new Error("两次输入的密码不一致"));return}a()},async handleUpdateProfile(){var t,e;try{if(!await this.$refs.profileForm.validate())return;this.profileLoading=!0,await this.updateProfile(this.profileForm),this.$message.success("个人信息更新成功"),this.profileForm.theme!==this.currentUser.theme&&this.$store.dispatch("theme/setTheme",this.profileForm.theme)}catch(a){console.error("Update profile error:",a),this.$message.error(((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.detail)||"更新个人信息失败")}finally{this.profileLoading=!1}},async handleChangePassword(){var t,e;try{if(!await this.$refs.passwordForm.validate())return;this.passwordLoading=!0,await this.changePassword({old_password:this.passwordForm.oldPassword,new_password:this.passwordForm.newPassword}),this.$message.success("密码修改成功"),this.resetPasswordForm(),this.activeTab="profile"}catch(a){console.error("Change password error:",a),this.$message.error(((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.detail)||"密码修改失败")}finally{this.passwordLoading=!1}},handleClose(){this.visible=!1,this.activeTab="profile",this.resetPasswordForm()},getRoleType(t){return{admin:"danger",manager:"warning",user:"info"}[t]||"info"},getRoleText(t){return{admin:"超级管理员",manager:"管理员",user:"普通用户"}[t]||"未知角色"}}},Y={class:"dialog-footer"},$={class:"dialog-footer"};function ee(t,e,a,F,r,u){const w=l("el-input"),f=l("el-form-item"),m=l("el-tag"),c=l("el-radio"),V=l("el-radio-group"),b=l("el-form"),h=l("el-button"),y=l("el-tab-pane"),v=l("el-alert"),U=l("el-tabs"),T=l("el-dialog");return p(),_(T,{modelValue:u.visible,"onUpdate:modelValue":e[7]||(e[7]=d=>u.visible=d),title:"个人信息",width:"500px","before-close":u.handleClose},{default:s(()=>[o(U,{modelValue:r.activeTab,"onUpdate:modelValue":e[6]||(e[6]=d=>r.activeTab=d),type:"border-card"},{default:s(()=>[o(y,{label:"个人信息",name:"profile"},{default:s(()=>[o(b,{ref:"profileForm",model:r.profileForm,rules:r.profileRules,"label-width":"80px"},{default:s(()=>[o(f,{label:"用户名"},{default:s(()=>[o(w,{modelValue:t.currentUser.username,"onUpdate:modelValue":e[0]||(e[0]=d=>t.currentUser.username=d),disabled:""},null,8,["modelValue"])]),_:1}),o(f,{label:"角色"},{default:s(()=>[o(m,{type:u.getRoleType(t.currentUser.role)},{default:s(()=>[n(I(u.getRoleText(t.currentUser.role)),1)]),_:1},8,["type"])]),_:1}),o(f,{label:"邮箱",prop:"email"},{default:s(()=>[o(w,{modelValue:r.profileForm.email,"onUpdate:modelValue":e[1]||(e[1]=d=>r.profileForm.email=d),placeholder:"请输入邮箱地址",type:"email"},null,8,["modelValue"])]),_:1}),o(f,{label:"主题",prop:"theme"},{default:s(()=>[o(V,{modelValue:r.profileForm.theme,"onUpdate:modelValue":e[2]||(e[2]=d=>r.profileForm.theme=d)},{default:s(()=>[o(c,{label:"light"},{default:s(()=>[...e[8]||(e[8]=[n("明亮主题",-1)])]),_:1}),o(c,{label:"dark"},{default:s(()=>[...e[9]||(e[9]=[n("暗黑主题",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),i("div",Y,[o(h,{onClick:u.handleClose},{default:s(()=>[...e[10]||(e[10]=[n("取消",-1)])]),_:1},8,["onClick"]),o(h,{type:"primary",loading:r.profileLoading,onClick:u.handleUpdateProfile},{default:s(()=>[...e[11]||(e[11]=[n(" 保存 ",-1)])]),_:1},8,["loading","onClick"])])]),_:1}),o(y,{label:"修改密码",name:"password"},{default:s(()=>[o(b,{ref:"passwordForm",model:r.passwordForm,rules:r.passwordRules,"label-width":"80px"},{default:s(()=>[o(f,{label:"旧密码",prop:"oldPassword"},{default:s(()=>[o(w,{modelValue:r.passwordForm.oldPassword,"onUpdate:modelValue":e[3]||(e[3]=d=>r.passwordForm.oldPassword=d),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),o(f,{label:"新密码",prop:"newPassword"},{default:s(()=>[o(w,{modelValue:r.passwordForm.newPassword,"onUpdate:modelValue":e[4]||(e[4]=d=>r.passwordForm.newPassword=d),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(f,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[o(w,{modelValue:r.passwordForm.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=d=>r.passwordForm.confirmPassword=d),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(v,{title:"密码要求",type:"info",closable:!1,"show-icon":""},{default:s(()=>[...e[12]||(e[12]=[i("ul",{style:{margin:"0","padding-left":"20px"}},[i("li",null,"长度至少8位"),i("li",null,"包含至少一个大写字母"),i("li",null,"包含至少一个小写字母"),i("li",null,"包含至少一个数字")],-1)])]),_:1})]),_:1},8,["model","rules"]),i("div",$,[o(h,{onClick:u.resetPasswordForm},{default:s(()=>[...e[13]||(e[13]=[n("重置",-1)])]),_:1},8,["onClick"]),o(h,{type:"primary",loading:r.passwordLoading,onClick:u.handleChangePassword},{default:s(()=>[...e[14]||(e[14]=[n(" 修改密码 ",-1)])]),_:1},8,["loading","onClick"])])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","before-close"])}const oe=M(X,[["render",ee],["__scopeId","data-v-fe759a66"]]);const se={name:"AppLayout",components:{ThemeToggle:Q,UserProfile:oe},data(){return{showUserProfile:!1,sidebarCollapsed:!1}},computed:{...E("auth",["isAuthenticated","userName","userRole"]),sidebarWidth(){return this.sidebarCollapsed?"64px":"240px"},activeMenu(){return this.$route.path}},methods:{...N("auth",["logout"]),toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed,localStorage.setItem("sidebarCollapsed",this.sidebarCollapsed.toString())},handleUserMenuCommand(t){switch(t){case"profile":this.showUserProfile=!0;break;case"logout":this.handleLogout();break}},async handleLogout(){try{await this.logout(),this.$message.success("退出登录成功"),this.$router.push("/login")}catch(t){console.error("Logout error:",t),this.$message.error("退出登录失败")}}},mounted(){const t=localStorage.getItem("sidebarCollapsed");t!==null&&(this.sidebarCollapsed=t==="true")}},te={class:"app-layout"},le={class:"header-left"},re={class:"header-right"},ae={class:"sidebar-content"},ne={class:"sidebar-header"},de={class:"system-info"},ie={class:"system-title"},ue={class:"system-subtitle"};function me(t,e,a,F,r,u){const w=l("Expand"),f=l("Fold"),m=l("el-icon"),c=l("el-button"),V=l("ThemeToggle"),b=l("User"),h=l("arrow-down"),y=l("Setting"),v=l("el-dropdown-item"),U=l("SwitchButton"),T=l("el-dropdown-menu"),d=l("el-dropdown"),D=l("el-header"),k=l("Monitor"),g=l("el-menu-item"),q=l("Connection"),x=l("Grid"),L=l("el-sub-menu"),G=l("OfficeBuilding"),z=l("Document"),O=l("el-menu"),W=l("el-aside"),K=l("el-main"),Z=l("el-container"),j=l("UserProfile");return p(),H("div",te,[o(D,{class:"app-header"},{default:s(()=>[i("div",le,[t.isAuthenticated?(p(),_(c,{key:0,type:"text",class:"sidebar-toggle",onClick:u.toggleSidebar},{default:s(()=>[o(m,null,{default:s(()=>[r.sidebarCollapsed?(p(),_(w,{key:0})):(p(),_(f,{key:1}))]),_:1})]),_:1},8,["onClick"])):C("",!0),e[2]||(e[2]=i("h1",{class:"app-title"},"网络资源管理系统",-1))]),i("div",re,[o(V),t.isAuthenticated?(p(),_(d,{key:0,onCommand:u.handleUserMenuCommand},{dropdown:s(()=>[o(T,null,{default:s(()=>[o(v,{command:"profile"},{default:s(()=>[o(m,null,{default:s(()=>[o(y)]),_:1}),e[3]||(e[3]=n(" 个人设置 ",-1))]),_:1}),o(v,{divided:"",command:"logout"},{default:s(()=>[o(m,null,{default:s(()=>[o(U)]),_:1}),e[4]||(e[4]=n(" 退出登录 ",-1))]),_:1})]),_:1})]),default:s(()=>[o(c,{type:"text",class:"user-menu-button"},{default:s(()=>[o(m,null,{default:s(()=>[o(b)]),_:1}),n(" "+I(t.userName)+" ",1),o(m,{class:"el-icon--right"},{default:s(()=>[o(h)]),_:1})]),_:1})]),_:1},8,["onCommand"])):(p(),_(c,{key:1,type:"primary",onClick:e[0]||(e[0]=P=>t.$router.push("/login"))},{default:s(()=>[...e[5]||(e[5]=[n(" 登录 ",-1)])]),_:1}))])]),_:1}),o(Z,{class:"app-container"},{default:s(()=>[t.isAuthenticated?(p(),_(W,{key:0,width:u.sidebarWidth,class:B(["app-sidebar",{"sidebar-collapsed":r.sidebarCollapsed}])},{default:s(()=>[i("div",ae,[i("div",ne,[i("div",de,[R(i("div",ie,"网络资源管理系统",512),[[A,!r.sidebarCollapsed]]),R(i("div",ue,"企业网络资源管理平台",512),[[A,!r.sidebarCollapsed]])])]),o(O,{"default-active":u.activeMenu,class:"sidebar-menu",collapse:r.sidebarCollapsed,"collapse-transition":!1,router:""},{default:s(()=>{var P,S;return[o(g,{index:"/dashboard"},{title:s(()=>[...e[6]||(e[6]=[n("仪表盘",-1)])]),default:s(()=>[o(m,null,{default:s(()=>[o(k)]),_:1})]),_:1}),o(L,{index:"network-resources"},{title:s(()=>[o(m,null,{default:s(()=>[o(q)]),_:1}),e[7]||(e[7]=i("span",null,"网络资源管理",-1))]),default:s(()=>[o(g,{index:"/ip-management"},{title:s(()=>[...e[8]||(e[8]=[n("IP地址管理",-1)])]),default:s(()=>[o(m,null,{default:s(()=>[o(x)]),_:1})]),_:1}),o(g,{index:"/device-type-management"},{title:s(()=>[...e[9]||(e[9]=[n("设备类型管理",-1)])]),default:s(()=>[o(m,null,{default:s(()=>[o(k)]),_:1})]),_:1})]),_:1}),o(g,{index:"/subnet-management"},{title:s(()=>[...e[10]||(e[10]=[n("网段管理",-1)])]),default:s(()=>[o(m,null,{default:s(()=>[o(x)]),_:1})]),_:1}),((P=t.userRole)==null?void 0:P.toLowerCase())==="admin"?(p(),_(L,{key:0,index:"system-management"},{title:s(()=>[o(m,null,{default:s(()=>[o(y)]),_:1}),e[11]||(e[11]=i("span",null,"系统管理",-1))]),default:s(()=>[o(g,{index:"/user-management"},{title:s(()=>[...e[12]||(e[12]=[n("用户管理",-1)])]),default:s(()=>[o(m,null,{default:s(()=>[o(b)]),_:1})]),_:1}),o(g,{index:"/department-management"},{title:s(()=>[...e[13]||(e[13]=[n("组织管理",-1)])]),default:s(()=>[o(m,null,{default:s(()=>[o(G)]),_:1})]),_:1})]),_:1})):C("",!0),((S=t.userRole)==null?void 0:S.toLowerCase())==="admin"?(p(),_(g,{key:1,index:"/audit-logs"},{title:s(()=>[...e[14]||(e[14]=[n("审计日志",-1)])]),default:s(()=>[o(m,null,{default:s(()=>[o(z)]),_:1})]),_:1})):C("",!0)]}),_:1},8,["default-active","collapse"])])]),_:1},8,["width","class"])):C("",!0),o(K,{class:B(["app-main",{"main-expanded":!t.isAuthenticated||r.sidebarCollapsed}])},{default:s(()=>[J(t.$slots,"default",{},void 0,!0)]),_:3},8,["class"])]),_:3}),o(j,{modelValue:r.showUserProfile,"onUpdate:modelValue":e[1]||(e[1]=P=>r.showUserProfile=P)},null,8,["modelValue"])])}const _e=M(se,[["render",me],["__scopeId","data-v-451d15ed"]]);export{_e as A};
