import{_ as X,O as Y,A as $,M as ee,I as te,h as j,f as u,g as ae,j as oe,r,J as le,o as K,p as N,w as l,E as T,T as Q,a as n,b as e,e as m,d as se,t as f,K as ne,Q as ie,R as re}from"./index-665965f3-1757496061419.js";import{A as ce}from"./AppLayout-bfa7eea0-1757496061774.js";import{a as de,b as ue,t as pe,d as ge,u as me,c as ve}from"./deviceTypes-1a93fcfe-1757496061777.js";import"./ThemeToggle-68291afb-1757496061653.js";const _e={name:"DeviceTypeManagement",components:{AppLayout:ce,Plus:Y,Refresh:$,Search:ee},setup(){const V=te(),o=j(()=>V.getters["auth/currentUser"]),M=j(()=>V.getters["auth/userRole"]),a=j(()=>{var t;return((t=M.value)==null?void 0:t.toLowerCase())==="admin"}),x=u(!1),k=u(!1),w=u([]),C=u([]),d=u(""),y=u(1),S=u(20),h=u(0),p=u({total:0,active:0,inactive:0,usage_count:0}),D=u(!1),g=u(null),c=ae({name:"",code:"",category:"",status:"active",description:""}),z={name:[{required:!0,message:"请输入设备类型名称",trigger:"blur"},{min:2,max:50,message:"名称长度在 2 到 50 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入类型代码",trigger:"blur"},{pattern:/^[a-zA-Z][a-zA-Z0-9_-]*$/,message:"代码必须以字母开头，只能包含字母、数字、下划线和连字符",trigger:"blur"}],category:[{required:!0,message:"请选择设备分类",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},v=async()=>{x.value=!0;try{const t={skip:(y.value-1)*S.value,limit:S.value};d.value&&(t.search=d.value);const i=await de(t);i&&i.data?(w.value=i.data,h.value=i.total||i.data.length):(w.value=[],h.value=0),await F()}catch(t){console.error("加载设备类型列表失败：",t),T.error("加载设备类型列表失败："+t.message)}finally{x.value=!1}},F=async()=>{try{const t=await ue();t&&t.data?p.value=t.data:t&&(p.value=t)}catch(t){console.error("加载统计信息失败：",t)}},_=()=>{v()},b=()=>{y.value=1,v()},A=()=>{d.value="",y.value=1,v()},R=t=>{S.value=t,y.value=1,v()},U=t=>{y.value=t,v()},B=t=>{C.value=t},L=t=>{g.value=t,Object.assign(c,{name:t.name,code:t.code,category:t.category,status:t.status,description:t.description}),D.value=!0},s=async t=>{try{const i=t.status==="active"?"inactive":"active",q=i==="active"?"启用":"禁用";await Q.confirm(`确定要${q}设备类型"${t.name}"吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await pe(t.id,{status:i}),T.success(`${q}成功`),_()}catch(i){i!=="cancel"&&T.error("操作失败："+i.message)}},P=async t=>{try{await Q.confirm(`确定要删除设备类型"${t.name}"吗？此操作不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ge(t.id),T.success("删除成功"),_()}catch(i){i!=="cancel"&&T.error("删除失败："+i.message)}},E=async()=>{k.value=!0;try{g.value?(await me(g.value.id,c),T.success("设备类型更新成功")):(await ve(c),T.success("设备类型添加成功")),D.value=!1,_()}catch(t){T.error("操作失败："+t.message)}finally{k.value=!1}},O=()=>{Object.assign(c,{name:"",code:"",category:"",status:"active",description:""}),g.value=null},H=t=>t?new Date(t).toLocaleString("zh-CN"):"-",I=t=>({computing:"primary",network:"success",storage:"warning",security:"danger",office:"info",other:""})[t]||"",Z=t=>({computing:"计算设备",network:"网络设备",storage:"存储设备",security:"安全设备",office:"办公设备",other:"其他设备"})[t]||t,J=t=>({active:"success",inactive:"danger"})[t]||"info",G=t=>({active:{backgroundColor:"#f0f9ff",borderColor:"#67c23a",color:"#67c23a"},inactive:{backgroundColor:"#fef0f0",borderColor:"#f56c6c",color:"#f56c6c"}})[t]||{backgroundColor:"#f4f4f5",borderColor:"#909399",color:"#909399"},W=t=>({active:"启用",inactive:"禁用"})[t]||t;return oe(()=>{v()}),{loading:x,submitting:k,deviceTypeList:w,selectedDeviceTypes:C,searchQuery:d,currentPage:y,pageSize:S,total:h,statistics:p,showAddDialog:D,editingDeviceType:g,deviceTypeForm:c,deviceTypeRules:z,currentUser:o,userRole:M,isAdmin:a,loadDeviceTypes:v,refreshData:_,handleSearch:b,handleReset:A,handleSizeChange:R,handleCurrentChange:U,handleSelectionChange:B,editDeviceType:L,toggleStatus:s,deleteDeviceTypeHandler:P,submitForm:E,resetForm:O,formatDate:H,getCategoryTagType:I,getCategoryText:Z,getStatusTagType:J,getStatusStyle:G,getStatusText:W}}},fe={class:"device-type-management"},ye={class:"header-section"},he={class:"header-actions"},be={class:"theme-search-section"},Te={class:"theme-stats-card"},Ce={class:"stats-item"},Se={class:"stats-value"},De={class:"stats-item"},we={class:"stats-value"},xe={class:"stats-item"},ke={class:"stats-value"},ze={class:"stats-item"},Ve={class:"stats-value"},Me={class:"theme-table-section"},Fe={class:"action-buttons"},Ae={class:"pagination-section"};function Re(V,o,M,a,x,k){const w=r("Plus"),C=r("el-icon"),d=r("el-button"),y=r("Refresh"),S=r("Search"),h=r("el-input"),p=r("el-col"),D=r("el-row"),g=r("el-card"),c=r("el-table-column"),z=r("el-tag"),v=r("el-table"),F=r("el-pagination"),_=r("el-form-item"),b=r("el-option"),A=r("el-select"),R=r("el-form"),U=r("el-dialog"),B=r("AppLayout"),L=le("loading");return K(),N(B,null,{default:l(()=>[n("div",fe,[n("div",ye,[o[12]||(o[12]=n("h1",null,"设备类型管理",-1)),n("div",he,[e(d,{type:"primary",onClick:o[0]||(o[0]=s=>a.showAddDialog=!0)},{default:l(()=>[e(C,null,{default:l(()=>[e(w)]),_:1}),o[10]||(o[10]=m(" 添加设备类型 ",-1))]),_:1}),e(d,{type:"primary",onClick:a.refreshData},{default:l(()=>[e(C,null,{default:l(()=>[e(y)]),_:1}),o[11]||(o[11]=m(" 刷新 ",-1))]),_:1},8,["onClick"])])]),n("div",be,[e(D,{gutter:20},{default:l(()=>[e(p,{span:8},{default:l(()=>[e(h,{modelValue:a.searchQuery,"onUpdate:modelValue":o[1]||(o[1]=s=>a.searchQuery=s),placeholder:"搜索设备类型名称或描述",clearable:"",onKeyup:se(a.handleSearch,["enter"])},{prefix:l(()=>[e(C,null,{default:l(()=>[e(S)]),_:1})]),_:1},8,["modelValue","onKeyup"])]),_:1}),e(p,{span:4},{default:l(()=>[e(d,{type:"primary",onClick:a.handleSearch},{default:l(()=>[...o[13]||(o[13]=[m("搜索",-1)])]),_:1},8,["onClick"]),e(d,{type:"warning",onClick:a.resetForm},{default:l(()=>[...o[14]||(o[14]=[m("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),n("div",Te,[e(D,{gutter:20},{default:l(()=>[e(p,{span:6},{default:l(()=>[e(g,{class:"theme-stats-card"},{default:l(()=>[n("div",Ce,[n("div",Se,f(a.statistics.total),1),o[15]||(o[15]=n("div",{class:"stats-label"},"设备类型总数",-1))])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(g,{class:"theme-stats-card"},{default:l(()=>[n("div",De,[n("div",we,f(a.statistics.active),1),o[16]||(o[16]=n("div",{class:"stats-label"},"启用状态",-1))])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(g,{class:"theme-stats-card"},{default:l(()=>[n("div",xe,[n("div",ke,f(a.statistics.inactive),1),o[17]||(o[17]=n("div",{class:"stats-label"},"禁用状态",-1))])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(g,{class:"theme-stats-card"},{default:l(()=>[n("div",ze,[n("div",Ve,f(a.statistics.usage_count),1),o[18]||(o[18]=n("div",{class:"stats-label"},"使用中设备",-1))])]),_:1})]),_:1})]),_:1})]),n("div",Me,[ne((K(),N(v,{data:a.deviceTypeList,stripe:"",onSelectionChange:a.handleSelectionChange},{default:l(()=>[e(c,{type:"selection",width:"80"}),e(c,{prop:"name",label:"设备类型名称",width:"220",sortable:"",align:"center"}),e(c,{prop:"code",label:"类型代码",width:"160",align:"center"}),e(c,{prop:"category",label:"设备分类",width:"160",align:"center"},{default:l(({row:s})=>[e(z,{type:a.getCategoryTagType(s.category),size:"small"},{default:l(()=>[m(f(a.getCategoryText(s.category)),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"status",label:"状态",width:"120",align:"center"},{default:l(({row:s})=>[e(z,{type:a.getStatusTagType(s.status),size:"small",style:ie(a.getStatusStyle(s.status))},{default:l(()=>[m(f(a.getStatusText(s.status)),1)]),_:2},1032,["type","style"])]),_:1}),e(c,{prop:"usage_count",label:"使用数量",width:"140",align:"center"}),e(c,{prop:"description",label:"描述",width:"200","show-overflow-tooltip":"",align:"center"},{default:l(({row:s})=>[n("span",null,f(s.description||"-"),1)]),_:1}),e(c,{prop:"created_at",label:"创建时间",width:"200",align:"center"},{default:l(({row:s})=>[n("span",null,f(a.formatDate(s.created_at)),1)]),_:1}),e(c,{label:"操作",width:"260",fixed:"right",align:"center"},{default:l(({row:s})=>[n("div",Fe,[e(d,{type:"primary",size:"small",onClick:P=>a.editDeviceType(s)},{default:l(()=>[...o[19]||(o[19]=[m(" 编辑 ",-1)])]),_:2},1032,["onClick"]),e(d,{type:"danger",plain:"",size:"small",disabled:s.usage_count>0,onClick:P=>a.deleteDeviceTypeHandler(s),title:s.usage_count>0?`该设备类型正在被 ${s.usage_count} 个设备使用，无法删除`:"删除设备类型",class:re({"delete-disabled":s.usage_count>0})},{default:l(()=>[...o[20]||(o[20]=[m(" 删除 ",-1)])]),_:2},1032,["disabled","onClick","title","class"])])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[L,a.loading]]),n("div",Ae,[e(F,{"current-page":a.currentPage,"onUpdate:currentPage":o[2]||(o[2]=s=>a.currentPage=s),"page-size":a.pageSize,"onUpdate:pageSize":o[3]||(o[3]=s=>a.pageSize=s),"page-sizes":[20,50,100],total:a.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),e(U,{modelValue:a.showAddDialog,"onUpdate:modelValue":o[9]||(o[9]=s=>a.showAddDialog=s),title:a.editingDeviceType?"编辑设备类型":"添加设备类型",width:"600px",onClose:a.resetForm},{footer:l(()=>[e(d,{onClick:o[8]||(o[8]=s=>a.showAddDialog=!1)},{default:l(()=>[...o[22]||(o[22]=[m("取消",-1)])]),_:1}),e(d,{type:"primary",onClick:a.submitForm,loading:a.submitting},{default:l(()=>[m(f(a.editingDeviceType?"更新":"添加"),1)]),_:1},8,["onClick","loading"])]),default:l(()=>[e(R,{ref:"deviceTypeFormRef",model:a.deviceTypeForm,rules:a.deviceTypeRules,"label-width":"120px"},{default:l(()=>[e(_,{label:"设备类型名称",prop:"name"},{default:l(()=>[e(h,{modelValue:a.deviceTypeForm.name,"onUpdate:modelValue":o[4]||(o[4]=s=>a.deviceTypeForm.name=s),placeholder:"如：服务器、工作站等"},null,8,["modelValue"])]),_:1}),e(_,{label:"类型代码",prop:"code"},{default:l(()=>[e(h,{modelValue:a.deviceTypeForm.code,"onUpdate:modelValue":o[5]||(o[5]=s=>a.deviceTypeForm.code=s),placeholder:"如：server、workstation等"},null,8,["modelValue"]),o[21]||(o[21]=n("div",{class:"form-tip"},"类型代码用于系统内部标识，建议使用英文",-1))]),_:1}),e(_,{label:"设备分类",prop:"category"},{default:l(()=>[e(A,{modelValue:a.deviceTypeForm.category,"onUpdate:modelValue":o[6]||(o[6]=s=>a.deviceTypeForm.category=s),placeholder:"选择设备分类",style:{width:"100%"}},{default:l(()=>[e(b,{label:"计算设备",value:"computing"}),e(b,{label:"网络设备",value:"network"}),e(b,{label:"存储设备",value:"storage"}),e(b,{label:"安全设备",value:"security"}),e(b,{label:"办公设备",value:"office"}),e(b,{label:"其他设备",value:"other"})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"描述",prop:"description"},{default:l(()=>[e(h,{modelValue:a.deviceTypeForm.description,"onUpdate:modelValue":o[7]||(o[7]=s=>a.deviceTypeForm.description=s),type:"textarea",rows:3,placeholder:"设备类型的详细描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","onClose"])])]),_:1})}const je=X(_e,[["render",Re],["__scopeId","data-v-6810b56f"]]);export{je as default};
